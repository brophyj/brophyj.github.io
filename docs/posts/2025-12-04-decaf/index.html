<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="James M Brophy">
<title>Understanding unexpected results from randomized clini⁠cal trials – jay’s website</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/logo.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-234273d1456647dabc34a594ac50e507.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-76a990998280ab205a7fc842cb69dc07.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="../../custom.scss">
<meta property="og:title" content="Understanding unexpected results from randomized clini⁠cal trials – jay’s website">
<meta property="og:description" content="**Abstract:**

**Objective:** The recent DECAF randomized trial reported a statistically significant (p &amp;lt;0.">
<meta property="og:image" content="https://brophyj.com/posts/2025-12-04-decaf/preview-image.jpg">
<meta property="og:site_name" content="jay's website">
<meta name="twitter:title" content="Understanding unexpected results from randomized clini⁠cal trials – jay’s website">
<meta name="twitter:description" content="**Abstract:**

**Objective:** The recent DECAF randomized trial reported a statistically significant (p &amp;lt;0.">
<meta name="twitter:image" content="https://brophyj.com/posts/2025-12-04-decaf/preview-image.jpg">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/logo.png" alt="" class="navbar-logo"></a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">jay’s website</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../cv.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../talks.html"> 
<span class="menu-text">Talks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../example.html"> 
<span class="menu-text">Art</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="https://orcid.org/my-orcid?orcid=0000-0001-8049-6875"> 
<span class="menu-text"><i class="fab fa-orcid"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://mastodon.social/@brophyj"> 
<span class="menu-text"><i class="fab fa-mastodon"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://twitter.com/brophyj"> 
<span class="menu-text"><i class="fab fa-twitter"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/brophyj/"> 
<span class="menu-text"><i class="fab fa-linkedin-in"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/brophyj"> 
<span class="menu-text"><i class="fab fa-github"></i></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-right">
      <div class="quarto-title-block"><div><h1 class="title">Understanding unexpected results from randomized clini⁠cal trials</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
            <p class="subtitle lead">Does coffee reduce atrial fibrillation recurrences?</p>
                                <div class="quarto-categories">
                <div class="quarto-category">Scientific review</div>
                <div class="quarto-category">Statistical methods</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author column-page-right">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author"><a href="https://brophyj.github.io/">James M Brophy</a> <a href="https://orcid.org/0000-0001-8049-6875" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              <a href="https://mcgill.ca">
              McGill University Dept Medicine, Epidemiology and Biostatistics
              </a>
            </p>
        </div>
    </div>

  <div class="quarto-title-meta column-page-right">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Thursday, the 4th of December, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  <div>
    <div class="abstract">
      <div class="block-title">Abstract</div>
      <p><strong>Abstract:</strong></p>
      <p><strong>Objective:</strong> The recent DECAF randomized trial reported a statistically significant (p &lt;0.01) reduction in the recurrence of atrial fibrillation with continued consumption of caffeinated coffee compared to abstinence from coffee and caffeinated products. As coffee has historically be viewed as proarrhythmic, this result may be seen as “unexpected”.</p>
      <p><strong>Evidence Review:</strong> Using digitally extracted individual data from this publication, frequentist and Bayesian analyses were performed.</p>
      <p><strong>Findings:</strong> Frequentist analyses showed the trial was underpowered to detect realistic differences and consequently any statistically significant findings are likely subject to a two fold M (magnitude) error. Bayesian analyses, using priors from the DECAF power calulations, show posterior probabilities for a clinically meaningful differences to be inconclusive with the probability of a hazard ratio &lt; 0.9 equal to 88% and the probablity of a risk difference &gt; 2% equal to 82%.</p>
      <p><strong>Conclusions and Relevance:</strong> Supplemental frequentist and Bayesian analyses can test the robustness of “unexpected” results and provide additional insights and nuances into their interpretation. For DECAF which had very positive, but surprising, results in favor of caffeine, this approach shows the probability of a clinically meaningful benefit is inconclusive.</p>
    </div>
  </div>
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#backgound" id="toc-backgound" class="nav-link active" data-scroll-target="#backgound">Backgound</a></li>
  <li><a href="#decaf-trial-design" id="toc-decaf-trial-design" class="nav-link" data-scroll-target="#decaf-trial-design">DECAF Trial Design</a></li>
  <li><a href="#decaf-trial-results" id="toc-decaf-trial-results" class="nav-link" data-scroll-target="#decaf-trial-results">DECAF Trial Results</a></li>
  <li><a href="#bayesian-reanalysis-of-decaf-survival-modeling" id="toc-bayesian-reanalysis-of-decaf-survival-modeling" class="nav-link" data-scroll-target="#bayesian-reanalysis-of-decaf-survival-modeling">Bayesian reanalysis of DECAF (survival modeling)</a></li>
  <li><a href="#bayesian-reanalysis-of-decaf-risk-difference" id="toc-bayesian-reanalysis-of-decaf-risk-difference" class="nav-link" data-scroll-target="#bayesian-reanalysis-of-decaf-risk-difference">Bayesian reanalysis of DECAF (risk difference)</a></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a></li>
  <li><a href="#supplementary-material" id="toc-supplementary-material" class="nav-link" data-scroll-target="#supplementary-material">Supplementary Material</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/brophyj/edit/main/posts/2025-12-04-decaf/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/brophyj/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="index.pdf"><i class="bi bi-file-pdf"></i>Typst (preprint)</a></li><li><a href="index.docx"><i class="bi bi-file-word"></i>MS Word</a></li></ul></div></nav>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-right" id="quarto-document-content"><section id="backgound" class="level2"><h2 class="anchored" data-anchor-id="backgound">Backgound</h2>
<p>A recent paper, <a href="https://jamanetwork.com/journals/jama/fullarticle/2841253">“Caffeinated Coffee Consumption or Abstinence to Reduce Atrial Fibrillation The DECAF Randomized Clinical Trial”</a><span class="citation" data-cites="RN1">(<a href="#ref-RN1" role="doc-biblioref">1</a>)</span> published online in JAMA on Nov 9 2025 concluded</p>
<blockquote class="blockquote">
<p>“In this clinical trial of coffee drinkers after successful cardioversion, allocation to consumption of caffeinated coffee averaging 1 cup a day was associated with less recurrence of AF or atrial flutter compared with abstinence from coffee and caffeinated products.”<br></p>
</blockquote>
<p>This conclusion is likely surprising to most physicians as the historical belief is that caffeine is associated with increased cardiac ectopy. However the authors make the case that while</p>
<blockquote class="blockquote">
<p>“Caffeinated coffee has traditionally been considered proarrhythmic”</p>
</blockquote>
<p>its role in atrial fibrillation is less uncertain. Supporting this uncertainty, the authors refer to a previous randomized trial<span class="citation" data-cites="RN3">(<a href="#ref-RN3" role="doc-biblioref">2</a>)</span> that was not of atrial fibrillation patients but rather of 100 ambulatory patients studies in a crossover design. That study concluded</p>
<blockquote class="blockquote">
<p>” the consumption of caffeinated coffee did not result in significantly more daily premature atrial contractions than the avoidance of caffeine”</p>
</blockquote>
<p>This small trial<span class="citation" data-cites="RN3">(<a href="#ref-RN3" role="doc-biblioref">2</a>)</span> examined only short-term surrogate endpoints, not atrial fibrillation outcomes, and actually found a non significant trend towards more atrial ectopy in the caffeine group.</p>
<blockquote class="blockquote">
<p>“The consumption of caffeinated coffee was associated with 58 daily premature atrial contractions as compared with 53 daily events on days when caffeine was avoided (rate ratio, 1.09; 95% confidence interval [CI], 0.98 to 1.20; P=0.10). The consumption of caffeinated coffee as compared with no caffeine consumption was associated with 154 and 102 daily premature ventricular contractions, respectively (rate ratio, 1.51; 95% CI, 1.18 to 1.94).”<span class="citation" data-cites="RN3">(<a href="#ref-RN3" role="doc-biblioref">2</a>)</span></p>
</blockquote>
<p>Apart from assuming that atrial ectopy is a good surrogate for atrial fibrillation, this suggests confusion between “absence of evidence” with “evidence of absence”.</p>
<p>The DECAF authors<span class="citation" data-cites="RN1">(<a href="#ref-RN1" role="doc-biblioref">1</a>)</span> also cite a meta-analysis of 12 observational studies<span class="citation" data-cites="RN4">(<a href="#ref-RN4" role="doc-biblioref">3</a>)</span> that reported no conclusive evidence for or against an association between caffeine intake and incident atrial fibrillation (OR 0.95 (0.84–1.06). The quality of these 12 studies was not reported and as the DECAF authors state</p>
<blockquote class="blockquote">
<p>“observational studies are prone to confounding,and whether these findings are biased by systematic differences between coffee and noncoffee drinkers is unclear”<span class="citation" data-cites="RN1">(<a href="#ref-RN1" role="doc-biblioref">1</a>)</span></p>
</blockquote>
<p>Given this uncertainty, DECAF<span class="citation" data-cites="RN1">(<a href="#ref-RN1" role="doc-biblioref">1</a>)</span> was designed to investigate the effect of caffeinated coffee consumption versus abstinence on atrial fibrillation recurrence following successful cardioversion.</p>
</section><section id="decaf-trial-design" class="level2"><h2 class="anchored" data-anchor-id="decaf-trial-design">DECAF Trial Design</h2>
<p>DECAF<span class="citation" data-cites="RN1">(<a href="#ref-RN1" role="doc-biblioref">1</a>)</span> was a randomized controlled trial of 200 regular coffee drinkers with a recent successful cardioversion for atrial fibrillation (AF). Patients were randomized to either continue their usual caffeinated coffee consumption (median 1 cup/day) or to abstain from all caffeine products (decaf group). The primary outcome was recurrence of atrial fibrillation or atrial flutter within 6 months. The sample size calculations were based on assuming</p>
<blockquote class="blockquote">
<p>“… a 50% incidence of AF recurrence within 6 months following cardioversion. A clinically relevant effect size was assumed to approximate the effectiveness of commonly prescribed antiarrhythmic drugs for recurrentAFafter cardioversion. To provide 80% power to detect a minimum 41% reduced relative hazard of AF, we enrolled 200 patients (100 per group) assuming a 1:1 randomization scheme, potential 10% loss to follow-up, and .05 2-tailed α level.”<span class="citation" data-cites="RN1">(<a href="#ref-RN1" role="doc-biblioref">1</a>)</span></p>
</blockquote>
<p>This description is problematic for the following reasons.<br>
1. The implication is, since the methods section is written before any results are available, that 1:1 randomization of 200 subjects will automatically produce two equal groups. Based on binomial probability theory, there is only a 5.7% chance of achieving a perfectly balanced split (see Figure below).</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">nrand</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="fl">20000</span>, <span class="fl">200</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>nrand <span class="op">=</span> <span class="va">nrand</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Count for x = 100</span></span>
<span><span class="va">count_100</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">nrand</span> <span class="op">==</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Theoretical probabilities for overlay</span></span>
<span><span class="va">x_vals</span> <span class="op">&lt;-</span> <span class="fl">80</span><span class="op">:</span><span class="fl">120</span></span>
<span><span class="va">theoretical</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">x_vals</span>,</span>
<span>  prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">dbinom</a></span><span class="op">(</span><span class="va">x_vals</span>, size <span class="op">=</span> <span class="fl">200</span>, prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">*</span> <span class="fl">20000</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">gg1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">nrand</span>, fill <span class="op">=</span> <span class="va">nrand</span> <span class="op">==</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TRUE"</span> <span class="op">=</span> <span class="st">"red"</span>, <span class="st">"FALSE"</span> <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>data <span class="op">=</span> <span class="va">theoretical</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">prob</span><span class="op">)</span>,</span>
<span>            color <span class="op">=</span> <span class="st">"darkblue"</span>, linewidth <span class="op">=</span> <span class="fl">1.2</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">100</span>, y <span class="op">=</span> <span class="va">count_100</span> <span class="op">+</span> <span class="fl">50</span>,</span>
<span>           label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Count ="</span>, <span class="va">count_100</span>, <span class="st">"\n= "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="op">(</span><span class="va">count_100</span> <span class="op">/</span> <span class="fl">20000</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"%"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>           color <span class="op">=</span> <span class="st">"red"</span>, fontface <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Histogram of 20,000 Simulations \nDrawn from Binomial(200, 0.5)"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Number per group"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Frequency"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"Red bar indicates count at x = 100 \nBlue line represents theoretical probabilities"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">gg1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="index_files/figure-html/fig_binom-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Distribution of group sizes for n=200 randomized 1:1 into two groups. The probability of a perfect 100/100 split is only 5.7%."><img src="index_files/figure-html/fig_binom-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Distribution of group sizes for n=200 randomized 1:1 into two groups. The probability of a perfect 100/100 split is only 5.7%."></a></p>
</figure>
</div>
<figcaption>Distribution of group sizes for n=200 randomized 1:1 into two groups. The probability of a perfect 100/100 split is only 5.7%.</figcaption></figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggsave</span><span class="op">(</span><span class="st">"output/binom_group_sizes.png"</span>, <span class="va">gg1</span>, width <span class="op">=</span> <span class="fl">7</span>, height <span class="op">=</span> <span class="fl">5</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Given the prevailing prior uncertainty, designing a trial to detect a very large risk reduction is overly optimistic. The 80% power estimate assumed a 41% reduction applied to a 50% baseline rates, meaning the intervention is expected to reduce recurrence by an absolute 20.5%. What would be the power with this sample size of 200 to detect a more modest relative risk reduction, say 15% (i.e.&nbsp;from 50% to 42.5%)? The answer is 24% (see Figure below, left panel), illustrating the study was severely underpowered to detect more realistic effect sizes and therefore at risk of Type M (magnitude) error<span class="citation" data-cites="RN38">(<a href="#ref-RN38" role="doc-biblioref">4</a>)</span>, meaning any statistically significant result tends to exaggerate the true effect<span class="citation" data-cites="RN38">(<a href="#ref-RN38" role="doc-biblioref">4</a>)</span>. Thus the observed −17% risk difference may be overstating the true benefit, possibly by a factor of two (see right panel of above Figure). The published result should therefore be interpreted cautiously. Further exploration of the probability of a clinically meaningful result awaits the Bayesian analysis provided in later sections.</li>
</ol>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ----------------------------------------</span></span>
<span><span class="co"># Required packages</span></span>
<span><span class="co"># ----------------------------------------</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/andytimm/retrodesign">retrodesign</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ----------------------------------------</span></span>
<span><span class="co"># Calculate SE from observed effect and CrI</span></span>
<span><span class="co"># ----------------------------------------</span></span>
<span><span class="va">observed_effect</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.076</span>     <span class="co"># Observed RD (Caf - Decaf)</span></span>
<span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.195</span>               <span class="co"># Lower bound of 95% CrI</span></span>
<span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="fl">0.044</span>                <span class="co"># Upper bound of 95% CrI</span></span>
<span></span>
<span><span class="co"># Approximate SE from 95% CrI</span></span>
<span><span class="va">se</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">upper</span> <span class="op">-</span> <span class="va">lower</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="fl">1.96</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># z-score and p-value (frequentist approximation)</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="va">observed_effect</span> <span class="op">/</span> <span class="va">se</span></span>
<span><span class="va">p_value</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ----------------------------------------</span></span>
<span><span class="co"># Assumed effect from original design</span></span>
<span><span class="co"># ----------------------------------------</span></span>
<span><span class="va">assumed_effect</span> <span class="op">&lt;-</span> <span class="fl">0.20</span>  <span class="co"># DECAF assumed a large benefit for decaf</span></span>
<span></span>
<span><span class="co"># ----------------------------------------</span></span>
<span><span class="co"># Compute retrodesign metrics for observed and assumed effects</span></span>
<span><span class="co"># ----------------------------------------</span></span>
<span><span class="va">retro_observed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/retrodesign/man/retro_design_closed_form.html">retro_design_closed_form</a></span><span class="op">(</span><span class="va">observed_effect</span>, <span class="va">se</span><span class="op">)</span></span>
<span><span class="va">retro_assumed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/retrodesign/man/retro_design_closed_form.html">retro_design_closed_form</a></span><span class="op">(</span><span class="va">assumed_effect</span>, <span class="va">se</span><span class="op">)</span></span>
<span></span>
<span><span class="va">power_observed</span> <span class="op">&lt;-</span> <span class="va">retro_observed</span><span class="op">$</span><span class="va">power</span></span>
<span><span class="va">power_assumed</span> <span class="op">&lt;-</span> <span class="va">retro_assumed</span><span class="op">$</span><span class="va">power</span></span>
<span><span class="va">type_s_observed</span> <span class="op">&lt;-</span> <span class="va">retro_observed</span><span class="op">$</span><span class="va">type_s</span></span>
<span><span class="va">type_m_observed</span> <span class="op">&lt;-</span> <span class="va">retro_observed</span><span class="op">$</span><span class="va">type_m</span></span>
<span></span>
<span><span class="co"># ----------------------------------------</span></span>
<span><span class="co"># Print numeric summary</span></span>
<span><span class="co"># ----------------------------------------</span></span>
<span><span class="co"># cat("Observed Effect =", observed_effect, "\n")</span></span>
<span><span class="co"># cat("SE =", round(se, 4), "\n")</span></span>
<span><span class="co"># cat("Approx p-value =", round(p_value, 4), "\n")</span></span>
<span><span class="co"># cat("Power (Observed) =", round(power_observed, 3), "\n")</span></span>
<span><span class="co"># cat("Type S Error =", round(type_s_observed, 3), "\n")</span></span>
<span><span class="co"># cat("Type M Error =", round(type_m_observed, 3), "\n\n")</span></span>
<span><span class="co"># cat("Assumed Effect =", assumed_effect, "\n")</span></span>
<span><span class="co"># cat("Power (Assumed) =", round(power_assumed, 3), "\n\n")</span></span>
<span></span>
<span></span>
<span><span class="co"># ----------------------------------------</span></span>
<span><span class="co"># Range of true effects for plotting</span></span>
<span><span class="co"># ----------------------------------------</span></span>
<span><span class="va">true_effects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.20</span>, <span class="fl">0.20</span>, length.out <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="va">retro</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/retrodesign/man/retro_design_closed_form.html">retro_design_closed_form</a></span><span class="op">(</span><span class="va">true_effects</span>, <span class="va">se</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build data frame</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  TrueEffect <span class="op">=</span> <span class="va">true_effects</span>,</span>
<span>  Power <span class="op">=</span> <span class="va">retro</span><span class="op">$</span><span class="va">power</span>,</span>
<span>  TypeS <span class="op">=</span> <span class="va">retro</span><span class="op">$</span><span class="va">type_s</span>,</span>
<span>  Exaggeration <span class="op">=</span> <span class="va">retro</span><span class="op">$</span><span class="va">type_m</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ----------------------------------------</span></span>
<span><span class="co"># Custom theme for polished look</span></span>
<span><span class="co"># ----------------------------------------</span></span>
<span><span class="va">custom_theme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span>,</span>
<span>    plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,</span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,</span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># ----------------------------------------</span></span>
<span><span class="co"># Panel 1: Type S Error</span></span>
<span><span class="co"># ----------------------------------------</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">TrueEffect</span>, y <span class="op">=</span> <span class="va">TypeS</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkred"</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">assumed_effect</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"green"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">observed_effect</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span>, color <span class="op">=</span> <span class="st">"black"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">.1</span>, y <span class="op">=</span> <span class="fl">0.42</span>,</span>
<span>           label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Assumed +0.20\nPower ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">power_assumed</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           color <span class="op">=</span> <span class="st">"green"</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="va">observed_effect</span>, y <span class="op">=</span> <span class="fl">0.42</span>,</span>
<span>           label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Observed ="</span>, <span class="va">observed_effect</span>,</span>
<span>                         <span class="st">"\nPower ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">power_observed</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                         <span class="st">"\nType S ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">type_s_observed</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           color <span class="op">=</span> <span class="st">"black"</span>, hjust <span class="op">=</span> <span class="fl">1.1</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Type S Error vs True Effect Size"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Observed ="</span>, <span class="va">observed_effect</span>, <span class="st">"| SE ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">se</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"True Effect Size (Caf - Decaf)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Type S Error Probability"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">custom_theme</span></span>
<span></span>
<span><span class="co"># ----------------------------------------</span></span>
<span><span class="co"># Panel 2: Exaggeration Ratio</span></span>
<span><span class="co"># ----------------------------------------</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">TrueEffect</span>, y <span class="op">=</span> <span class="va">Exaggeration</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">assumed_effect</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"green"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">observed_effect</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">.1</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Exaggeration</span><span class="op">)</span><span class="op">*</span><span class="fl">0.85</span>,</span>
<span>           label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Assumed +0.20\nPower ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">power_assumed</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           color <span class="op">=</span> <span class="st">"green"</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">30</span>,</span>
<span>           label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Observed ="</span>, <span class="va">observed_effect</span>,</span>
<span>                         <span class="st">"\nPower ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">power_observed</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                         <span class="st">"\nType M ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">type_m_observed</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           color <span class="op">=</span> <span class="st">"black"</span>, hjust <span class="op">=</span> <span class="fl">1.1</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.10</span>, <span class="fl">0.10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">50</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Exaggeration Ratio vs \nTrue Effect Size"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"True Effect Size (Caf - Decaf)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Exaggeration Ratio"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">custom_theme</span></span>
<span></span>
<span><span class="co"># ----------------------------------------</span></span>
<span><span class="co"># Panel 3: Power</span></span>
<span><span class="co"># ----------------------------------------</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">TrueEffect</span>, y <span class="op">=</span> <span class="va">Power</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgreen"</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">assumed_effect</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"green"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">observed_effect</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">.05</span>, y <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>           label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Assumed +0.20\nPower ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">power_assumed</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           color <span class="op">=</span> <span class="st">"green"</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>           label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Observed ="</span>, <span class="va">observed_effect</span>,</span>
<span>                         <span class="st">"\nPower ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">power_observed</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           color <span class="op">=</span> <span class="st">"black"</span>, hjust <span class="op">=</span> <span class="fl">1.1</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Power vs \nTrue Effect Size"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"True Effect Size (Caf - Decaf)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Power"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">custom_theme</span></span>
<span></span>
<span><span class="co"># ----------------------------------------</span></span>
<span><span class="co"># Save combined plots</span></span>
<span><span class="co"># ----------------------------------------</span></span>
<span></span>
<span><span class="va">combined_plot</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">/</span> <span class="va">p2</span> <span class="op">/</span> <span class="va">p3</span></span>
<span><span class="va">combined_plotMP</span> <span class="op">&lt;-</span> <span class="va">p3</span> <span class="op">+</span> <span class="va">p2</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"output/decaf_retrodesign_panels_polished.png"</span>, <span class="va">combined_plot</span>, width <span class="op">=</span> <span class="fl">10</span>, height <span class="op">=</span> <span class="fl">14</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"output/decaf_retrodesign_panels_polished_MP.png"</span>, <span class="va">combined_plotMP</span>, width <span class="op">=</span> <span class="fl">10</span>, height <span class="op">=</span> <span class="fl">7</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span></span>
<span><span class="va">combined_plotMP</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="index_files/figure-html/power_curve-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Power curves for DECAF trial (n=200) to detect various relative risk reductions from a 50% baseline recurrence rate. The design has only 24% power to detect a 15% relative risk reduction(RRR). If the true effect is a 15% RRR, it is likely that any statistically significant result from this underpowered study will overstate the true effect by about two-fold."><img src="index_files/figure-html/power_curve-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Power curves for DECAF trial (n=200) to detect various relative risk reductions from a 50% baseline recurrence rate. The design has only 24% power to detect a 15% relative risk reduction(RRR). If the true effect is a 15% RRR, it is likely that any statistically significant result from this underpowered study will overstate the true effect by about two-fold."></a></p>
</figure>
</div>
<figcaption>Power curves for DECAF trial (n=200) to detect various relative risk reductions from a 50% baseline recurrence rate. The design has only 24% power to detect a 15% relative risk reduction(RRR). If the true effect is a 15% RRR, it is likely that any statistically significant result from this underpowered study will overstate the true effect by about two-fold.</figcaption></figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>A lack of specification as to which arm (abstinence or caffeinated) is hypothesized to have the reduced risk. This ambiguity creates interpretive flexibility as whichever arm shows benefit could be claimed as success. Such directional absence hinders inference and inflates the risk of misleading conclusions. This lack of statistical clarity is evident not only in the published article but also in the <a href="https://cdn.jamanetwork.com/ama/content_public/journal/jama/0/joi250099supp1_prod_1762458119.41086.pdf?Expires=1766002960&amp;Signature=veUO2luJ-u-d2v~RtBHqQYJC2JetjhjFXQ2J-Eyc49InJ9BYIPTzVjFxE7oZF7BTlAN7g8~HXiemM2Oh5AbgAaVaInX2CpjN0TujOBrJmE5uc4HCUffwRztEF3x-I7X3m5j8a2cvoGbjfqEIHXGVgY95WpCLsV4H~3Xbiorj-Q1imZOtOl3~q9qwYSifSymwWG1CyjaGrBo8RF8zpCVo7pdZY1eTv2kh9Q-9I5ysrMIgnlLCmT5OcOYdVYt2i1nkzqOpMg9m7DU62l68iAOeP5r-7-towaGgMkpsGHv1qAID4JMgcv4J1ql~DJQlpkMKvALXpRUBbdUAZs6DXRn~9A__&amp;Key-Pair-Id=APKAIE5G5CRDK6RD3PGA">trial protocol</a> and trial registration documentation at <a href="https://clinicaltrials.gov/study/NCT05121519#study-plan">ClinicalTrials.gov</a>. It is disconcerting that these design issues were overlooked not only by the authors but also apparently by peer reviewers, journal editors, and national funding agencies. These design flaws contribute to uncertainty in interpreting the final results.</li>
</ol></section><section id="decaf-trial-results" class="level2"><h2 class="anchored" data-anchor-id="decaf-trial-results">DECAF Trial Results</h2>
<p>In the caffeinated coffee group, 47% of patients had an AF or atrial flutter recurrence compared to 64% recurrence in the decaf group (hazard ratio, 0.61 [95%CI, 0.42-0.89],). The authors concluded</p>
<blockquote class="blockquote">
<p>“…allocation to consumption of caffeinated coffee averaging 1 cup a day was <span class="red-text"><strong>associated</strong></span> with less recurrence of AF or atrial flutter compared with abstinence from coffee and caffeinated products.”<span class="citation" data-cites="RN1">(<a href="#ref-RN1" role="doc-biblioref">1</a>)</span></p>
</blockquote>
<p>Given the randomized design and the statistically significant result (p = 0.01), it is surprising that the conclusion wasn’t</p>
<blockquote class="blockquote">
<blockquote class="blockquote">
<p>…allocation to consumption of caffeinated coffee averaging 1 cup a day <span class="red-text"><strong>caused</strong></span> less recurrence of AF or atrial flutter compared with abstinence from coffee and caffeinated products.</p>
</blockquote>
</blockquote>
<p>The results were summarized in the Figure below.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="input/decaf_CI_plot.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Cumulative incidence curve from DECAF trial[@RN1] showing higher recurrence rates in the decaf group (blue) versus caffeinated group (orange)."><img src="input/decaf_CI_plot.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-fig-height="400" alt="Cumulative incidence curve from DECAF trial(1) showing higher recurrence rates in the decaf group (blue) versus caffeinated group (orange)."></a></p>
</figure>
</div>
<figcaption>Cumulative incidence curve from DECAF trial<span class="citation" data-cites="RN1">(<a href="#ref-RN1" role="doc-biblioref">1</a>)</span> showing higher recurrence rates in the decaf group (blue) versus caffeinated group (orange).</figcaption></figure>
</div>
</section><section id="bayesian-reanalysis-of-decaf-survival-modeling" class="level2"><h2 class="anchored" data-anchor-id="bayesian-reanalysis-of-decaf-survival-modeling">Bayesian reanalysis of DECAF (survival modeling)</h2>
<p>The small p-value (p(data|null hypothesis) informs us that observing this data or more extreme data, if there was no true effect is unlikely. The inverse probability (p(effect|data) is arguably of greater interest and provides additional insights, most importantly the ability to include prior knowledge and to provide probability estimates of benefit or harm. Inverse probability, or Bayesian analyses, of survival data requires individual patient data (IPD) and well justified priors, which summarize the state of knowledge before seeing the data. Priors are often deemed the Achilles’ heel of Bayesian analyses, but well justified, transparent and robust testing of different priors can mitigate subjectiveness concerns. In Bayesian reanalyses of completed studies, prior beliefs can sometimes be extracted from the original power calculations. For example, the DECAF<span class="citation" data-cites="RN1">(<a href="#ref-RN1" role="doc-biblioref">1</a>)</span> authors assumed a baseline recurrence risk of 50% with a 41% relative risk reduction and therefore a 29.5% risk in the intervention group (0.50 - 0.50*0.41 = 0.295). However we are now faced with the previous identification problem of the direction in the projected improvement. Did DECAF<span class="citation" data-cites="RN1">(<a href="#ref-RN1" role="doc-biblioref">1</a>)</span> authors believe that the risk reduction would be with decaffeinated or caffeinated exposure? Given the prevailing belief of caffeine as a proarrhythmic agent and given that the study population was comprised initially of coffee drinkers, with the intervention being abstinence we assume the proposed relative risk reduction is in favor of the decaffeinated group.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">agg2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"caffeinated"</span>, <span class="st">"abstinence"</span><span class="op">)</span>,</span>
<span>                 levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"abstinence"</span>, <span class="st">"caffeinated"</span><span class="op">)</span><span class="op">)</span>,  <span class="co"># reference first</span></span>
<span>  y     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">47</span>, <span class="fl">64</span><span class="op">)</span>,</span>
<span>  n     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">agg2</span><span class="op">$</span><span class="va">group</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"abstinence"</span>,<span class="st">"caffeinated"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Observed counts by group (named vector) — used later to align PPCs</span></span>
<span><span class="va">y_obs_by_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">agg2</span>, <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">y</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ------------------------------------------------------------</span></span>
<span><span class="co"># PRIOR CONSTRUCTION BASED ON DECAF PUBLICATION</span></span>
<span><span class="co"># Since with use binomial model with logit link, we need to convert</span></span>
<span><span class="co"># the RR-based prior into log-OR scale for class="b" and </span></span>
<span><span class="co"># logit scale for class="Intercept"</span></span>
<span><span class="co"># ------------------------------------------------------------</span></span>
<span><span class="co"># 1: Decaf (reference) reduces risk by 41% vs caffeinated.</span></span>
<span><span class="va">RR_decaf_vs_caff</span> <span class="op">&lt;-</span> <span class="fl">0.59</span>  <span class="co"># 1- RRR = 1 - 0.41 = 0.59</span></span>
<span></span>
<span><span class="co"># 2: Baseline risk you want to anchor is caffeinated = 0.50.</span></span>
<span><span class="va">p_caff_baseline</span>  <span class="op">&lt;-</span> <span class="fl">0.50</span></span>
<span></span>
<span><span class="co"># Function to convert probabilities to odds ratio to logOR </span></span>
<span><span class="co"># Given RR(decaf vs caff) and p_caff, compute p_decaf, OR(caff vs decaf), </span></span>
<span><span class="co"># logOR(caff vs decaf), and Intercept mean = logit(p_decaf).</span></span>
<span><span class="va">from_RR_and_p_caff</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">RR_decaf_vs_caff</span>, <span class="va">p_caff</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="va">RR_decaf_vs_caff</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="va">p_caff</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="va">p_caff</span> <span class="op">&lt;</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">p_decaf</span> <span class="op">&lt;-</span> <span class="va">RR_decaf_vs_caff</span> <span class="op">*</span> <span class="va">p_caff</span>  <span class="co"># decaf risk = RR * caffeinated risk</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">p_decaf</span> <span class="op">&lt;=</span> <span class="fl">0</span> <span class="op">||</span> <span class="va">p_decaf</span> <span class="op">&gt;=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/warning.html">warning</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"Implied p_decaf = %.3f outside (0,1). Adjust RR or p_caff."</span>, <span class="va">p_decaf</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">odds_caff</span>  <span class="op">&lt;-</span> <span class="va">p_caff</span>  <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p_caff</span><span class="op">)</span></span>
<span>  <span class="va">odds_decaf</span> <span class="op">&lt;-</span> <span class="va">p_decaf</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p_decaf</span><span class="op">)</span></span>
<span>  <span class="va">OR_caff_vs_decaf</span>   <span class="op">&lt;-</span> <span class="va">odds_caff</span> <span class="op">/</span> <span class="va">odds_decaf</span></span>
<span>  <span class="va">logOR_caff_vs_decaf</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">OR_caff_vs_decaf</span><span class="op">)</span></span>
<span>  <span class="va">mu_intercept</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">qlogis</a></span><span class="op">(</span><span class="va">p_decaf</span><span class="op">)</span>       <span class="co"># baseline (decaf) on logit scale</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    p_caff       <span class="op">=</span> <span class="va">p_caff</span>,</span>
<span>    p_decaf      <span class="op">=</span> <span class="va">p_decaf</span>,</span>
<span>    OR           <span class="op">=</span> <span class="va">OR_caff_vs_decaf</span>,</span>
<span>    logOR        <span class="op">=</span> <span class="va">logOR_caff_vs_decaf</span>,  <span class="co"># prior mean for class="b"</span></span>
<span>    mu_intercept <span class="op">=</span> <span class="va">mu_intercept</span>          <span class="co"># prior mean for class="Intercept"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">conv</span> <span class="op">&lt;-</span> <span class="fu">from_RR_and_p_caff</span><span class="op">(</span><span class="va">RR_decaf_vs_caff</span>, <span class="va">p_caff_baseline</span><span class="op">)</span></span>
<span><span class="va">mu_b</span> <span class="op">&lt;-</span> <span class="va">conv</span><span class="op">$</span><span class="va">logOR</span>  <span class="co"># prior mean for b_groupcaffeinated (log-OR: caff vs decaf) ≈ +0.871</span></span>
<span><span class="va">mu_intercept</span> <span class="op">&lt;-</span> <span class="va">conv</span><span class="op">$</span><span class="va">mu_intercept</span> <span class="co"># prior mean for Intercept = logit(p_decaf) ≈ -0.871</span></span>
<span><span class="va">p_decaf_prior_center</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">mu_intercept</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># message(sprintf("Prior centers: logOR_b ≈ %.3f (OR ≈ %.2f), Intercept ≈ %.3f =&gt; p_decaf ≈ %.3f",  mu_b, exp(mu_b), mu_intercept, p_decaf_prior_center))</span></span>
<span></span>
<span><span class="co"># Prior SDs: tune to reflect how strongly you want to encode the belief.</span></span>
<span><span class="va">sd_b</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>          <span class="co"># narrower = stronger prior on treatment effect</span></span>
<span><span class="va">sd_intercept</span> <span class="op">&lt;-</span> <span class="fl">1.5</span>  <span class="co"># weakly-informative baseline for decaf</span></span>
<span></span>
<span><span class="va">priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="fu">set_prior</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"normal(%g, %g)"</span>, <span class="va">mu_b</span>,         <span class="va">sd_b</span><span class="op">)</span>,         class <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span>,</span>
<span>  <span class="fu">set_prior</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"normal(%g, %g)"</span>, <span class="va">mu_intercept</span>, <span class="va">sd_intercept</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"Intercept"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># alternative prior</span></span>
<span><span class="co">#priors &lt;- c(set_prior(paste0("normal(", mu_b, ", ", sd_b, ")"),</span></span>
<span><span class="co">#            class = "b", coef = "groupcaffeinated"),</span></span>
<span><span class="co"># set_prior(paste0("normal(", mu_intercept, ", ", sd_intercept, ")"), class =  "Intercept"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The priors for both treatment effect and baseline risk can be specified as normal distributions on the log-odds scale. Based on the assumptions used by the DECAF invetigators, the distributional parameters for the baseline control prior will be mean centered at their belief of a 50% recurrence risk (0 on the logit scale) with a standard deviation of 1.5, indicating a weakly informative prior. Similarly, the prior for the treatment effect will be centered at 29.5% (-0.871 on the logit scale) with an assumed standard deviation of 0.5, reflecting slightly higher confidence in our ability to estimate effect size variability. The reasonableness of these priors can be assessed through prior predictive checks which demonstrates that these priors adequately reflect the DECAF position of considerable uncertainty with a wide range of possible effect sizes, principally with expected benefit (93.5% probability), but a small probability of harm, for the intervention versus control.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ======================================================</span></span>
<span><span class="co"># Prior predictive for a two-arm Binomial trial</span></span>
<span><span class="co"># and effect-measure plots with requested axis settings</span></span>
<span><span class="co"># ======================================================</span></span>
<span></span>
<span></span>
<span><span class="co"># -----------------------------</span></span>
<span><span class="co"># 1) Prior specification (EDIT)</span></span>
<span><span class="co"># -----------------------------</span></span>
<span><span class="co"># Baseline (control) log-odds prior: theta0 ~ Normal(mu0, sd0^2)</span></span>
<span><span class="va">mu0</span> <span class="op">&lt;-</span> <span class="fl">0.0</span>       <span class="co"># logit(0.50) = 0</span></span>
<span><span class="va">sd0</span> <span class="op">&lt;-</span> <span class="fl">1.5</span>       <span class="co"># weakly-informative baseline prior</span></span>
<span></span>
<span><span class="co"># Treatment effect prior on log-odds ratio: delta ~ Normal(mud, sdd^2)</span></span>
<span><span class="va">mud</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.871</span>    <span class="co"># ≈ logit(0.295) - logit(0.50), belief of ~29.5% at 50% baseline</span></span>
<span><span class="va">sdd</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>       <span class="co"># moderately informative</span></span>
<span></span>
<span><span class="co"># Planned sample sizes (EDIT as needed)</span></span>
<span><span class="va">nC</span> <span class="op">&lt;-</span> <span class="fl">150</span></span>
<span><span class="va">nT</span> <span class="op">&lt;-</span> <span class="fl">150</span></span>
<span></span>
<span><span class="co"># Number of prior draws (increase for smoother densities)</span></span>
<span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fl">100000</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># -----------------------------</span></span>
<span><span class="co"># 2) Simulate from the priors</span></span>
<span><span class="co"># -----------------------------</span></span>
<span><span class="va">logistic</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">theta0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">S</span>, mean <span class="op">=</span> <span class="va">mu0</span>, sd <span class="op">=</span> <span class="va">sd0</span><span class="op">)</span>   <span class="co"># baseline log-odds</span></span>
<span><span class="va">delta</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">S</span>, mean <span class="op">=</span> <span class="va">mud</span>, sd <span class="op">=</span> <span class="va">sdd</span><span class="op">)</span>   <span class="co"># treatment log-OR</span></span>
<span></span>
<span><span class="va">pC</span> <span class="op">&lt;-</span> <span class="fu">logistic</span><span class="op">(</span><span class="va">theta0</span><span class="op">)</span>          <span class="co"># true control probability</span></span>
<span><span class="va">pT</span> <span class="op">&lt;-</span> <span class="fu">logistic</span><span class="op">(</span><span class="va">theta0</span> <span class="op">+</span> <span class="va">delta</span><span class="op">)</span>  <span class="co"># true treatment probability</span></span>
<span></span>
<span><span class="co"># -----------------------------</span></span>
<span><span class="co"># 3) Prior predictive data</span></span>
<span><span class="co"># -----------------------------</span></span>
<span><span class="va">YC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">S</span>, size <span class="op">=</span> <span class="va">nC</span>, prob <span class="op">=</span> <span class="va">pC</span><span class="op">)</span></span>
<span><span class="va">YT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">S</span>, size <span class="op">=</span> <span class="va">nT</span>, prob <span class="op">=</span> <span class="va">pT</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hat_pC</span> <span class="op">&lt;-</span> <span class="va">YC</span> <span class="op">/</span> <span class="va">nC</span></span>
<span><span class="va">hat_pT</span> <span class="op">&lt;-</span> <span class="va">YT</span> <span class="op">/</span> <span class="va">nT</span></span>
<span></span>
<span><span class="co"># -----------------------------</span></span>
<span><span class="co"># 4) Effect measures</span></span>
<span><span class="co"># -----------------------------</span></span>
<span><span class="co"># Risk difference: RD = p_hat_T - p_hat_C (benefit shows as negative)</span></span>
<span><span class="va">RD</span> <span class="op">&lt;-</span> <span class="va">hat_pT</span> <span class="op">-</span> <span class="va">hat_pC</span></span>
<span></span>
<span><span class="co"># Risk ratio</span></span>
<span><span class="va">eps</span> <span class="op">&lt;-</span> <span class="fl">1e-12</span></span>
<span><span class="va">RR</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">hat_pT</span> <span class="op">+</span> <span class="va">eps</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">hat_pC</span> <span class="op">+</span> <span class="va">eps</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Odds ratio</span></span>
<span><span class="va">OR</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">hat_pT</span> <span class="op">+</span> <span class="va">eps</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">hat_pT</span> <span class="op">+</span> <span class="va">eps</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span></span>
<span>  <span class="op">(</span><span class="op">(</span><span class="va">hat_pC</span> <span class="op">+</span> <span class="va">eps</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">hat_pC</span> <span class="op">+</span> <span class="va">eps</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">logRR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">RR</span><span class="op">)</span></span>
<span><span class="va">logOR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">OR</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ---------------------------</span></span>
<span><span class="co"># log(OR): x in [-3, +1]</span></span>
<span><span class="co"># ---------------------------</span></span>
<span><span class="va">p_logOR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">logOR</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#9ECAE1"</span>, color <span class="op">=</span> <span class="st">"#3182BD"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, adjust <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"grey40"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Prior Predictive: log Odds ratio"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"log(OR)"</span>, y <span class="op">=</span> <span class="st">"Density"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># ---------------------------</span></span>
<span><span class="co"># log(RR): x in [-3, +1]</span></span>
<span><span class="co"># ---------------------------</span></span>
<span><span class="va">p_logRR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">logRR</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#CFE8B9"</span>, color <span class="op">=</span> <span class="st">"#31A354"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, adjust <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"grey40"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Prior Predictive: log Risk ratio"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"log(RR)"</span>, y <span class="op">=</span> <span class="st">"Density"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pr_RD_gt0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">logRR</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"output/prior_predictive_logRR.png"</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">4</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ---------------------------</span></span>
<span><span class="co"># Risk difference (p̂T − p̂C), scaled per 100 patients</span></span>
<span><span class="co"># ---------------------------</span></span>
<span></span>
<span><span class="va">RD100</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">RD</span>  <span class="co"># keep sign: benefit-negative if pT &lt; pC</span></span>
<span></span>
<span><span class="co"># Tail probability for "worse than control" (RD &gt; 0)</span></span>
<span><span class="va">pr_RD_gt0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">RD</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Density for shading region RD &gt; 0 (i.e., &gt; 0 per 100 after scaling too)</span></span>
<span><span class="va">den_RD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">RD100</span>, adjust <span class="op">=</span> <span class="fl">1.0</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">df_RD</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">den_RD</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">den_RD</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reasonable x-limits from central mass; edit if you prefer fixed limits</span></span>
<span><span class="va">xlim_rd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">RD100</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.005</span>, <span class="fl">0.995</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_RD100</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df_RD</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Shade the &gt;0 side (treatment worse under RD = pT - pC)</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">df_RD</span>, <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"#FDAE6B"</span>, alpha <span class="op">=</span> <span class="fl">0.35</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Outline full density</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#E6550D"</span>, linewidth <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"grey40"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="va">xlim_rd</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Prior Predictive: Absolute risk difference"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"Shaded area: P(RD &gt; 0) = %.3f"</span>, <span class="va">pr_RD_gt0</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Absolute risk difference (per 100 patients)"</span>,  <span class="co"># still p̂T − p̂C</span></span>
<span>    y <span class="op">=</span> <span class="st">"Density"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"output/prior_predictive_RD100.png"</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">4</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In addition to the priors, the Bayesian survival analysis requires the individual patient data (IPD). Cumulative incidence data available in graphical format (DECAF<span class="citation" data-cites="RN1">(<a href="#ref-RN1" role="doc-biblioref">1</a>)</span> Figure3), were extracted with WebPlotDigitizer<span class="citation" data-cites="RN7716">(<a href="#ref-RN7716" role="doc-biblioref">5</a>)</span> and transformed into survival format to generate a Kaplan–Meier (KM) plot using the Guyot et al<span class="citation" data-cites="RN5762">(<a href="#ref-RN5762" role="doc-biblioref">6</a>)</span> algorithm that incorporates numbers at risk and event counts. This method was implemented via the IPDfromK <code>R</code> package<span class="citation" data-cites="IPDfromKM">(<a href="#ref-IPDfromKM" role="doc-biblioref">7</a>)</span> providing a robust and validated approach for reconstructing IPD from published survival curves for secondary analyses. The success in extracting the IPD is evident in the complete overlap between the reconstructed KM curves and the original published curves (see Figure below).</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ================== 1) Read &amp; tidy your CSV ==================</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"input/decaf_incident_data.csv"</span>,</span>
<span>               col_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"coffee_time"</span>,<span class="st">"coffee_inc"</span>,<span class="st">"decaf_time"</span>,<span class="st">"decaf_inc"</span><span class="op">)</span>,</span>
<span>               skip <span class="op">=</span> <span class="fl">2</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">coffee_xy</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">coffee_time</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">coffee_inc</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html">transmute</a></span><span class="op">(</span>time <span class="op">=</span> <span class="va">coffee_time</span>, inc <span class="op">=</span> <span class="va">coffee_inc</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">time</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">decaf_xy</span>  <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">decaf_time</span><span class="op">)</span>  <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">decaf_inc</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html">transmute</a></span><span class="op">(</span>time <span class="op">=</span> <span class="va">decaf_time</span>,  inc <span class="op">=</span> <span class="va">decaf_inc</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">time</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Truncate raw digitized series at 180 days </span></span>
<span><span class="va">coffee_xy</span> <span class="op">&lt;-</span> <span class="va">coffee_xy</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">time</span> <span class="op">&lt;=</span> <span class="fl">180</span><span class="op">)</span></span>
<span><span class="va">decaf_xy</span>  <span class="op">&lt;-</span> <span class="va">decaf_xy</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">time</span> <span class="op">&lt;=</span> <span class="fl">180</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ================== 2) Incidence(%) -&gt; Survival(%) for reconstruction ==================</span></span>
<span><span class="va">coffee_km</span> <span class="op">&lt;-</span> <span class="va">coffee_xy</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html">transmute</a></span><span class="op">(</span><span class="va">time</span>, surv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span> <span class="op">-</span> <span class="va">inc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">decaf_km</span>  <span class="op">&lt;-</span> <span class="va">decaf_xy</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html">transmute</a></span><span class="op">(</span><span class="va">time</span>, surv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span> <span class="op">-</span> <span class="va">inc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">coffee_km</span><span class="op">$</span><span class="va">time</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="va">coffee_km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fl">0</span>, surv <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, <span class="va">coffee_km</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">decaf_km</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>  <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="va">decaf_km</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fl">0</span>, surv <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,  <span class="va">decaf_km</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ================== 3) At-risk tables (yours) ==================</span></span>
<span><span class="va">trisk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30</span>, <span class="fl">60</span>, <span class="fl">90</span>, <span class="fl">120</span>, <span class="fl">150</span>, <span class="fl">180</span><span class="op">)</span></span>
<span><span class="va">nrisk_coffee</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">79</span>, <span class="fl">70</span>, <span class="fl">61</span>, <span class="fl">57</span>, <span class="fl">56</span>, <span class="fl">52</span><span class="op">)</span></span>
<span><span class="va">nrisk_decaf</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">64</span>, <span class="fl">53</span>, <span class="fl">47</span>, <span class="fl">45</span>, <span class="fl">38</span>, <span class="fl">36</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ================== 4) Reconstruct IPD (Guyot method via IPDfromKM) ==================</span></span>
<span></span>
<span><span class="va">prep_coffee</span> <span class="op">&lt;-</span> <span class="fu">preprocess</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">coffee_km</span><span class="op">)</span>, trisk <span class="op">=</span> <span class="va">trisk</span>, nrisk <span class="op">=</span> <span class="va">nrisk_coffee</span>, maxy <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">prep_decaf</span>  <span class="op">&lt;-</span> <span class="fu">preprocess</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">decaf_km</span><span class="op">)</span>,  trisk <span class="op">=</span> <span class="va">trisk</span>, nrisk <span class="op">=</span> <span class="va">nrisk_decaf</span>,  maxy <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ipd_coffee</span> <span class="op">&lt;-</span> <span class="fu">getIPD</span><span class="op">(</span><span class="va">prep_coffee</span>, armID <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="va">IPD</span>  <span class="co"># coffee arm</span></span>
<span><span class="va">ipd_decaf</span>  <span class="op">&lt;-</span> <span class="fu">getIPD</span><span class="op">(</span><span class="va">prep_decaf</span>,  armID <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">$</span><span class="va">IPD</span>  <span class="co"># decaf arm</span></span>
<span></span>
<span><span class="va">ipd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>time <span class="op">=</span> <span class="va">ipd_coffee</span><span class="op">$</span><span class="va">time</span>, status <span class="op">=</span> <span class="va">ipd_coffee</span><span class="op">$</span><span class="va">status</span>, arm_coffee <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>time <span class="op">=</span> <span class="va">ipd_decaf</span><span class="op">$</span><span class="va">time</span>,  status <span class="op">=</span> <span class="va">ipd_decaf</span><span class="op">$</span><span class="va">status</span>,  arm_coffee <span class="op">=</span> <span class="fl">0L</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ================== 5) Truncate ANALYSIS at 180 days ==================</span></span>
<span><span class="va">ipd</span> <span class="op">&lt;-</span> <span class="va">ipd</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>time_orig <span class="op">=</span> <span class="va">time</span>, status_orig <span class="op">=</span> <span class="va">status</span>,</span>
<span>         time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span><span class="op">(</span><span class="va">time</span>, <span class="fl">180</span><span class="op">)</span>,</span>
<span>         status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">time_orig</span> <span class="op">&gt;</span> <span class="fl">180</span>, <span class="fl">0L</span>, <span class="va">status_orig</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">time_orig</span>, <span class="op">-</span><span class="va">status_orig</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ================== 6) Frequentist Cox (authors’ coding: coffee=1, decaf=0) ==================</span></span>
<span><span class="va">fit_cox</span> <span class="op">&lt;-</span> <span class="fu">coxph</span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">arm_coffee</span>, data <span class="op">=</span> <span class="va">ipd</span><span class="op">)</span></span>
<span><span class="va">s_cox</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_cox</span><span class="op">)</span></span>
<span><span class="va">hr</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit_cox</span><span class="op">)</span><span class="op">[</span><span class="st">"arm_coffee"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">ci_95</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">fit_cox</span><span class="op">)</span><span class="op">[</span><span class="st">"arm_coffee"</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="va">p_value</span> <span class="op">&lt;-</span> <span class="va">s_cox</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="st">"arm_coffee"</span>, <span class="st">"Pr(&gt;|z|)"</span><span class="op">]</span></span>
<span><span class="co"># cat(sprintf("\nFrequentist Cox (coffee vs decaf): HR = %.2f (95%% CI %.2f–%.2f); p = %.3f\n", hr, ci_95[1], ci_95[2], p_value))</span></span>
<span></span>
<span><span class="co"># ================== 7) KM plot (truncated at 180 days) ==================</span></span>
<span><span class="va">km_fit</span> <span class="op">&lt;-</span> <span class="fu">survfit</span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">arm_coffee</span>, data <span class="op">=</span> <span class="va">ipd</span><span class="op">)</span></span>
<span><span class="va">p_km</span> <span class="op">&lt;-</span> <span class="fu">ggsurvplot</span><span class="op">(</span></span>
<span>  <span class="va">km_fit</span>, data <span class="op">=</span> <span class="va">ipd</span>, conf.int <span class="op">=</span> <span class="cn">FALSE</span>, risk.table <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">180</span><span class="op">)</span>,</span>
<span>  legend.labs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Decaf (control)"</span>, <span class="st">"Coffee (intervention)"</span><span class="op">)</span>,</span>
<span>  legend.title <span class="op">=</span> <span class="st">""</span>, palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#D95F02"</span>,<span class="st">"#1B9E77"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"output/km_plot_coffee_vs_decaf.png"</span>, <span class="va">p_km</span><span class="op">$</span><span class="va">plot</span>, width <span class="op">=</span> <span class="fl">7</span>, height <span class="op">=</span> <span class="fl">5</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ================== 8) Cumulative incidence overlay: digitized vs reconstructed ==================</span></span>
<span><span class="co"># Reconstructed cumulative incidence from KM (in %)</span></span>
<span><span class="va">km_df</span> <span class="op">&lt;-</span> <span class="fu">survminer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survminer/man/surv_summary.html">surv_summary</a></span><span class="op">(</span><span class="va">km_fit</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>cuminc <span class="op">=</span> <span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">surv</span><span class="op">)</span>,</span>
<span>         arm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">strata</span> <span class="op">==</span> <span class="st">"arm_coffee=0"</span>, <span class="st">"Decaf (KM)"</span>, <span class="st">"Coffee (KM)"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">cuminc</span>, <span class="va">arm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Digitized cumulative incidence (already in %), labeled</span></span>
<span><span class="va">dig_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">coffee_xy</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html">transmute</a></span><span class="op">(</span><span class="va">time</span>, cuminc <span class="op">=</span> <span class="va">inc</span>, arm <span class="op">=</span> <span class="st">"Coffee (digitized)"</span><span class="op">)</span>,</span>
<span>  <span class="va">decaf_xy</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html">transmute</a></span><span class="op">(</span><span class="va">time</span>, cuminc <span class="op">=</span> <span class="va">inc</span>, arm <span class="op">=</span> <span class="st">"Decaf (digitized)"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_step</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">km_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">cuminc</span>, color <span class="op">=</span> <span class="va">arm</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dig_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">cuminc</span>, color <span class="op">=</span> <span class="va">arm</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Coffee (KM)"</span><span class="op">=</span><span class="st">"#1B9E77"</span>,<span class="st">"Decaf (KM)"</span><span class="op">=</span><span class="st">"#D95F02"</span>,</span>
<span>                                <span class="st">"Coffee (digitized)"</span><span class="op">=</span><span class="st">"#1B9E77"</span>,<span class="st">"Decaf (digitized)"</span><span class="op">=</span><span class="st">"#D95F02"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">180</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Cumulative incidence (reconstructed KM vs digitized points)"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Days"</span>, y <span class="op">=</span> <span class="st">"Cumulative incidence (%)"</span>,</span>
<span>       color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">60</span>, <span class="fl">90</span>, <span class="fl">120</span>, <span class="fl">150</span>, <span class="fl">180</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">40</span>, <span class="fl">60</span>, <span class="fl">80</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p_ci</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="index_files/figure-html/cumulative-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Cumulative incidence plots from digitalized DECAF curves and reconstructed KM plots. Note excellent comparison with Figure 3."><img src="index_files/figure-html/cumulative-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Cumulative incidence plots from digitalized DECAF curves and reconstructed KM plots. Note excellent comparison with Figure 3."></a></p>
</figure>
</div>
<figcaption>Cumulative incidence plots from digitalized DECAF curves and reconstructed KM plots. Note excellent comparison with Figure 3.</figcaption></figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"output/cumulative_incidence_overlay.png"</span>, <span class="va">p_ci</span>, width <span class="op">=</span> <span class="fl">7</span>, height <span class="op">=</span> <span class="fl">5</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The IPD calculated frequentist survival analysis results, HR = 0.62 (95% CI 0.43–0.91),; p = 0.014 closely matches the published DECAF<span class="citation" data-cites="RN1">(<a href="#ref-RN1" role="doc-biblioref">1</a>)</span> results, confirming the accuracy of the IPD reconstruction process.</p>
<p>Once the priors and IPD are specified, we can proceed with the Bayesian survival regression modelling. As Cox regression uses the partial likelihood, which cancels out the baseline hazard when estimating the regression coefficients (i.e., log‑HRs), in a Bayesian Cox survival model we only need a prior for the the treatment effect.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#| label: compile-brms</span></span>
<span><span class="co">#| message: true</span></span>
<span><span class="co">#| warning: true</span></span>
<span><span class="co">#| error: true</span></span>
<span></span>
<span><span class="co"># ================== 9) Bayesian Cox in brms (coffee vs decaf) ==================</span></span>
<span><span class="co"># Prior: belief that decaf is better -&gt; coffee harmful a priori.</span></span>
<span><span class="co"># Encode as Normal(+0.871, 0.5) on the coffee coefficient (log-HR).</span></span>
<span><span class="va">ipd_brm</span> <span class="op">&lt;-</span> <span class="va">ipd</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>cens <span class="op">=</span> <span class="fl">1L</span> <span class="op">-</span> <span class="va">status</span><span class="op">)</span>  <span class="co"># brms uses 1=censored</span></span>
<span></span>
<span><span class="va">prior_cox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="fu">set_prior</span><span class="op">(</span><span class="st">"normal(0.871, 0.5)"</span>, class <span class="op">=</span> <span class="st">"b"</span>, coef <span class="op">=</span> <span class="st">"arm_coffee"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#| message: false</span></span>
<span><span class="co">#| warning: false</span></span>
<span></span>
<span><span class="va">fit_brm_cox</span> <span class="op">&lt;-</span> <span class="fu">quiet_brms</span><span class="op">(</span></span>
<span>  <span class="va">time</span> <span class="op">|</span> <span class="fu">cens</span><span class="op">(</span><span class="va">cens</span><span class="op">)</span> <span class="op">~</span> <span class="va">arm_coffee</span>,</span>
<span>  data    <span class="op">=</span> <span class="va">ipd_brm</span>,</span>
<span>  family  <span class="op">=</span> <span class="fu">cox</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  prior   <span class="op">=</span> <span class="va">prior_cox</span>,</span>
<span>  backend <span class="op">=</span> <span class="st">"cmdstanr"</span>,</span>
<span>  chains  <span class="op">=</span> <span class="fl">4</span>, iter <span class="op">=</span> <span class="fl">2500</span>, warmup <span class="op">=</span> <span class="fl">1000</span>, seed <span class="op">=</span> <span class="fl">20251114</span>,</span>
<span>  refresh <span class="op">=</span> <span class="fl">0</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>adapt_delta <span class="op">=</span> <span class="fl">0.999</span>, max_treedepth <span class="op">=</span> <span class="fl">13</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print(fit_brm_cox)</span></span>
<span></span>
<span><span class="co"># ---- Finish: summarize posterior HR and a simple probability statement ----</span></span>
<span><span class="va">post_cox</span> <span class="op">&lt;-</span> <span class="fu">posterior_summary</span><span class="op">(</span><span class="va">fit_brm_cox</span>, variable <span class="op">=</span> <span class="st">"b_arm_coffee"</span><span class="op">)</span></span>
<span><span class="va">HR_post</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">post_cox</span><span class="op">[</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Estimate"</span>,<span class="st">"Q2.5"</span>,<span class="st">"Q97.5"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># cat(sprintf("\nBayesian Cox (coffee vs decaf): HR = %.2f (95%% CrI %.2f–%.2f)\n", HR_post[1], HR_post[2], HR_post[3]))</span></span>
<span></span>
<span><span class="co"># Optional: posterior probability that coffee is beneficial (HR &lt; 1)</span></span>
<span><span class="va">draws_b</span> <span class="op">&lt;-</span> <span class="fu">as_draws_df</span><span class="op">(</span><span class="va">fit_brm_cox</span><span class="op">)</span><span class="op">[[</span><span class="st">"b_arm_coffee"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co"># cat(sprintf("Pr(HR &lt; 1 | data, prior) = %.3f\n", mean(draws_b &lt; 0)))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The Bayesian posterior hazard ratio is 0.74 (95% CrI 0.53–1.04), suggesting that caffeinated coffee consumption may be associated with a lower risk of AF recurrence compared to decaffeinated coffee but the strength of the conclusion has been tempered by the prior belief that decaffeinated and not caffeinated, coffee would be beneficial. Graphically this shift of the observed result by the prior belief is shown in the Figure below. Notice also the width of the posterior probability has narrowed, underscoring that our new data has decreased our uncertainty about the effect of coffee.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/posterior/">posterior</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ---- 1) Extract posterior draws of the treatment coefficient from brms Cox ----</span></span>
<span><span class="co"># Your model formula was: time | cens(cens) ~ arm_coffee</span></span>
<span><span class="va">draws_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_df.html">as_draws_df</a></span><span class="op">(</span><span class="va">fit_brm_cox</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Robustly locate the coefficient in case the name changes; print names if needed</span></span>
<span><span class="co"># print(names(draws_df)[grepl("^b_", names(draws_df))])</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="st">"b_arm_coffee"</span> <span class="op"><a href="https://mc-stan.org/posterior/reference/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">draws_df</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">post_b</span> <span class="op">&lt;-</span> <span class="va">draws_df</span><span class="op">[[</span><span class="st">"b_arm_coffee"</span><span class="op">]</span><span class="op">]</span>   <span class="co"># log-HR for caffeinated (1) vs decaf (0)</span></span>
<span></span>
<span><span class="co"># ---- 2) Generate prior draws with same length (coffee harmful a priori) ----</span></span>
<span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">post_b</span><span class="op">)</span></span>
<span><span class="va">prior_mu</span> <span class="op">&lt;-</span> <span class="op">+</span><span class="fl">0.871</span>   <span class="co"># your belief: decaf better -&gt; coffee harmful on log-(hazard) scale</span></span>
<span><span class="va">prior_sd</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">prior_b</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">S</span>, mean <span class="op">=</span> <span class="va">prior_mu</span>, sd <span class="op">=</span> <span class="va">prior_sd</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ---- 3) Combine to long format ----</span></span>
<span><span class="va">df_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">prior_b</span>, which <span class="op">=</span> <span class="st">"Prior"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">post_b</span>,  which <span class="op">=</span> <span class="st">"Posterior"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ---- 4) Observed value and posterior mean (for vertical lines) ----</span></span>
<span><span class="va">x_obs</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">0.61</span><span class="op">)</span>                    <span class="co"># authors' frequentist estimate</span></span>
<span><span class="va">post_mean</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">post_b</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>   <span class="co"># posterior mean of log-HR</span></span>
<span><span class="va">post_meanHR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">post_mean</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ---- 5) Plot: Prior vs Posterior on log-HR with reference lines ----</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df_b</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, colour <span class="op">=</span> <span class="va">which</span>, fill <span class="op">=</span> <span class="va">which</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.15</span>, linewidth <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">x_obs</span>, colour <span class="op">=</span> <span class="st">"grey30"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">post_mean</span>, colour <span class="op">=</span> <span class="st">"#E34A33"</span>, linetype <span class="op">=</span> <span class="st">"dotdash"</span>, linewidth <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    color <span class="op">=</span> <span class="cn">NULL</span>, fill <span class="op">=</span> <span class="cn">NULL</span>, x <span class="op">=</span> <span class="st">"log-HR (caffeinated vs decaf)"</span>,</span>
<span>    y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Prior vs Posterior for log-HR (caffeinated vs decaf)"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"Observed HR = 0.61 (log = %.3f). Posterior mean HR ≈ %.2f (log = %.3f)."</span>,</span>
<span>                       <span class="va">x_obs</span>, <span class="va">post_meanHR</span>, <span class="va">post_mean</span><span class="op">)</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"DECAF prior +0.871  indicating \n decaffienated risk &lt; coded caffeinated ."</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.caption <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hr_breaks</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.61</span>, <span class="fl">0.75</span>, <span class="fl">1</span>, <span class="fl">1.25</span>, <span class="fl">1.5</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">log_hr_breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">hr_breaks</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span></span>
<span>      name <span class="op">=</span> <span class="st">"log-HR (caffeinated vs decaf)"</span>,</span>
<span>      sec.axis <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/sec_axis.html">sec_axis</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span>, breaks <span class="op">=</span> <span class="va">log_hr_breaks</span>, labels <span class="op">=</span> <span class="va">hr_breaks</span>,</span>
<span>                          name <span class="op">=</span> <span class="st">"Hazard ratio (caffeinated vs decaf)"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="index_files/figure-html/logHR-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Prior and posterior probability density functions of log HR"><img src="index_files/figure-html/logHR-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Prior and posterior probability density functions of log HR"></a></p>
</figure>
</div>
<figcaption>Prior and posterior probability density functions of log HR</figcaption></figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"output/prior_vs_posterior_logHR.png"</span>, <span class="va">p</span>, width <span class="op">=</span> <span class="fl">7</span>, height <span class="op">=</span> <span class="fl">5</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># ---- 6) Probability coffee has clinically meaningful benefit (HR &lt; 0.9) ----</span></span>
<span></span>
<span></span>
<span><span class="va">p_hr_lt_0_9</span> <span class="op">&lt;-</span> <span class="va">df_b</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">which</span> <span class="op">==</span> <span class="st">"Posterior"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">value</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">0.9</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">prob</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># sprintf("%.3f", p_hr_lt_0_9)</span></span>
<span><span class="co"># round(p_hr_lt_0_9, 3)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Despite this shift, the posterior probability remains high that caffeinated coffee has a beneficial effect (HR &lt; 1) is 96.0. However, the probability that caffeinated coffee has a clinically meaningful benefit, for example a HR &lt; 0.9, falls to 87.9%. Increasing the threshold of what represents a clinically meaningful decrease, will lead to a corresponding reduction in the probability of a beneficial caffeine effect.</p>
</section><section id="bayesian-reanalysis-of-decaf-risk-difference" class="level2"><h2 class="anchored" data-anchor-id="bayesian-reanalysis-of-decaf-risk-difference">Bayesian reanalysis of DECAF (risk difference)</h2>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms">brms</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/ggtext/">ggtext</a></span><span class="op">)</span>   <span class="co"># &lt;- for colored text in subtitle</span></span>
<span></span>
<span><span class="co"># ---- Priors ----</span></span>
<span><span class="va">mu0</span> <span class="op">&lt;-</span> <span class="fl">0.0</span>      <span class="co"># baseline log-odds</span></span>
<span><span class="va">sd0</span> <span class="op">&lt;-</span> <span class="fl">1.5</span></span>
<span><span class="va">mud</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.871</span>   <span class="co"># mean of prior for log-OR (caffeinated vs decaf) on logit scale</span></span>
<span><span class="va">sdd</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ---- Fit Bayesian binomial model ----</span></span>
<span><span class="co"># The model will be run with 4 chains, each with 4000 iterations (1000 warmup), and using the `cmdstanr` backend for efficient sampling. The `adapt_delta` control parameter is set to 0.95 to help ensure convergence. </span></span>
<span></span>
<span><span class="va">fit_binom2</span> <span class="op">&lt;-</span> <span class="fu">quiet_brms</span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">|</span> <span class="fu">trials</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">~</span> <span class="va">group</span>, <span class="co"># groupcaffeinated is log-OR(caff vs decaf)</span></span>
<span>  data <span class="op">=</span> <span class="va">agg2</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>  prior <span class="op">=</span> <span class="va">priors</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  iter <span class="op">=</span> <span class="fl">4000</span>,</span>
<span>  warmup <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  refresh <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  backend <span class="op">=</span> <span class="st">"cmdstanr"</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>adapt_delta <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># print(summary(fit_binom2), digits = 3)</span></span>
<span></span>
<span></span>
<span><span class="co"># ---- Posterior RD (caffeinated − decaffeinated) ----</span></span>
<span><span class="va">nd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"abstinence"</span>, <span class="st">"caffeinated"</span><span class="op">)</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">eta_post</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/rstantools/reference/posterior_linpred.html">posterior_linpred</a></span><span class="op">(</span><span class="va">fit_binom2</span>, newdata <span class="op">=</span> <span class="va">nd</span>, transform <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">p_post</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">eta_post</span><span class="op">)</span></span>
<span><span class="va">rd_post</span>  <span class="op">&lt;-</span> <span class="va">p_post</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">p_post</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>  <span class="co"># caffeinated − decaffeinated</span></span>
<span></span>
<span><span class="va">post_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">rd_post</span><span class="op">)</span></span>
<span><span class="va">post_sd</span> <span class="op">&lt;-</span> <span class="fu">sd</span><span class="op">(</span><span class="va">rd_post</span><span class="op">)</span></span>
<span><span class="va">post_ci</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">rd_post</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># pnorm((0 - post_mean) / post_sd)  # Pr(RD &lt; 0 | data, prior) AKA pnorm(0, post_mean, post_sd) </span></span>
<span><span class="co"># clinically significant threshold at RD = -0.02</span></span>
<span><span class="co"># pnorm((-0.02 - post_mean) / post_sd)  # Pr(R</span></span>
<span></span>
<span><span class="co"># ---- Observed RD (same direction: caffeinated − decaffeinated) ----</span></span>
<span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">n</span><span class="op">)</span> <span class="op">~</span> <span class="va">group</span>, data <span class="op">=</span> <span class="va">fit_binom2</span><span class="op">$</span><span class="va">data</span>, <span class="va">sum</span><span class="op">)</span></span>
<span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="va">obs</span><span class="op">[</span><span class="fu"><a href="https://mc-stan.org/posterior/reference/match.html">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"abstinence"</span>, <span class="st">"caffeinated"</span><span class="op">)</span>, <span class="va">obs</span><span class="op">$</span><span class="va">group</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">obs_rd</span> <span class="op">&lt;-</span> <span class="va">obs</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">/</span> <span class="va">obs</span><span class="op">$</span><span class="va">n</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">obs</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="va">obs</span><span class="op">$</span><span class="va">n</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># ---- Prior RD (centered &gt; 0 for this RD definition) ----</span></span>
<span><span class="va">theta0</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">rd_post</span><span class="op">)</span>, <span class="va">mu0</span>, <span class="va">sd0</span><span class="op">)</span>   <span class="co"># baseline (decaf) log-odds</span></span>
<span><span class="va">delta</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">rd_post</span><span class="op">)</span>, <span class="va">mud</span>, <span class="va">sdd</span><span class="op">)</span>   <span class="co"># log-OR (caffeinated vs decaf)</span></span>
<span><span class="va">p_decaf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">theta0</span><span class="op">)</span></span>
<span><span class="va">p_caff</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">theta0</span> <span class="op">+</span> <span class="va">delta</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Mirror so prior centers &gt; 0 for RD = caffeinated − decaffeinated</span></span>
<span><span class="va">rd_prior</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="op">(</span><span class="va">p_caff</span> <span class="op">-</span> <span class="va">p_decaf</span><span class="op">)</span></span>
<span><span class="co"># quantile(rd_prior, c(.025,.5,.975))</span></span>
<span></span>
<span><span class="co"># ---- Plot ----</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>RD <span class="op">=</span> <span class="va">rd_prior</span>, which <span class="op">=</span> <span class="st">"Prior"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>RD <span class="op">=</span> <span class="va">rd_post</span>,  which <span class="op">=</span> <span class="st">"Posterior"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The DECAF<span class="citation" data-cites="RN1">(<a href="#ref-RN1" role="doc-biblioref">1</a>)</span> result can also be expressed as a risk difference, -17% [95% CI; -.03, -.31, p = 0.01]. Again a Bayesian risk difference analysis may facilitate clinical interpretations. The Bayesian model will be fit to the aggregated data of events and total patients in each group. The model formula specifies a binomial likelihood with a logit link function, appropriate for binary outcome data. The previously developped priors based on the DECAF power calculation can be transformed to the risk difference scale. The Bayesian posterior risk difference, based on these prior beliefs and the observed data is 7.6% (95% CrI: -19.5% to 4.4%), in favor of the caffeinated group. This posterior risk difference showed a shift towards the null compared to the frequentist result, due to the prior’s influence even thought it was left purposely vague due to reflect the lack of previous consensus concerning the intervention’s value in this population (see Figure below). The prior favored a posterior probability, (89.3%), for decaffeinated benefit but did allocate a smaller probability (10.7%) for a possible caffeinated benefit. While the final result suggests a caffeinated coffee benefit, the strength of the evidence in favor of this benefit is seen as modest at best, and certainly much less than implied by the original analysis. For example, the probability of a clinically meaningful benefit (e.g., say arbitrarily RD &lt; -0.02 or number needed to treat = 50) drops to 82.0%.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">RD</span><span class="op">*</span><span class="fl">100</span>, fill <span class="op">=</span> <span class="va">which</span>, color <span class="op">=</span> <span class="va">which</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.18</span>, adjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>,        linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">obs_rd</span><span class="op">*</span><span class="fl">100</span>,   linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"green3"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">post_mean</span><span class="op">*</span><span class="fl">100</span>,linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"firebrick"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Remove legend title by naming the scales NULL</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="cn">NULL</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Prior <span class="op">=</span> <span class="st">"#00BCD4"</span>, Posterior <span class="op">=</span> <span class="st">"#F08080"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="cn">NULL</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Prior <span class="op">=</span> <span class="st">"#00BCD4"</span>, Posterior <span class="op">=</span> <span class="st">"#F08080"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Prior vs Posterior for risk difference (RD)"</span>,</span>
<span>    <span class="co"># Color words in subtitle using &lt;span style='color:...'&gt; and ggtext</span></span>
<span>    subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span></span>
<span>      <span class="st">"Observed RD (&lt;span style='color:green3;'&gt;green line&lt;/span&gt;) = %.1f%%, Posterior mean RD (&lt;span style='color:firebrick;'&gt;red line&lt;/span&gt;) = %.1f%%"</span>,</span>
<span>      <span class="fl">100</span> <span class="op">*</span> <span class="va">obs_rd</span>, <span class="fl">100</span> <span class="op">*</span> <span class="va">post_mean</span></span>
<span>    <span class="op">)</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"DECAF assumed prior decaffienated &lt; caffeinated risk \nmirrored &gt; 0 since RD axis is (caffeinated - decaf)"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Risk difference (caffeinated − decaffeinated) / 100 treated"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Density"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    <span class="co"># Enable HTML rendering for the subtitle</span></span>
<span>    plot.subtitle <span class="op">=</span> <span class="fu">ggtext</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/ggtext/reference/element_markdown.html">element_markdown</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="index_files/figure-html/rd_plot-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="Prior and posterior probability density functions of risk difference"><img src="index_files/figure-html/rd_plot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Prior and posterior probability density functions of risk difference"></a></p>
</figure>
</div>
<figcaption>Prior and posterior probability density functions of risk difference</figcaption></figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"output/prior_vs_posterior_RD.png"</span>, width <span class="op">=</span> <span class="fl">7</span>, height <span class="op">=</span> <span class="fl">5</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="discussion" class="level2"><h2 class="anchored" data-anchor-id="discussion">Discussion</h2>
<p>DECAF<span class="citation" data-cites="RN1">(<a href="#ref-RN1" role="doc-biblioref">1</a>)</span> was a well performed clinical trial with successful randomization and no lost to follow-up. The trial was unblinded but events were adjudicated by treating physicians and not study coordinators so this risk of bias appears low. No other obvious biases were identified yet the results were highly “unexpected” or “surprising”. The published analysis apparently provides a definitive answer in favor of the caffeinated group (p = .01). Notwithstanding DECAF’s<span class="citation" data-cites="RN1">(<a href="#ref-RN1" role="doc-biblioref">1</a>)</span> positive attributes and the emergence of “dataism” - the belief that empirical data should guide decisions as characterized by the pithy aphorism “In God we trust. All others have to bring data.”, many clinicians will prefer to trust their intuition or “gut instinct” and not encourage coffee consumption or maintence to prevent episodes of recurrent atrial fibrillation. However, reliance on intuition over evidence remains prone to cognitive error<span class="citation" data-cites="RN5626">(<a href="#ref-RN5626" role="doc-biblioref">8</a>)</span>.</p>
<p>Given the increasing influence of data-driven decision-making, it is essential that statistical interpretations be both rigorous and nuanced, whether frequentist or Bayesian in nature. From a frequentist standpoint, DECAF’s<span class="citation" data-cites="RN1">(<a href="#ref-RN1" role="doc-biblioref">1</a>)</span> sample size was insufficient to detect realistic effect sizes. Power calculations revealed that the trial had only ~24% power to detect a 15% relative risk reduction, and any statistically significant result from such an underpowered study is likely to exaggerate the true effect — potentially by a factor of two.</p>
<p>The Bayesian framework adds further depth by incorporating prior beliefs and quantifies uncertainty in a way that frequentist methods cannot. It enables clinicians to assess not only the most recently observed data but also how to contextualize it by incorporating existing knowledge and beliefs. This is particularly important in scenarios where prior evidence or expert opinion may conflict with new findings. Using priors derived from the DECAF authors’ own assumptions<span class="citation" data-cites="RN1">(<a href="#ref-RN1" role="doc-biblioref">1</a>)</span>, the Bayesian survival and risk difference models suggest that the strength of evidence favoring caffeinated coffee is more modest than the frequentist interpretation implies. For example, while the posterior probability that caffeinated coffee reduces AF recurrence is high (~96%), the probability of a clinically meaningful benefit (e.g., HR &lt; 0.9) drops to ~88%. On the risk difference scale, the posterior probability of at least absolute 2% reduction in recurrences by avoiding abstinence is 82.0%. This distinction between statistical and clinical significance is crucial for informed decision-making.</p>
<p>Some may dismiss this reanalysis as statistical alchemy or the “haze of Bayes”<span class="citation" data-cites="RN41">(<a href="#ref-RN41" role="doc-biblioref">9</a>)</span>, but it offers a principled approach to interpreting unexpected findings. In the case of DECAF<span class="citation" data-cites="RN1">(<a href="#ref-RN1" role="doc-biblioref">1</a>)</span>, it tempers over-interpretation by including past beliefs, distinguishes between statistical and clinical significance, and provides the statistical justification for a replication study. This reanalysis can help clinicians make more informed decisions by providing a clearer understanding of the evidence at hand. This is especially important given that over 120 media outlets reported the findings within a week of publication, potentially influencing clinical practice and public behavior based on a single, underpowered study with unexpected, and naively interpreted, results.</p>
</section><section id="supplementary-material" class="level2"><h2 class="anchored" data-anchor-id="supplementary-material">Supplementary Material</h2>
<p>All code for the calculations and figures presented in this article are provided in the supplementary file</p>
</section><section id="references" class="level2">


<!-- -->


</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body" role="list">
<div id="ref-RN1" class="csl-entry" role="listitem">
<div class="csl-left-margin">1. </div>
<div class="csl-right-inline">Wong CX, Cheung CC, Montenegro G, Oo HH, Pena IJ, Tang JJ, et al. Caffeinated coffee consumption or abstinence to reduce atrial fibrillation: The DECAF randomized clinical trial. JAMA [Internet]. 2025; Available from: <a href="https://www.ncbi.nlm.nih.gov/pubmed/41206802">https://www.ncbi.nlm.nih.gov/pubmed/41206802</a>
</div>
</div>
<div id="ref-RN3" class="csl-entry" role="listitem">
<div class="csl-left-margin">2. </div>
<div class="csl-right-inline">Marcus GM, Rosenthal DG, Nah G, Vittinghoff E, Fang C, Ogomori K, et al. Acute effects of coffee consumption on health among ambulatory adults. N Engl J Med [Internet]. 2023;388(12):1092–100. Available from: <a href="https://www.ncbi.nlm.nih.gov/pubmed/36947466">https://www.ncbi.nlm.nih.gov/pubmed/36947466</a>
</div>
</div>
<div id="ref-RN4" class="csl-entry" role="listitem">
<div class="csl-left-margin">3. </div>
<div class="csl-right-inline">Krittanawong C, Tunhasiriwet A, Wang Z, Farrell AM, Chirapongsathorn S, Zhang H, et al. Is caffeine or coffee consumption a risk for new-onset atrial fibrillation? A systematic review and meta-analysis. Eur J Prev Cardiol [Internet]. 2021;28(12):e13–5. Available from: <a href="https://www.ncbi.nlm.nih.gov/pubmed/34647581">https://www.ncbi.nlm.nih.gov/pubmed/34647581</a>
</div>
</div>
<div id="ref-RN38" class="csl-entry" role="listitem">
<div class="csl-left-margin">4. </div>
<div class="csl-right-inline">Gelman A, Carlin J. Beyond power calculations: Assessing type s (sign) and type m (magnitude) errors. Perspect Psychol Sci [Internet]. 2014;9(6):641–51. Available from: <a href="https://www.ncbi.nlm.nih.gov/pubmed/26186114">https://www.ncbi.nlm.nih.gov/pubmed/26186114</a>
</div>
</div>
<div id="ref-RN7716" class="csl-entry" role="listitem">
<div class="csl-left-margin">5. </div>
<div class="csl-right-inline">Rohatgi A. WebPlotDigitizer [computer software] [Internet]. 2025. Available from: <a href="https://automeris.io/WebPlotDigitizer%EE%88%80cite%EE%88%82turn16search49">https://automeris.io/WebPlotDigitizerciteturn16search49</a>
</div>
</div>
<div id="ref-RN5762" class="csl-entry" role="listitem">
<div class="csl-left-margin">6. </div>
<div class="csl-right-inline">Guyot P, Ades AE, Ouwens MJ, Welton NJ. Enhanced secondary analysis of survival data: Reconstructing the data from published kaplan-meier survival curves. BMC Med Res Methodol [Internet]. 2012;12:9. Available from: <a href="https://www.ncbi.nlm.nih.gov/pubmed/22297116">https://www.ncbi.nlm.nih.gov/pubmed/22297116</a>
</div>
</div>
<div id="ref-IPDfromKM" class="csl-entry" role="listitem">
<div class="csl-left-margin">7. </div>
<div class="csl-right-inline">Liu N, Lee JJ. IPDfromKM: Map digitized survival curves back to individual patient data [Internet]. 2020. Available from: <a href="https://CRAN.R-project.org/package=IPDfromKM">https://CRAN.R-project.org/package=IPDfromKM</a>
</div>
</div>
<div id="ref-RN5626" class="csl-entry" role="listitem">
<div class="csl-left-margin">8. </div>
<div class="csl-right-inline">Kahneman D. Thinking, fast and slow. 1st ed. New York: Farrar, Straus; Giroux; 2011. </div>
</div>
<div id="ref-RN41" class="csl-entry" role="listitem">
<div class="csl-left-margin">9. </div>
<div class="csl-right-inline">Feinstein AR. Clinical biostatistics. XXXIX. The haze of bayes, the aerial palaces of decision analysis, and the computerized ouija board. Clin Pharmacol Ther [Internet]. 1977;21(4):482–96. Available from: <a href="https://www.ncbi.nlm.nih.gov/pubmed/403045">https://www.ncbi.nlm.nih.gov/pubmed/403045</a>
</div>
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{m_brophy,
  author = {M Brophy, James},
  title = {Understanding Unexpected Results from Randomized Clini⁠cal
    Trials},
  date = {},
  url = {https://brophyj.com/posts/2025-11-15-my-blog-post/},
  langid = {en},
  abstract = {**Abstract:** **Objective:** The recent DECAF randomized
    trial reported a statistically significant (p \&lt;0.01) reduction
    in the recurrence of atrial fibrillation with continued consumption
    of caffeinated coffee compared to abstinence from coffee and
    caffeinated products. As coffee has historically be viewed as
    proarrhythmic, this result may be seen as “unexpected”. **Evidence
    Review:** Using digitally extracted individual data from this
    publication, frequentist and Bayesian analyses were performed.
    **Findings:** Frequentist analyses showed the trial was underpowered
    to detect realistic differences and consequently any statistically
    significant findings are likely subject to a two fold M (magnitude)
    error. Bayesian analyses, using priors from the DECAF power
    calulations, show posterior probabilities for a clinically
    meaningful differences to be inconclusive with the probability of a
    hazard ratio \textless{} 0.9 equal to 88\% and the probablity of a
    risk difference \textgreater{} 2\% equal to 82\%. **Conclusions and
    Relevance:** Supplemental frequentist and Bayesian analyses can test
    the robustness of “unexpected” results and provide additional
    insights and nuances into their interpretation. For DECAF which had
    very positive, but surprising, results in favor of caffeine, this
    approach shows the probability of a clinically meaningful benefit is
    inconclusive.}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-m_brophy" class="csl-entry quarto-appendix-citeas" role="listitem">
<div class="">M
Brophy J. Understanding unexpected results from randomized clini⁠cal
trials [Internet]. Available from: <a href="https://brophyj.com/posts/2025-11-15-my-blog-post/">https://brophyj.com/posts/2025-11-15-my-blog-post/</a></div>
</div></div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/brophyj\.com");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb15" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Understanding unexpected results from randomized clini\u2060cal trials"</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Does coffee reduce atrial fibrillation recurrences?"     </span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: James M Brophy</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">    url: https://brophyj.github.io/</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">    orcid: 0000-0001-8049-6875</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: "McGill University Dept Medicine, Epidemiology and Biostatistics"</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation-url: https://mcgill.ca</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="an">abstract:</span><span class="co"> |</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">  **Abstract:**</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">  </span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">  **Objective:** The recent DECAF randomized trial reported a statistically significant (p &amp;lt;0.01) reduction in the recurrence of atrial fibrillation with continued consumption of caffeinated coffee compared to abstinence from coffee and caffeinated products. As coffee has historically be viewed as proarrhythmic, this result may be seen as "unexpected".</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">  </span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co">  **Evidence Review:** Using digitally extracted individual data from this publication, frequentist and Bayesian analyses were performed. </span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co">  </span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co">  **Findings:** Frequentist analyses showed the trial was underpowered to detect realistic differences and consequently any statistically significant findings are likely subject to a two fold M (magnitude) error. Bayesian analyses, using priors from the DECAF power calulations, show posterior probabilities for a clinically meaningful differences to be inconclusive with the probability of a hazard ratio &lt; 0.9 equal to 88% and the probablity of a risk difference &gt; 2% equal to 82%. </span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co">  </span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="co">  **Conclusions and Relevance:** Supplemental frequentist and Bayesian analyses can test the robustness of "unexpected" results and provide additional insights and nuances into their interpretation. For DECAF which had very positive, but surprising, results in favor of caffeine, this approach shows the probability of a clinically meaningful benefit is inconclusive.</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="an">wordcount:</span><span class="co"> true</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> '`r format(Sys.Date(), "%B %d, %Y")`'</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="an">last-modified:</span><span class="co"> 2025-11-11</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> ["Scientific review", "Statistical methods"]</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="an">tags:</span><span class="co"> []</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> preview-image.jpg</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="an">citation:</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="co">  url: https://brophyj.com/posts/2025-11-15-my-blog-post/</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="an">draft:</span><span class="co"> false</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="an">featured:</span><span class="co"> true</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="an">projects:</span><span class="co"> []</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="an">resources:</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="co">  - "."</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="co">  - input/**</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a><span class="co">  - output/**</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: false</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a><span class="co">    theme:</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a><span class="co">      - flatly</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a><span class="co">      - custom.scss</span></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a><span class="co">  preprint-typst:</span></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a><span class="co">    wordcount: true</span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a><span class="co">    citeproc: true</span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a><span class="co">    execute:</span></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a><span class="co">      echo: false   # good: hide code for the preprint format</span></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a><span class="co">    typst-template: typst.typ</span></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a><span class="co">  docx:</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a><span class="co">    execute:</span></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a><span class="co">      echo: false   # good: hide code for Word</span></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Make knitr/quarto write figures to a stable place for *all* formats</span></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a><span class="an">fig-path:</span><span class="co"> "output"</span></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a><span class="an">fig-format:</span><span class="co"> png</span></span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> source</span></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> bib.bib</span></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a><span class="an">biblio-style:</span><span class="co"> apalike</span></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a><span class="an">csl:</span><span class="co"> vancouver.csl</span></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a><span class="an">interactive:</span><span class="co"> false</span></span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load_packages}</span></span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a><span class="co"># load required packages</span></span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(brms)        <span class="co"># Bayesian GLMs via Stan</span></span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(cmdstanr)    <span class="co"># backend for brms</span></span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(posterior)   <span class="co"># tidy posterior draws</span></span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(bayesplot)   <span class="co"># PPC &amp; MCMC visualization</span></span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ggplot2)</span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(scales)  </span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidybayes)   <span class="co"># for bayesian plotting / functions</span></span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(bridgesampling)</span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(knitr)</span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(rstanarm)</span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(readr)</span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(dplyr)</span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyr)</span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(survival)</span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(survminer)</span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(IPDfromKM)</span>
<span id="cb15-86"><a href="#cb15-86" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb15-87"><a href="#cb15-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-88"><a href="#cb15-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Use cmdstanr backend (faster, fewer divergences)</span></span>
<span id="cb15-89"><a href="#cb15-89" aria-hidden="true" tabindex="-1"></a>cmdstanr<span class="sc">::</span><span class="fu">set_cmdstan_path</span>()</span>
<span id="cb15-90"><a href="#cb15-90" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">mc.cores =</span> <span class="fu">max</span>(<span class="dv">1</span>, parallel<span class="sc">::</span><span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb15-91"><a href="#cb15-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-92"><a href="#cb15-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: make figures a bit crisper</span></span>
<span id="cb15-93"><a href="#cb15-93" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">color_scheme_set</span>(<span class="st">"teal"</span>)</span>
<span id="cb15-94"><a href="#cb15-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-95"><a href="#cb15-95" aria-hidden="true" tabindex="-1"></a><span class="co"># suppress brms startup messages</span></span>
<span id="cb15-96"><a href="#cb15-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-97"><a href="#cb15-97" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: quiet-brms-helpers</span></span>
<span id="cb15-98"><a href="#cb15-98" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb15-99"><a href="#cb15-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-100"><a href="#cb15-100" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">%||%</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(x)) x <span class="cf">else</span> y</span>
<span id="cb15-101"><a href="#cb15-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-102"><a href="#cb15-102" aria-hidden="true" tabindex="-1"></a>quiet_brms <span class="ot">&lt;-</span> <span class="cf">function</span>(...,</span>
<span id="cb15-103"><a href="#cb15-103" aria-hidden="true" tabindex="-1"></a>                       <span class="at">backend_args =</span> <span class="cn">NULL</span>,</span>
<span id="cb15-104"><a href="#cb15-104" aria-hidden="true" tabindex="-1"></a>                       <span class="at">quiet =</span> <span class="cn">TRUE</span>,</span>
<span id="cb15-105"><a href="#cb15-105" aria-hidden="true" tabindex="-1"></a>                       <span class="at">noisy_on_error =</span> <span class="cn">TRUE</span>,</span>
<span id="cb15-106"><a href="#cb15-106" aria-hidden="true" tabindex="-1"></a>                       <span class="at">debug =</span> <span class="fu">getOption</span>(<span class="st">"quiet_brms.debug"</span>, <span class="cn">FALSE</span>)) {</span>
<span id="cb15-107"><a href="#cb15-107" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Merge backend_args with a 'quiet' flag (caller args win)</span></span>
<span id="cb15-108"><a href="#cb15-108" aria-hidden="true" tabindex="-1"></a>  backend_args <span class="ot">&lt;-</span> utils<span class="sc">::</span><span class="fu">modifyList</span>(<span class="fu">list</span>(<span class="at">quiet =</span> quiet), backend_args <span class="sc">%||%</span> <span class="fu">list</span>())</span>
<span id="cb15-109"><a href="#cb15-109" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-110"><a href="#cb15-110" aria-hidden="true" tabindex="-1"></a>  run <span class="ot">&lt;-</span> <span class="cf">function</span>(q) {</span>
<span id="cb15-111"><a href="#cb15-111" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rebuild backend_args with desired quiet setting for this run</span></span>
<span id="cb15-112"><a href="#cb15-112" aria-hidden="true" tabindex="-1"></a>    ba <span class="ot">&lt;-</span> utils<span class="sc">::</span><span class="fu">modifyList</span>(backend_args, <span class="fu">list</span>(<span class="at">quiet =</span> q))</span>
<span id="cb15-113"><a href="#cb15-113" aria-hidden="true" tabindex="-1"></a>    brms<span class="sc">::</span><span class="fu">brm</span>(..., <span class="at">backend =</span> <span class="st">"cmdstanr"</span>, <span class="at">backend_args =</span> ba)</span>
<span id="cb15-114"><a href="#cb15-114" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-115"><a href="#cb15-115" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-116"><a href="#cb15-116" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If user forces debug, run noisily and return (shows full compiler output)</span></span>
<span id="cb15-117"><a href="#cb15-117" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">isTRUE</span>(debug)) {</span>
<span id="cb15-118"><a href="#cb15-118" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"[quiet_brms] Debug mode: running noisily."</span>)</span>
<span id="cb15-119"><a href="#cb15-119" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">run</span>(<span class="cn">FALSE</span>))</span>
<span id="cb15-120"><a href="#cb15-120" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-121"><a href="#cb15-121" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-122"><a href="#cb15-122" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try a quiet run, suppressing R warnings/messages (compiler output minimized by quiet=TRUE)</span></span>
<span id="cb15-123"><a href="#cb15-123" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb15-124"><a href="#cb15-124" aria-hidden="true" tabindex="-1"></a>  err <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb15-125"><a href="#cb15-125" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">try</span>(</span>
<span id="cb15-126"><a href="#cb15-126" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressWarnings</span>(</span>
<span id="cb15-127"><a href="#cb15-127" aria-hidden="true" tabindex="-1"></a>      <span class="fu">suppressMessages</span>(</span>
<span id="cb15-128"><a href="#cb15-128" aria-hidden="true" tabindex="-1"></a>        <span class="fu">run</span>(<span class="cn">TRUE</span>)</span>
<span id="cb15-129"><a href="#cb15-129" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb15-130"><a href="#cb15-130" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb15-131"><a href="#cb15-131" aria-hidden="true" tabindex="-1"></a>    <span class="at">silent =</span> <span class="cn">TRUE</span></span>
<span id="cb15-132"><a href="#cb15-132" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-133"><a href="#cb15-133" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-134"><a href="#cb15-134" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">inherits</span>(fit, <span class="st">"try-error"</span>)) {</span>
<span id="cb15-135"><a href="#cb15-135" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(noisy_on_error)) {</span>
<span id="cb15-136"><a href="#cb15-136" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Surface the *real* cause: re-run noisily so cmdstanr/clang++ errors are printed</span></span>
<span id="cb15-137"><a href="#cb15-137" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">[quiet_brms] Quiet run failed. Re-running noisily to show the compiler error...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb15-138"><a href="#cb15-138" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">run</span>(<span class="cn">FALSE</span>))  <span class="co"># If this errors, you will see the full compiler/Stan error</span></span>
<span id="cb15-139"><a href="#cb15-139" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb15-140"><a href="#cb15-140" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="fu">attr</span>(fit, <span class="st">"condition"</span>) <span class="sc">%||%</span> fit)</span>
<span id="cb15-141"><a href="#cb15-141" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-142"><a href="#cb15-142" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-143"><a href="#cb15-143" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-144"><a href="#cb15-144" aria-hidden="true" tabindex="-1"></a>  fit</span>
<span id="cb15-145"><a href="#cb15-145" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-146"><a href="#cb15-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-147"><a href="#cb15-147" aria-hidden="true" tabindex="-1"></a>quiet_brms <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb15-148"><a href="#cb15-148" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb15-149"><a href="#cb15-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(<span class="fu">capture.output</span>({</span>
<span id="cb15-150"><a href="#cb15-150" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">brm</span>(...)</span>
<span id="cb15-151"><a href="#cb15-151" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb15-152"><a href="#cb15-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(model)</span>
<span id="cb15-153"><a href="#cb15-153" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-154"><a href="#cb15-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-155"><a href="#cb15-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-156"><a href="#cb15-156" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup-defaults</span></span>
<span id="cb15-157"><a href="#cb15-157" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb15-158"><a href="#cb15-158" aria-hidden="true" tabindex="-1"></a><span class="co"># Hide code everywhere by default</span></span>
<span id="cb15-159"><a href="#cb15-159" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">FALSE</span>, <span class="at">warning =</span> <span class="cn">FALSE</span>, <span class="at">message =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-160"><a href="#cb15-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-161"><a href="#cb15-161" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-enable code ONLY for HTML output (so HTML keeps code-fold etc.)</span></span>
<span id="cb15-162"><a href="#cb15-162" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (knitr<span class="sc">::</span><span class="fu">is_html_output</span>()) {</span>
<span id="cb15-163"><a href="#cb15-163" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-164"><a href="#cb15-164" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-165"><a href="#cb15-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-166"><a href="#cb15-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-167"><a href="#cb15-167" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-168"><a href="#cb15-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-169"><a href="#cb15-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-170"><a href="#cb15-170" aria-hidden="true" tabindex="-1"></a><span class="fu">## Backgound</span></span>
<span id="cb15-171"><a href="#cb15-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-172"><a href="#cb15-172" aria-hidden="true" tabindex="-1"></a>A recent paper, <span class="co">[</span><span class="ot">"Caffeinated Coffee Consumption or Abstinence to Reduce Atrial Fibrillation The DECAF Randomized Clinical Trial"</span><span class="co">](https://jamanetwork.com/journals/jama/fullarticle/2841253)[</span><span class="ot">@RN1</span><span class="co">]</span> published online in JAMA on Nov 9 2025 concluded</span>
<span id="cb15-173"><a href="#cb15-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-174"><a href="#cb15-174" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; "In this clinical trial of coffee drinkers after successful cardioversion, allocation to consumption of caffeinated coffee averaging 1 cup a day was associated with less recurrence of AF or atrial flutter compared with abstinence from coffee and caffeinated products."\</span></span>
<span id="cb15-175"><a href="#cb15-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-176"><a href="#cb15-176" aria-hidden="true" tabindex="-1"></a>This conclusion is likely surprising to most physicians as the historical belief is that caffeine is associated with increased cardiac ectopy.</span>
<span id="cb15-177"><a href="#cb15-177" aria-hidden="true" tabindex="-1"></a>However the authors make the case that while </span>
<span id="cb15-178"><a href="#cb15-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-179"><a href="#cb15-179" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; "Caffeinated coffee has traditionally been considered proarrhythmic"</span></span>
<span id="cb15-180"><a href="#cb15-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-181"><a href="#cb15-181" aria-hidden="true" tabindex="-1"></a>its role in atrial fibrillation is less uncertain. Supporting this uncertainty, the authors refer to a previous randomized trial<span class="co">[</span><span class="ot">@RN3</span><span class="co">]</span> that was not of atrial fibrillation patients but rather of 100 ambulatory patients studies in a crossover design.</span>
<span id="cb15-182"><a href="#cb15-182" aria-hidden="true" tabindex="-1"></a>That study concluded</span>
<span id="cb15-183"><a href="#cb15-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-184"><a href="#cb15-184" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; " the consumption of caffeinated coffee did not result in significantly more daily premature atrial contractions than the avoidance of caffeine"</span></span>
<span id="cb15-185"><a href="#cb15-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-186"><a href="#cb15-186" aria-hidden="true" tabindex="-1"></a>This small trial<span class="co">[</span><span class="ot">@RN3</span><span class="co">]</span> examined only short-term surrogate endpoints, not atrial fibrillation outcomes, and actually found a non significant trend towards more atrial ectopy in the caffeine group.      </span>
<span id="cb15-187"><a href="#cb15-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-188"><a href="#cb15-188" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; "The consumption of caffeinated coffee was associated with 58 daily premature atrial contractions as compared with 53 daily events on days when caffeine was avoided (rate ratio, 1.09; 95% confidence interval </span><span class="co">[</span><span class="ot">CI</span><span class="co">]</span><span class="at">, 0.98 to 1.20; P=0.10). The consumption of caffeinated coffee as compared with no caffeine consumption was associated with 154 and 102 daily premature ventricular contractions, respectively (rate ratio, 1.51; 95% CI, 1.18 to 1.94)."</span><span class="co">[</span><span class="ot">@RN3</span><span class="co">]</span></span>
<span id="cb15-189"><a href="#cb15-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-190"><a href="#cb15-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-191"><a href="#cb15-191" aria-hidden="true" tabindex="-1"></a>Apart from assuming that atrial ectopy is a good surrogate for atrial fibrillation, this suggests confusion between "absence of evidence" with "evidence of absence".    </span>
<span id="cb15-192"><a href="#cb15-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-193"><a href="#cb15-193" aria-hidden="true" tabindex="-1"></a>The DECAF authors<span class="co">[</span><span class="ot">@RN1</span><span class="co">]</span> also cite a meta-analysis of 12 observational studies<span class="co">[</span><span class="ot">@RN4</span><span class="co">]</span> that reported no conclusive evidence for or against an association between caffeine intake and incident atrial fibrillation (OR 0.95 (0.84–1.06). The quality of these 12 studies was not reported and as the DECAF authors state </span>
<span id="cb15-194"><a href="#cb15-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-195"><a href="#cb15-195" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; "observational studies are prone to confounding,and whether these findings are biased by systematic differences between coffee and noncoffee drinkers is unclear"</span><span class="co">[</span><span class="ot">@RN1</span><span class="co">]</span><span class="at">    </span></span>
<span id="cb15-196"><a href="#cb15-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-197"><a href="#cb15-197" aria-hidden="true" tabindex="-1"></a>Given this uncertainty, DECAF<span class="co">[</span><span class="ot">@RN1</span><span class="co">]</span> was designed to investigate the effect of caffeinated coffee consumption versus abstinence on atrial fibrillation recurrence following successful cardioversion. </span>
<span id="cb15-198"><a href="#cb15-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-199"><a href="#cb15-199" aria-hidden="true" tabindex="-1"></a><span class="fu">## DECAF Trial Design </span></span>
<span id="cb15-200"><a href="#cb15-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-201"><a href="#cb15-201" aria-hidden="true" tabindex="-1"></a>DECAF<span class="co">[</span><span class="ot">@RN1</span><span class="co">]</span> was a randomized controlled trial of 200 regular coffee drinkers with a recent successful cardioversion for atrial fibrillation (AF). Patients were randomized to either continue their usual caffeinated coffee consumption (median 1 cup/day) or to abstain from all caffeine products (decaf group). The primary outcome was recurrence of atrial fibrillation or atrial flutter within 6 months. The sample size calculations were based on assuming     </span>
<span id="cb15-202"><a href="#cb15-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-203"><a href="#cb15-203" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; "... a 50% incidence of AF recurrence within 6 months following cardioversion. A clinically relevant effect size was assumed to approximate the effectiveness of commonly prescribed antiarrhythmic drugs for recurrentAFafter cardioversion. To provide 80% power</span></span>
<span id="cb15-204"><a href="#cb15-204" aria-hidden="true" tabindex="-1"></a><span class="at">to detect a minimum 41% reduced relative hazard of AF, we enrolled 200 patients (100 per group) assuming a 1:1 randomization scheme, potential 10% loss to follow-up, and .05 2-tailed α level."</span><span class="co">[</span><span class="ot">@RN1</span><span class="co">]</span><span class="at">     </span></span>
<span id="cb15-205"><a href="#cb15-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-206"><a href="#cb15-206" aria-hidden="true" tabindex="-1"></a>This description is problematic for the following reasons.       </span>
<span id="cb15-207"><a href="#cb15-207" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>The implication is, since the methods section is written before any results are available, that 1:1 randomization of 200 subjects will automatically produce two equal groups. Based on binomial probability theory, there is only a 5.7% chance of achieving a perfectly balanced split (see Figure below).  </span>
<span id="cb15-208"><a href="#cb15-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-209"><a href="#cb15-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-210"><a href="#cb15-210" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig_binom, fig.cap="Distribution of group sizes for n=200 randomized 1:1 into two groups. The probability of a perfect 100/100 split is only 5.7%.", fig.align="center", fig.width=14, fig.height=7}</span></span>
<span id="cb15-211"><a href="#cb15-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-212"><a href="#cb15-212" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb15-213"><a href="#cb15-213" aria-hidden="true" tabindex="-1"></a>nrand <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">20000</span>, <span class="dv">200</span>, <span class="fl">0.5</span>)</span>
<span id="cb15-214"><a href="#cb15-214" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">nrand =</span> nrand)</span>
<span id="cb15-215"><a href="#cb15-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-216"><a href="#cb15-216" aria-hidden="true" tabindex="-1"></a><span class="co"># Count for x = 100</span></span>
<span id="cb15-217"><a href="#cb15-217" aria-hidden="true" tabindex="-1"></a>count_100 <span class="ot">&lt;-</span> <span class="fu">sum</span>(nrand <span class="sc">==</span> <span class="dv">100</span>)</span>
<span id="cb15-218"><a href="#cb15-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-219"><a href="#cb15-219" aria-hidden="true" tabindex="-1"></a><span class="co"># Theoretical probabilities for overlay</span></span>
<span id="cb15-220"><a href="#cb15-220" aria-hidden="true" tabindex="-1"></a>x_vals <span class="ot">&lt;-</span> <span class="dv">80</span><span class="sc">:</span><span class="dv">120</span></span>
<span id="cb15-221"><a href="#cb15-221" aria-hidden="true" tabindex="-1"></a>theoretical <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb15-222"><a href="#cb15-222" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> x_vals,</span>
<span id="cb15-223"><a href="#cb15-223" aria-hidden="true" tabindex="-1"></a>  <span class="at">prob =</span> <span class="fu">dbinom</span>(x_vals, <span class="at">size =</span> <span class="dv">200</span>, <span class="at">prob =</span> <span class="fl">0.5</span>) <span class="sc">*</span> <span class="dv">20000</span></span>
<span id="cb15-224"><a href="#cb15-224" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-225"><a href="#cb15-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-226"><a href="#cb15-226" aria-hidden="true" tabindex="-1"></a>gg1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> nrand, <span class="at">fill =</span> nrand <span class="sc">==</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb15-227"><a href="#cb15-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb15-228"><a href="#cb15-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"TRUE"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"FALSE"</span> <span class="ot">=</span> <span class="st">"lightblue"</span>)) <span class="sc">+</span></span>
<span id="cb15-229"><a href="#cb15-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> theoretical, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> prob),</span>
<span id="cb15-230"><a href="#cb15-230" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"darkblue"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb15-231"><a href="#cb15-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">100</span>, <span class="at">y =</span> count_100 <span class="sc">+</span> <span class="dv">50</span>,</span>
<span id="cb15-232"><a href="#cb15-232" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Count ="</span>, count_100, <span class="st">"</span><span class="sc">\n</span><span class="st">= "</span>, <span class="fu">round</span>((count_100 <span class="sc">/</span> <span class="dv">20000</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>), <span class="st">"%"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb15-233"><a href="#cb15-233" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb15-234"><a href="#cb15-234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-235"><a href="#cb15-235" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Histogram of 20,000 Simulations </span><span class="sc">\n</span><span class="st">Drawn from Binomial(200, 0.5)"</span>,</span>
<span id="cb15-236"><a href="#cb15-236" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Number per group"</span>,</span>
<span id="cb15-237"><a href="#cb15-237" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Frequency"</span>,</span>
<span id="cb15-238"><a href="#cb15-238" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Red bar indicates count at x = 100 </span><span class="sc">\n</span><span class="st">Blue line represents theoretical probabilities"</span></span>
<span id="cb15-239"><a href="#cb15-239" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-240"><a href="#cb15-240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb15-241"><a href="#cb15-241" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb15-242"><a href="#cb15-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-243"><a href="#cb15-243" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(gg1)</span>
<span id="cb15-244"><a href="#cb15-244" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"output/binom_group_sizes.png"</span>, gg1, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb15-245"><a href="#cb15-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-246"><a href="#cb15-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-247"><a href="#cb15-247" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-248"><a href="#cb15-248" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb15-249"><a href="#cb15-249" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Given the prevailing prior uncertainty, designing a trial to detect a very large risk reduction is overly optimistic. The 80% power estimate assumed a 41% reduction applied to a 50% baseline rates, meaning the intervention is expected to reduce recurrence by an absolute 20.5%. What would be the power with this sample size of 200 to detect a more modest relative risk reduction, say 15% (i.e. from 50% to 42.5%)? The answer is 24% (see Figure below, left panel), illustrating the study was severely underpowered to detect more realistic effect sizes and therefore at risk of Type M (magnitude) error<span class="co">[</span><span class="ot">@RN38</span><span class="co">]</span>, meaning  any statistically significant result tends to exaggerate the true effect<span class="co">[</span><span class="ot">@RN38</span><span class="co">]</span>. Thus the observed −17% risk difference may be overstating the true benefit, possibly by a factor of two (see right panel of above Figure). The published result should therefore be interpreted cautiously. Further exploration of the probability of a clinically meaningful result awaits the Bayesian analysis provided in later sections.</span>
<span id="cb15-250"><a href="#cb15-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-251"><a href="#cb15-251" aria-hidden="true" tabindex="-1"></a><span class="in">```{r power_curve,  fig.cap="Power curves for DECAF trial (n=200) to detect various relative risk reductions from a 50% baseline recurrence rate. The design has only 24% power to detect a 15% relative risk reduction(RRR). If the true effect is a 15% RRR, it is likely that any statistically significant result from this underpowered study will overstate the true effect by about two-fold.", fig.align="center", fig.width=14, fig.height=7}</span></span>
<span id="cb15-252"><a href="#cb15-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-253"><a href="#cb15-253" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb15-254"><a href="#cb15-254" aria-hidden="true" tabindex="-1"></a><span class="co"># Required packages</span></span>
<span id="cb15-255"><a href="#cb15-255" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb15-256"><a href="#cb15-256" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(retrodesign)</span>
<span id="cb15-257"><a href="#cb15-257" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb15-258"><a href="#cb15-258" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb15-259"><a href="#cb15-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-260"><a href="#cb15-260" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb15-261"><a href="#cb15-261" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate SE from observed effect and CrI</span></span>
<span id="cb15-262"><a href="#cb15-262" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb15-263"><a href="#cb15-263" aria-hidden="true" tabindex="-1"></a>observed_effect <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.076</span>     <span class="co"># Observed RD (Caf - Decaf)</span></span>
<span id="cb15-264"><a href="#cb15-264" aria-hidden="true" tabindex="-1"></a>lower <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.195</span>               <span class="co"># Lower bound of 95% CrI</span></span>
<span id="cb15-265"><a href="#cb15-265" aria-hidden="true" tabindex="-1"></a>upper <span class="ot">&lt;-</span> <span class="fl">0.044</span>                <span class="co"># Upper bound of 95% CrI</span></span>
<span id="cb15-266"><a href="#cb15-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-267"><a href="#cb15-267" aria-hidden="true" tabindex="-1"></a><span class="co"># Approximate SE from 95% CrI</span></span>
<span id="cb15-268"><a href="#cb15-268" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> (upper <span class="sc">-</span> lower) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fl">1.96</span>)</span>
<span id="cb15-269"><a href="#cb15-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-270"><a href="#cb15-270" aria-hidden="true" tabindex="-1"></a><span class="co"># z-score and p-value (frequentist approximation)</span></span>
<span id="cb15-271"><a href="#cb15-271" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> observed_effect <span class="sc">/</span> se</span>
<span id="cb15-272"><a href="#cb15-272" aria-hidden="true" tabindex="-1"></a>p_value <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="fu">abs</span>(z)))</span>
<span id="cb15-273"><a href="#cb15-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-274"><a href="#cb15-274" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb15-275"><a href="#cb15-275" aria-hidden="true" tabindex="-1"></a><span class="co"># Assumed effect from original design</span></span>
<span id="cb15-276"><a href="#cb15-276" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb15-277"><a href="#cb15-277" aria-hidden="true" tabindex="-1"></a>assumed_effect <span class="ot">&lt;-</span> <span class="fl">0.20</span>  <span class="co"># DECAF assumed a large benefit for decaf</span></span>
<span id="cb15-278"><a href="#cb15-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-279"><a href="#cb15-279" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb15-280"><a href="#cb15-280" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute retrodesign metrics for observed and assumed effects</span></span>
<span id="cb15-281"><a href="#cb15-281" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb15-282"><a href="#cb15-282" aria-hidden="true" tabindex="-1"></a>retro_observed <span class="ot">&lt;-</span> <span class="fu">retro_design_closed_form</span>(observed_effect, se)</span>
<span id="cb15-283"><a href="#cb15-283" aria-hidden="true" tabindex="-1"></a>retro_assumed <span class="ot">&lt;-</span> <span class="fu">retro_design_closed_form</span>(assumed_effect, se)</span>
<span id="cb15-284"><a href="#cb15-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-285"><a href="#cb15-285" aria-hidden="true" tabindex="-1"></a>power_observed <span class="ot">&lt;-</span> retro_observed<span class="sc">$</span>power</span>
<span id="cb15-286"><a href="#cb15-286" aria-hidden="true" tabindex="-1"></a>power_assumed <span class="ot">&lt;-</span> retro_assumed<span class="sc">$</span>power</span>
<span id="cb15-287"><a href="#cb15-287" aria-hidden="true" tabindex="-1"></a>type_s_observed <span class="ot">&lt;-</span> retro_observed<span class="sc">$</span>type_s</span>
<span id="cb15-288"><a href="#cb15-288" aria-hidden="true" tabindex="-1"></a>type_m_observed <span class="ot">&lt;-</span> retro_observed<span class="sc">$</span>type_m</span>
<span id="cb15-289"><a href="#cb15-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-290"><a href="#cb15-290" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb15-291"><a href="#cb15-291" aria-hidden="true" tabindex="-1"></a><span class="co"># Print numeric summary</span></span>
<span id="cb15-292"><a href="#cb15-292" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb15-293"><a href="#cb15-293" aria-hidden="true" tabindex="-1"></a><span class="co"># cat("Observed Effect =", observed_effect, "\n")</span></span>
<span id="cb15-294"><a href="#cb15-294" aria-hidden="true" tabindex="-1"></a><span class="co"># cat("SE =", round(se, 4), "\n")</span></span>
<span id="cb15-295"><a href="#cb15-295" aria-hidden="true" tabindex="-1"></a><span class="co"># cat("Approx p-value =", round(p_value, 4), "\n")</span></span>
<span id="cb15-296"><a href="#cb15-296" aria-hidden="true" tabindex="-1"></a><span class="co"># cat("Power (Observed) =", round(power_observed, 3), "\n")</span></span>
<span id="cb15-297"><a href="#cb15-297" aria-hidden="true" tabindex="-1"></a><span class="co"># cat("Type S Error =", round(type_s_observed, 3), "\n")</span></span>
<span id="cb15-298"><a href="#cb15-298" aria-hidden="true" tabindex="-1"></a><span class="co"># cat("Type M Error =", round(type_m_observed, 3), "\n\n")</span></span>
<span id="cb15-299"><a href="#cb15-299" aria-hidden="true" tabindex="-1"></a><span class="co"># cat("Assumed Effect =", assumed_effect, "\n")</span></span>
<span id="cb15-300"><a href="#cb15-300" aria-hidden="true" tabindex="-1"></a><span class="co"># cat("Power (Assumed) =", round(power_assumed, 3), "\n\n")</span></span>
<span id="cb15-301"><a href="#cb15-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-302"><a href="#cb15-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-303"><a href="#cb15-303" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb15-304"><a href="#cb15-304" aria-hidden="true" tabindex="-1"></a><span class="co"># Range of true effects for plotting</span></span>
<span id="cb15-305"><a href="#cb15-305" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb15-306"><a href="#cb15-306" aria-hidden="true" tabindex="-1"></a>true_effects <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.20</span>, <span class="fl">0.20</span>, <span class="at">length.out =</span> <span class="dv">200</span>)</span>
<span id="cb15-307"><a href="#cb15-307" aria-hidden="true" tabindex="-1"></a>retro <span class="ot">&lt;-</span> <span class="fu">retro_design_closed_form</span>(true_effects, se)</span>
<span id="cb15-308"><a href="#cb15-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-309"><a href="#cb15-309" aria-hidden="true" tabindex="-1"></a><span class="co"># Build data frame</span></span>
<span id="cb15-310"><a href="#cb15-310" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb15-311"><a href="#cb15-311" aria-hidden="true" tabindex="-1"></a>  <span class="at">TrueEffect =</span> true_effects,</span>
<span id="cb15-312"><a href="#cb15-312" aria-hidden="true" tabindex="-1"></a>  <span class="at">Power =</span> retro<span class="sc">$</span>power,</span>
<span id="cb15-313"><a href="#cb15-313" aria-hidden="true" tabindex="-1"></a>  <span class="at">TypeS =</span> retro<span class="sc">$</span>type_s,</span>
<span id="cb15-314"><a href="#cb15-314" aria-hidden="true" tabindex="-1"></a>  <span class="at">Exaggeration =</span> retro<span class="sc">$</span>type_m</span>
<span id="cb15-315"><a href="#cb15-315" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-316"><a href="#cb15-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-317"><a href="#cb15-317" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb15-318"><a href="#cb15-318" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom theme for polished look</span></span>
<span id="cb15-319"><a href="#cb15-319" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb15-320"><a href="#cb15-320" aria-hidden="true" tabindex="-1"></a>custom_theme <span class="ot">&lt;-</span> <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">16</span>) <span class="sc">+</span></span>
<span id="cb15-321"><a href="#cb15-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb15-322"><a href="#cb15-322" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">18</span>),</span>
<span id="cb15-323"><a href="#cb15-323" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb15-324"><a href="#cb15-324" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb15-325"><a href="#cb15-325" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb15-326"><a href="#cb15-326" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb15-327"><a href="#cb15-327" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-328"><a href="#cb15-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-329"><a href="#cb15-329" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb15-330"><a href="#cb15-330" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel 1: Type S Error</span></span>
<span id="cb15-331"><a href="#cb15-331" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb15-332"><a href="#cb15-332" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> TrueEffect, <span class="at">y =</span> TypeS)) <span class="sc">+</span></span>
<span id="cb15-333"><a href="#cb15-333" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb15-334"><a href="#cb15-334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> assumed_effect, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-335"><a href="#cb15-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> observed_effect, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-336"><a href="#cb15-336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> .<span class="dv">1</span>, <span class="at">y =</span> <span class="fl">0.42</span>,</span>
<span id="cb15-337"><a href="#cb15-337" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Assumed +0.20</span><span class="sc">\n</span><span class="st">Power ="</span>, <span class="fu">round</span>(power_assumed, <span class="dv">2</span>)),</span>
<span id="cb15-338"><a href="#cb15-338" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb15-339"><a href="#cb15-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> observed_effect, <span class="at">y =</span> <span class="fl">0.42</span>,</span>
<span id="cb15-340"><a href="#cb15-340" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Observed ="</span>, observed_effect,</span>
<span id="cb15-341"><a href="#cb15-341" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Power ="</span>, <span class="fu">round</span>(power_observed, <span class="dv">2</span>),</span>
<span id="cb15-342"><a href="#cb15-342" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Type S ="</span>, <span class="fu">round</span>(type_s_observed, <span class="dv">2</span>)),</span>
<span id="cb15-343"><a href="#cb15-343" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">hjust =</span> <span class="fl">1.1</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb15-344"><a href="#cb15-344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Type S Error vs True Effect Size"</span>,</span>
<span id="cb15-345"><a href="#cb15-345" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Observed ="</span>, observed_effect, <span class="st">"| SE ="</span>, <span class="fu">round</span>(se, <span class="dv">4</span>)),</span>
<span id="cb15-346"><a href="#cb15-346" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"True Effect Size (Caf - Decaf)"</span>,</span>
<span id="cb15-347"><a href="#cb15-347" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Type S Error Probability"</span>) <span class="sc">+</span></span>
<span id="cb15-348"><a href="#cb15-348" aria-hidden="true" tabindex="-1"></a>  custom_theme</span>
<span id="cb15-349"><a href="#cb15-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-350"><a href="#cb15-350" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb15-351"><a href="#cb15-351" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel 2: Exaggeration Ratio</span></span>
<span id="cb15-352"><a href="#cb15-352" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb15-353"><a href="#cb15-353" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> TrueEffect, <span class="at">y =</span> Exaggeration)) <span class="sc">+</span></span>
<span id="cb15-354"><a href="#cb15-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb15-355"><a href="#cb15-355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> assumed_effect, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-356"><a href="#cb15-356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> observed_effect, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-357"><a href="#cb15-357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> .<span class="dv">1</span>, <span class="at">y =</span> <span class="fu">max</span>(df<span class="sc">$</span>Exaggeration)<span class="sc">*</span><span class="fl">0.85</span>,</span>
<span id="cb15-358"><a href="#cb15-358" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Assumed +0.20</span><span class="sc">\n</span><span class="st">Power ="</span>, <span class="fu">round</span>(power_assumed, <span class="dv">2</span>)),</span>
<span id="cb15-359"><a href="#cb15-359" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb15-360"><a href="#cb15-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">30</span>,</span>
<span id="cb15-361"><a href="#cb15-361" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Observed ="</span>, observed_effect,</span>
<span id="cb15-362"><a href="#cb15-362" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Power ="</span>, <span class="fu">round</span>(power_observed, <span class="dv">2</span>),</span>
<span id="cb15-363"><a href="#cb15-363" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Type M ="</span>, <span class="fu">round</span>(type_m_observed, <span class="dv">2</span>)),</span>
<span id="cb15-364"><a href="#cb15-364" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">hjust =</span> <span class="fl">1.1</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb15-365"><a href="#cb15-365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="fl">0.10</span>, <span class="fl">0.10</span>) <span class="sc">+</span></span>
<span id="cb15-366"><a href="#cb15-366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">50</span>) <span class="sc">+</span></span>
<span id="cb15-367"><a href="#cb15-367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Exaggeration Ratio vs </span><span class="sc">\n</span><span class="st">True Effect Size"</span>,</span>
<span id="cb15-368"><a href="#cb15-368" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"True Effect Size (Caf - Decaf)"</span>,</span>
<span id="cb15-369"><a href="#cb15-369" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Exaggeration Ratio"</span>) <span class="sc">+</span></span>
<span id="cb15-370"><a href="#cb15-370" aria-hidden="true" tabindex="-1"></a>  custom_theme</span>
<span id="cb15-371"><a href="#cb15-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-372"><a href="#cb15-372" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb15-373"><a href="#cb15-373" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel 3: Power</span></span>
<span id="cb15-374"><a href="#cb15-374" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb15-375"><a href="#cb15-375" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> TrueEffect, <span class="at">y =</span> Power)) <span class="sc">+</span></span>
<span id="cb15-376"><a href="#cb15-376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb15-377"><a href="#cb15-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> assumed_effect, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-378"><a href="#cb15-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> observed_effect, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-379"><a href="#cb15-379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> .<span class="dv">05</span>, <span class="at">y =</span> <span class="fl">0.8</span>,</span>
<span id="cb15-380"><a href="#cb15-380" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Assumed +0.20</span><span class="sc">\n</span><span class="st">Power ="</span>, <span class="fu">round</span>(power_assumed, <span class="dv">2</span>)),</span>
<span id="cb15-381"><a href="#cb15-381" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb15-382"><a href="#cb15-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fl">0.8</span>,</span>
<span id="cb15-383"><a href="#cb15-383" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Observed ="</span>, observed_effect,</span>
<span id="cb15-384"><a href="#cb15-384" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"</span><span class="sc">\n</span><span class="st">Power ="</span>, <span class="fu">round</span>(power_observed, <span class="dv">2</span>)),</span>
<span id="cb15-385"><a href="#cb15-385" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">hjust =</span> <span class="fl">1.1</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb15-386"><a href="#cb15-386" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Power vs </span><span class="sc">\n</span><span class="st">True Effect Size"</span>,</span>
<span id="cb15-387"><a href="#cb15-387" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"True Effect Size (Caf - Decaf)"</span>,</span>
<span id="cb15-388"><a href="#cb15-388" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Power"</span>) <span class="sc">+</span></span>
<span id="cb15-389"><a href="#cb15-389" aria-hidden="true" tabindex="-1"></a>  custom_theme</span>
<span id="cb15-390"><a href="#cb15-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-391"><a href="#cb15-391" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb15-392"><a href="#cb15-392" aria-hidden="true" tabindex="-1"></a><span class="co"># Save combined plots</span></span>
<span id="cb15-393"><a href="#cb15-393" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb15-394"><a href="#cb15-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-395"><a href="#cb15-395" aria-hidden="true" tabindex="-1"></a>combined_plot <span class="ot">&lt;-</span> p1 <span class="sc">/</span> p2 <span class="sc">/</span> p3</span>
<span id="cb15-396"><a href="#cb15-396" aria-hidden="true" tabindex="-1"></a>combined_plotMP <span class="ot">&lt;-</span> p3 <span class="sc">+</span> p2</span>
<span id="cb15-397"><a href="#cb15-397" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"output/decaf_retrodesign_panels_polished.png"</span>, combined_plot, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">14</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb15-398"><a href="#cb15-398" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"output/decaf_retrodesign_panels_polished_MP.png"</span>, combined_plotMP, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">7</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb15-399"><a href="#cb15-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-400"><a href="#cb15-400" aria-hidden="true" tabindex="-1"></a>combined_plotMP</span>
<span id="cb15-401"><a href="#cb15-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-402"><a href="#cb15-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-403"><a href="#cb15-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-404"><a href="#cb15-404" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>A lack of specification as to which arm (abstinence or caffeinated) is hypothesized to have the reduced risk. This ambiguity creates interpretive flexibility as whichever arm shows benefit could be claimed as success.  Such directional absence hinders inference and inflates the risk of misleading conclusions.  This lack of statistical clarity is evident not only in the published article but also in the <span class="co">[</span><span class="ot">trial protocol</span><span class="co">](https://cdn.jamanetwork.com/ama/content_public/journal/jama/0/joi250099supp1_prod_1762458119.41086.pdf?Expires=1766002960&amp;Signature=veUO2luJ-u-d2v~RtBHqQYJC2JetjhjFXQ2J-Eyc49InJ9BYIPTzVjFxE7oZF7BTlAN7g8~HXiemM2Oh5AbgAaVaInX2CpjN0TujOBrJmE5uc4HCUffwRztEF3x-I7X3m5j8a2cvoGbjfqEIHXGVgY95WpCLsV4H~3Xbiorj-Q1imZOtOl3~q9qwYSifSymwWG1CyjaGrBo8RF8zpCVo7pdZY1eTv2kh9Q-9I5ysrMIgnlLCmT5OcOYdVYt2i1nkzqOpMg9m7DU62l68iAOeP5r-7-towaGgMkpsGHv1qAID4JMgcv4J1ql~DJQlpkMKvALXpRUBbdUAZs6DXRn~9A__&amp;Key-Pair-Id=APKAIE5G5CRDK6RD3PGA)</span> and  trial registration documentation at <span class="co">[</span><span class="ot">ClinicalTrials.gov</span><span class="co">](https://clinicaltrials.gov/study/NCT05121519#study-plan)</span>. It is disconcerting that these design issues were overlooked not only by the authors but also apparently by peer reviewers, journal editors, and national funding agencies. These design flaws contribute to uncertainty in interpreting the final results.</span>
<span id="cb15-405"><a href="#cb15-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-406"><a href="#cb15-406" aria-hidden="true" tabindex="-1"></a><span class="fu">## DECAF Trial Results</span></span>
<span id="cb15-407"><a href="#cb15-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-408"><a href="#cb15-408" aria-hidden="true" tabindex="-1"></a>In the caffeinated coffee group, 47% of patients  had an AF or atrial flutter recurrence compared to 64% recurrence in the decaf group (hazard ratio, 0.61 <span class="co">[</span><span class="ot">95%CI, 0.42-0.89</span><span class="co">]</span>,). The authors concluded </span>
<span id="cb15-409"><a href="#cb15-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-410"><a href="#cb15-410" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; "...allocation to consumption of caffeinated coffee averaging 1 cup a day was</span></span>
<span id="cb15-411"><a href="#cb15-411" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">**associated**</span><span class="co">]</span><span class="at">{.red-text} with less recurrence of AF or atrial flutter compared with abstinence from coffee and caffeinated products."</span><span class="co">[</span><span class="ot">@RN1</span><span class="co">]</span></span>
<span id="cb15-412"><a href="#cb15-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-413"><a href="#cb15-413" aria-hidden="true" tabindex="-1"></a>Given the randomized design and the statistically significant result (p = 0.01), it is surprising that the conclusion wasn't </span>
<span id="cb15-414"><a href="#cb15-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-415"><a href="#cb15-415" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; &gt; ...allocation to consumption of caffeinated coffee averaging 1 cup a day </span></span>
<span id="cb15-416"><a href="#cb15-416" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">**caused**</span><span class="co">]</span><span class="at">{.red-text} less recurrence of AF or atrial flutter compared with abstinence from coffee and caffeinated products.</span></span>
<span id="cb15-417"><a href="#cb15-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-418"><a href="#cb15-418" aria-hidden="true" tabindex="-1"></a>The results were summarized in the Figure below.    </span>
<span id="cb15-419"><a href="#cb15-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-420"><a href="#cb15-420" aria-hidden="true" tabindex="-1"></a>!<span class="co">[</span><span class="ot">Cumulative incidence curve from DECAF trial[@RN1] showing higher recurrence rates in the decaf group (blue) versus caffeinated group (orange).</span><span class="co">](input/decaf_CI_plot.png)</span>{fig-align="center" fig-height="400"}</span>
<span id="cb15-421"><a href="#cb15-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-422"><a href="#cb15-422" aria-hidden="true" tabindex="-1"></a><span class="in">```{r raw_data, echo=FALSE}</span></span>
<span id="cb15-423"><a href="#cb15-423" aria-hidden="true" tabindex="-1"></a><span class="co"># Observed data</span></span>
<span id="cb15-424"><a href="#cb15-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-425"><a href="#cb15-425" aria-hidden="true" tabindex="-1"></a>a_success <span class="ot">&lt;-</span> <span class="dv">64</span>  <span class="co"># decaf group</span></span>
<span id="cb15-426"><a href="#cb15-426" aria-hidden="true" tabindex="-1"></a>a_total <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb15-427"><a href="#cb15-427" aria-hidden="true" tabindex="-1"></a>b_success <span class="ot">&lt;-</span> <span class="dv">47</span>  <span class="co"># caffeinated group</span></span>
<span id="cb15-428"><a href="#cb15-428" aria-hidden="true" tabindex="-1"></a>b_total <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb15-429"><a href="#cb15-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-430"><a href="#cb15-430" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportions</span></span>
<span id="cb15-431"><a href="#cb15-431" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> a_success <span class="sc">/</span> a_total</span>
<span id="cb15-432"><a href="#cb15-432" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> b_success <span class="sc">/</span> b_total</span>
<span id="cb15-433"><a href="#cb15-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-434"><a href="#cb15-434" aria-hidden="true" tabindex="-1"></a><span class="co"># Risk Difference</span></span>
<span id="cb15-435"><a href="#cb15-435" aria-hidden="true" tabindex="-1"></a>rd <span class="ot">&lt;-</span> p1 <span class="sc">-</span> p2</span>
<span id="cb15-436"><a href="#cb15-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-437"><a href="#cb15-437" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard error for RD</span></span>
<span id="cb15-438"><a href="#cb15-438" aria-hidden="true" tabindex="-1"></a>se_rd <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((p1 <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> p1) <span class="sc">/</span> a_total) <span class="sc">+</span> (p2 <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> p2) <span class="sc">/</span> b_total))</span>
<span id="cb15-439"><a href="#cb15-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-440"><a href="#cb15-440" aria-hidden="true" tabindex="-1"></a><span class="co"># 95% CI</span></span>
<span id="cb15-441"><a href="#cb15-441" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fl">1.96</span></span>
<span id="cb15-442"><a href="#cb15-442" aria-hidden="true" tabindex="-1"></a>ci_low <span class="ot">&lt;-</span> rd <span class="sc">-</span> z <span class="sc">*</span> se_rd</span>
<span id="cb15-443"><a href="#cb15-443" aria-hidden="true" tabindex="-1"></a>ci_high <span class="ot">&lt;-</span> rd <span class="sc">+</span> z <span class="sc">*</span> se_rd</span>
<span id="cb15-444"><a href="#cb15-444" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="fu">abs</span>(rd <span class="sc">/</span> se_rd)))</span>
<span id="cb15-445"><a href="#cb15-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-446"><a href="#cb15-446" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb15-447"><a href="#cb15-447" aria-hidden="true" tabindex="-1"></a><span class="co"># cat("Risk Difference (RD):", round(rd * 100, 2), "%\n")</span></span>
<span id="cb15-448"><a href="#cb15-448" aria-hidden="true" tabindex="-1"></a><span class="co"># cat("95% CI:", round(ci_low * 100, 2), "% to", round(ci_high * 100, 2), "%\n")</span></span>
<span id="cb15-449"><a href="#cb15-449" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-450"><a href="#cb15-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-451"><a href="#cb15-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-452"><a href="#cb15-452" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bayesian reanalysis of DECAF (survival modeling)</span></span>
<span id="cb15-453"><a href="#cb15-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-454"><a href="#cb15-454" aria-hidden="true" tabindex="-1"></a>The small p-value (p(data|null hypothesis) informs us that observing this data or more extreme data, if there was no true effect is unlikely. The inverse probability (p(effect|data) is arguably of greater interest and provides additional insights, most importantly the ability to include prior knowledge and to provide probability estimates of benefit or harm. Inverse probability, or Bayesian analyses, of survival data requires individual patient data (IPD) and well justified priors, which summarize the state of knowledge before seeing the data. Priors are often deemed the Achilles' heel of Bayesian analyses, but well justified, transparent and robust testing of different priors can mitigate subjectiveness concerns. In Bayesian reanalyses of completed studies, prior beliefs can sometimes be extracted from the original power calculations. For example, the DECAF<span class="co">[</span><span class="ot">@RN1</span><span class="co">]</span> authors assumed a baseline recurrence risk of 50% with a 41% relative risk reduction and therefore a 29.5% risk in the intervention group (0.50 - 0.50*0.41 = 0.295). However we are now faced with the previous identification problem of the direction in the projected improvement. Did DECAF<span class="co">[</span><span class="ot">@RN1</span><span class="co">]</span> authors believe that the risk reduction would be with decaffeinated or caffeinated exposure? Given the prevailing belief of caffeine as a proarrhythmic agent and given that the study population was comprised initially of coffee drinkers, with the intervention being abstinence we assume the proposed relative risk reduction is in favor of the decaffeinated group.</span>
<span id="cb15-455"><a href="#cb15-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-456"><a href="#cb15-456" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load_data}</span></span>
<span id="cb15-457"><a href="#cb15-457" aria-hidden="true" tabindex="-1"></a>agg2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb15-458"><a href="#cb15-458" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"caffeinated"</span>, <span class="st">"abstinence"</span>),</span>
<span id="cb15-459"><a href="#cb15-459" aria-hidden="true" tabindex="-1"></a>                 <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"abstinence"</span>, <span class="st">"caffeinated"</span>)),  <span class="co"># reference first</span></span>
<span id="cb15-460"><a href="#cb15-460" aria-hidden="true" tabindex="-1"></a>  <span class="at">y     =</span> <span class="fu">c</span>(<span class="dv">47</span>, <span class="dv">64</span>),</span>
<span id="cb15-461"><a href="#cb15-461" aria-hidden="true" tabindex="-1"></a>  <span class="at">n     =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">100</span>)</span>
<span id="cb15-462"><a href="#cb15-462" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-463"><a href="#cb15-463" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">levels</span>(agg2<span class="sc">$</span>group) <span class="sc">==</span> <span class="fu">c</span>(<span class="st">"abstinence"</span>,<span class="st">"caffeinated"</span>)))</span>
<span id="cb15-464"><a href="#cb15-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-465"><a href="#cb15-465" aria-hidden="true" tabindex="-1"></a><span class="co"># Observed counts by group (named vector) — used later to align PPCs</span></span>
<span id="cb15-466"><a href="#cb15-466" aria-hidden="true" tabindex="-1"></a>y_obs_by_group <span class="ot">&lt;-</span> <span class="fu">with</span>(agg2, <span class="fu">setNames</span>(y, <span class="fu">as.character</span>(group)))</span>
<span id="cb15-467"><a href="#cb15-467" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-468"><a href="#cb15-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-469"><a href="#cb15-469" aria-hidden="true" tabindex="-1"></a><span class="in">```{r prior_construction}</span></span>
<span id="cb15-470"><a href="#cb15-470" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb15-471"><a href="#cb15-471" aria-hidden="true" tabindex="-1"></a><span class="co"># PRIOR CONSTRUCTION BASED ON DECAF PUBLICATION</span></span>
<span id="cb15-472"><a href="#cb15-472" aria-hidden="true" tabindex="-1"></a><span class="co"># Since with use binomial model with logit link, we need to convert</span></span>
<span id="cb15-473"><a href="#cb15-473" aria-hidden="true" tabindex="-1"></a><span class="co"># the RR-based prior into log-OR scale for class="b" and </span></span>
<span id="cb15-474"><a href="#cb15-474" aria-hidden="true" tabindex="-1"></a><span class="co"># logit scale for class="Intercept"</span></span>
<span id="cb15-475"><a href="#cb15-475" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb15-476"><a href="#cb15-476" aria-hidden="true" tabindex="-1"></a><span class="co"># 1: Decaf (reference) reduces risk by 41% vs caffeinated.</span></span>
<span id="cb15-477"><a href="#cb15-477" aria-hidden="true" tabindex="-1"></a>RR_decaf_vs_caff <span class="ot">&lt;-</span> <span class="fl">0.59</span>  <span class="co"># 1- RRR = 1 - 0.41 = 0.59</span></span>
<span id="cb15-478"><a href="#cb15-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-479"><a href="#cb15-479" aria-hidden="true" tabindex="-1"></a><span class="co"># 2: Baseline risk you want to anchor is caffeinated = 0.50.</span></span>
<span id="cb15-480"><a href="#cb15-480" aria-hidden="true" tabindex="-1"></a>p_caff_baseline  <span class="ot">&lt;-</span> <span class="fl">0.50</span></span>
<span id="cb15-481"><a href="#cb15-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-482"><a href="#cb15-482" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to convert probabilities to odds ratio to logOR </span></span>
<span id="cb15-483"><a href="#cb15-483" aria-hidden="true" tabindex="-1"></a><span class="co"># Given RR(decaf vs caff) and p_caff, compute p_decaf, OR(caff vs decaf), </span></span>
<span id="cb15-484"><a href="#cb15-484" aria-hidden="true" tabindex="-1"></a><span class="co"># logOR(caff vs decaf), and Intercept mean = logit(p_decaf).</span></span>
<span id="cb15-485"><a href="#cb15-485" aria-hidden="true" tabindex="-1"></a>from_RR_and_p_caff <span class="ot">&lt;-</span> <span class="cf">function</span>(RR_decaf_vs_caff, p_caff) {</span>
<span id="cb15-486"><a href="#cb15-486" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(RR_decaf_vs_caff <span class="sc">&gt;</span> <span class="dv">0</span>, p_caff <span class="sc">&gt;</span> <span class="dv">0</span>, p_caff <span class="sc">&lt;</span> <span class="dv">1</span>)</span>
<span id="cb15-487"><a href="#cb15-487" aria-hidden="true" tabindex="-1"></a>  p_decaf <span class="ot">&lt;-</span> RR_decaf_vs_caff <span class="sc">*</span> p_caff  <span class="co"># decaf risk = RR * caffeinated risk</span></span>
<span id="cb15-488"><a href="#cb15-488" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (p_decaf <span class="sc">&lt;=</span> <span class="dv">0</span> <span class="sc">||</span> p_decaf <span class="sc">&gt;=</span> <span class="dv">1</span>) {</span>
<span id="cb15-489"><a href="#cb15-489" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="fu">sprintf</span>(<span class="st">"Implied p_decaf = %.3f outside (0,1). Adjust RR or p_caff."</span>, p_decaf))</span>
<span id="cb15-490"><a href="#cb15-490" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-491"><a href="#cb15-491" aria-hidden="true" tabindex="-1"></a>  odds_caff  <span class="ot">&lt;-</span> p_caff  <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> p_caff)</span>
<span id="cb15-492"><a href="#cb15-492" aria-hidden="true" tabindex="-1"></a>  odds_decaf <span class="ot">&lt;-</span> p_decaf <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> p_decaf)</span>
<span id="cb15-493"><a href="#cb15-493" aria-hidden="true" tabindex="-1"></a>  OR_caff_vs_decaf   <span class="ot">&lt;-</span> odds_caff <span class="sc">/</span> odds_decaf</span>
<span id="cb15-494"><a href="#cb15-494" aria-hidden="true" tabindex="-1"></a>  logOR_caff_vs_decaf<span class="ot">&lt;-</span> <span class="fu">log</span>(OR_caff_vs_decaf)</span>
<span id="cb15-495"><a href="#cb15-495" aria-hidden="true" tabindex="-1"></a>  mu_intercept       <span class="ot">&lt;-</span> <span class="fu">qlogis</span>(p_decaf)       <span class="co"># baseline (decaf) on logit scale</span></span>
<span id="cb15-496"><a href="#cb15-496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb15-497"><a href="#cb15-497" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_caff       =</span> p_caff,</span>
<span id="cb15-498"><a href="#cb15-498" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_decaf      =</span> p_decaf,</span>
<span id="cb15-499"><a href="#cb15-499" aria-hidden="true" tabindex="-1"></a>    <span class="at">OR           =</span> OR_caff_vs_decaf,</span>
<span id="cb15-500"><a href="#cb15-500" aria-hidden="true" tabindex="-1"></a>    <span class="at">logOR        =</span> logOR_caff_vs_decaf,  <span class="co"># prior mean for class="b"</span></span>
<span id="cb15-501"><a href="#cb15-501" aria-hidden="true" tabindex="-1"></a>    <span class="at">mu_intercept =</span> mu_intercept          <span class="co"># prior mean for class="Intercept"</span></span>
<span id="cb15-502"><a href="#cb15-502" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-503"><a href="#cb15-503" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-504"><a href="#cb15-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-505"><a href="#cb15-505" aria-hidden="true" tabindex="-1"></a>conv <span class="ot">&lt;-</span> <span class="fu">from_RR_and_p_caff</span>(RR_decaf_vs_caff, p_caff_baseline)</span>
<span id="cb15-506"><a href="#cb15-506" aria-hidden="true" tabindex="-1"></a>mu_b <span class="ot">&lt;-</span> conv<span class="sc">$</span>logOR  <span class="co"># prior mean for b_groupcaffeinated (log-OR: caff vs decaf) ≈ +0.871</span></span>
<span id="cb15-507"><a href="#cb15-507" aria-hidden="true" tabindex="-1"></a>mu_intercept <span class="ot">&lt;-</span> conv<span class="sc">$</span>mu_intercept <span class="co"># prior mean for Intercept = logit(p_decaf) ≈ -0.871</span></span>
<span id="cb15-508"><a href="#cb15-508" aria-hidden="true" tabindex="-1"></a>p_decaf_prior_center <span class="ot">&lt;-</span> <span class="fu">plogis</span>(mu_intercept)</span>
<span id="cb15-509"><a href="#cb15-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-510"><a href="#cb15-510" aria-hidden="true" tabindex="-1"></a><span class="co"># message(sprintf("Prior centers: logOR_b ≈ %.3f (OR ≈ %.2f), Intercept ≈ %.3f =&gt; p_decaf ≈ %.3f",  mu_b, exp(mu_b), mu_intercept, p_decaf_prior_center))</span></span>
<span id="cb15-511"><a href="#cb15-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-512"><a href="#cb15-512" aria-hidden="true" tabindex="-1"></a><span class="co"># Prior SDs: tune to reflect how strongly you want to encode the belief.</span></span>
<span id="cb15-513"><a href="#cb15-513" aria-hidden="true" tabindex="-1"></a>sd_b <span class="ot">&lt;-</span> <span class="fl">0.5</span>          <span class="co"># narrower = stronger prior on treatment effect</span></span>
<span id="cb15-514"><a href="#cb15-514" aria-hidden="true" tabindex="-1"></a>sd_intercept <span class="ot">&lt;-</span> <span class="fl">1.5</span>  <span class="co"># weakly-informative baseline for decaf</span></span>
<span id="cb15-515"><a href="#cb15-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-516"><a href="#cb15-516" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb15-517"><a href="#cb15-517" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_prior</span>(<span class="fu">sprintf</span>(<span class="st">"normal(%g, %g)"</span>, mu_b,         sd_b),         <span class="at">class =</span> <span class="st">"b"</span>),</span>
<span id="cb15-518"><a href="#cb15-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_prior</span>(<span class="fu">sprintf</span>(<span class="st">"normal(%g, %g)"</span>, mu_intercept, sd_intercept), <span class="at">class =</span> <span class="st">"Intercept"</span>)</span>
<span id="cb15-519"><a href="#cb15-519" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-520"><a href="#cb15-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-521"><a href="#cb15-521" aria-hidden="true" tabindex="-1"></a><span class="co"># alternative prior</span></span>
<span id="cb15-522"><a href="#cb15-522" aria-hidden="true" tabindex="-1"></a><span class="co">#priors &lt;- c(set_prior(paste0("normal(", mu_b, ", ", sd_b, ")"),</span></span>
<span id="cb15-523"><a href="#cb15-523" aria-hidden="true" tabindex="-1"></a><span class="co">#            class = "b", coef = "groupcaffeinated"),</span></span>
<span id="cb15-524"><a href="#cb15-524" aria-hidden="true" tabindex="-1"></a><span class="co"># set_prior(paste0("normal(", mu_intercept, ", ", sd_intercept, ")"), class =  "Intercept"))</span></span>
<span id="cb15-525"><a href="#cb15-525" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-526"><a href="#cb15-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-527"><a href="#cb15-527" aria-hidden="true" tabindex="-1"></a>The priors for both treatment effect and baseline risk can be specified as normal distributions on the log-odds scale. Based on the assumptions used by the DECAF invetigators, the distributional parameters for the baseline control prior will be mean centered at their belief of a 50% recurrence risk (0 on the logit scale) with a standard deviation of 1.5, indicating a weakly informative prior. Similarly, the prior for the treatment effect will be centered at 29.5% (-0.871 on the logit scale) with an assumed standard deviation of 0.5, reflecting slightly higher confidence in our ability to estimate effect size variability. The reasonableness of these priors can be assessed through prior predictive checks which demonstrates that these priors adequately reflect the DECAF position of considerable uncertainty with a wide range of possible effect sizes, principally with expected benefit (93.5% probability), but a small probability of harm, for the intervention versus control.</span>
<span id="cb15-528"><a href="#cb15-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-529"><a href="#cb15-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-532"><a href="#cb15-532" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-533"><a href="#cb15-533" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb15-534"><a href="#cb15-534" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb15-535"><a href="#cb15-535" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb15-536"><a href="#cb15-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-537"><a href="#cb15-537" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================</span></span>
<span id="cb15-538"><a href="#cb15-538" aria-hidden="true" tabindex="-1"></a><span class="co"># Prior predictive for a two-arm Binomial trial</span></span>
<span id="cb15-539"><a href="#cb15-539" aria-hidden="true" tabindex="-1"></a><span class="co"># and effect-measure plots with requested axis settings</span></span>
<span id="cb15-540"><a href="#cb15-540" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================</span></span>
<span id="cb15-541"><a href="#cb15-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-542"><a href="#cb15-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-543"><a href="#cb15-543" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="cb15-544"><a href="#cb15-544" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Prior specification (EDIT)</span></span>
<span id="cb15-545"><a href="#cb15-545" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="cb15-546"><a href="#cb15-546" aria-hidden="true" tabindex="-1"></a><span class="co"># Baseline (control) log-odds prior: theta0 ~ Normal(mu0, sd0^2)</span></span>
<span id="cb15-547"><a href="#cb15-547" aria-hidden="true" tabindex="-1"></a>mu0 <span class="ot">&lt;-</span> <span class="fl">0.0</span>       <span class="co"># logit(0.50) = 0</span></span>
<span id="cb15-548"><a href="#cb15-548" aria-hidden="true" tabindex="-1"></a>sd0 <span class="ot">&lt;-</span> <span class="fl">1.5</span>       <span class="co"># weakly-informative baseline prior</span></span>
<span id="cb15-549"><a href="#cb15-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-550"><a href="#cb15-550" aria-hidden="true" tabindex="-1"></a><span class="co"># Treatment effect prior on log-odds ratio: delta ~ Normal(mud, sdd^2)</span></span>
<span id="cb15-551"><a href="#cb15-551" aria-hidden="true" tabindex="-1"></a>mud <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.871</span>    <span class="co"># ≈ logit(0.295) - logit(0.50), belief of ~29.5% at 50% baseline</span></span>
<span id="cb15-552"><a href="#cb15-552" aria-hidden="true" tabindex="-1"></a>sdd <span class="ot">&lt;-</span> <span class="fl">0.5</span>       <span class="co"># moderately informative</span></span>
<span id="cb15-553"><a href="#cb15-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-554"><a href="#cb15-554" aria-hidden="true" tabindex="-1"></a><span class="co"># Planned sample sizes (EDIT as needed)</span></span>
<span id="cb15-555"><a href="#cb15-555" aria-hidden="true" tabindex="-1"></a>nC <span class="ot">&lt;-</span> <span class="dv">150</span></span>
<span id="cb15-556"><a href="#cb15-556" aria-hidden="true" tabindex="-1"></a>nT <span class="ot">&lt;-</span> <span class="dv">150</span></span>
<span id="cb15-557"><a href="#cb15-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-558"><a href="#cb15-558" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of prior draws (increase for smoother densities)</span></span>
<span id="cb15-559"><a href="#cb15-559" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> <span class="dv">100000</span></span>
<span id="cb15-560"><a href="#cb15-560" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb15-561"><a href="#cb15-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-562"><a href="#cb15-562" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="cb15-563"><a href="#cb15-563" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Simulate from the priors</span></span>
<span id="cb15-564"><a href="#cb15-564" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="cb15-565"><a href="#cb15-565" aria-hidden="true" tabindex="-1"></a>logistic <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>x))</span>
<span id="cb15-566"><a href="#cb15-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-567"><a href="#cb15-567" aria-hidden="true" tabindex="-1"></a>theta0 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(S, <span class="at">mean =</span> mu0, <span class="at">sd =</span> sd0)   <span class="co"># baseline log-odds</span></span>
<span id="cb15-568"><a href="#cb15-568" aria-hidden="true" tabindex="-1"></a>delta  <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(S, <span class="at">mean =</span> mud, <span class="at">sd =</span> sdd)   <span class="co"># treatment log-OR</span></span>
<span id="cb15-569"><a href="#cb15-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-570"><a href="#cb15-570" aria-hidden="true" tabindex="-1"></a>pC <span class="ot">&lt;-</span> <span class="fu">logistic</span>(theta0)          <span class="co"># true control probability</span></span>
<span id="cb15-571"><a href="#cb15-571" aria-hidden="true" tabindex="-1"></a>pT <span class="ot">&lt;-</span> <span class="fu">logistic</span>(theta0 <span class="sc">+</span> delta)  <span class="co"># true treatment probability</span></span>
<span id="cb15-572"><a href="#cb15-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-573"><a href="#cb15-573" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="cb15-574"><a href="#cb15-574" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Prior predictive data</span></span>
<span id="cb15-575"><a href="#cb15-575" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="cb15-576"><a href="#cb15-576" aria-hidden="true" tabindex="-1"></a>YC <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(S, <span class="at">size =</span> nC, <span class="at">prob =</span> pC)</span>
<span id="cb15-577"><a href="#cb15-577" aria-hidden="true" tabindex="-1"></a>YT <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(S, <span class="at">size =</span> nT, <span class="at">prob =</span> pT)</span>
<span id="cb15-578"><a href="#cb15-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-579"><a href="#cb15-579" aria-hidden="true" tabindex="-1"></a>hat_pC <span class="ot">&lt;-</span> YC <span class="sc">/</span> nC</span>
<span id="cb15-580"><a href="#cb15-580" aria-hidden="true" tabindex="-1"></a>hat_pT <span class="ot">&lt;-</span> YT <span class="sc">/</span> nT</span>
<span id="cb15-581"><a href="#cb15-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-582"><a href="#cb15-582" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="cb15-583"><a href="#cb15-583" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Effect measures</span></span>
<span id="cb15-584"><a href="#cb15-584" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="cb15-585"><a href="#cb15-585" aria-hidden="true" tabindex="-1"></a><span class="co"># Risk difference: RD = p_hat_T - p_hat_C (benefit shows as negative)</span></span>
<span id="cb15-586"><a href="#cb15-586" aria-hidden="true" tabindex="-1"></a>RD <span class="ot">&lt;-</span> hat_pT <span class="sc">-</span> hat_pC</span>
<span id="cb15-587"><a href="#cb15-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-588"><a href="#cb15-588" aria-hidden="true" tabindex="-1"></a><span class="co"># Risk ratio</span></span>
<span id="cb15-589"><a href="#cb15-589" aria-hidden="true" tabindex="-1"></a>eps <span class="ot">&lt;-</span> <span class="fl">1e-12</span></span>
<span id="cb15-590"><a href="#cb15-590" aria-hidden="true" tabindex="-1"></a>RR <span class="ot">&lt;-</span> (hat_pT <span class="sc">+</span> eps) <span class="sc">/</span> (hat_pC <span class="sc">+</span> eps)</span>
<span id="cb15-591"><a href="#cb15-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-592"><a href="#cb15-592" aria-hidden="true" tabindex="-1"></a><span class="co"># Odds ratio</span></span>
<span id="cb15-593"><a href="#cb15-593" aria-hidden="true" tabindex="-1"></a>OR <span class="ot">&lt;-</span> ((hat_pT <span class="sc">+</span> eps) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> hat_pT <span class="sc">+</span> eps)) <span class="sc">/</span></span>
<span id="cb15-594"><a href="#cb15-594" aria-hidden="true" tabindex="-1"></a>  ((hat_pC <span class="sc">+</span> eps) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> hat_pC <span class="sc">+</span> eps))</span>
<span id="cb15-595"><a href="#cb15-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-596"><a href="#cb15-596" aria-hidden="true" tabindex="-1"></a>logRR <span class="ot">&lt;-</span> <span class="fu">log</span>(RR)</span>
<span id="cb15-597"><a href="#cb15-597" aria-hidden="true" tabindex="-1"></a>logOR <span class="ot">&lt;-</span> <span class="fu">log</span>(OR)</span>
<span id="cb15-598"><a href="#cb15-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-599"><a href="#cb15-599" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------</span></span>
<span id="cb15-600"><a href="#cb15-600" aria-hidden="true" tabindex="-1"></a><span class="co"># log(OR): x in [-3, +1]</span></span>
<span id="cb15-601"><a href="#cb15-601" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------</span></span>
<span id="cb15-602"><a href="#cb15-602" aria-hidden="true" tabindex="-1"></a>p_logOR <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> logOR), <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb15-603"><a href="#cb15-603" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"#9ECAE1"</span>, <span class="at">color =</span> <span class="st">"#3182BD"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">adjust =</span> <span class="fl">1.0</span>) <span class="sc">+</span></span>
<span id="cb15-604"><a href="#cb15-604" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb15-605"><a href="#cb15-605" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb15-606"><a href="#cb15-606" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-607"><a href="#cb15-607" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Prior Predictive: log Odds ratio"</span>,</span>
<span id="cb15-608"><a href="#cb15-608" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"log(OR)"</span>, <span class="at">y =</span> <span class="st">"Density"</span></span>
<span id="cb15-609"><a href="#cb15-609" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-610"><a href="#cb15-610" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span>
<span id="cb15-611"><a href="#cb15-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-612"><a href="#cb15-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-613"><a href="#cb15-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-614"><a href="#cb15-614" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------</span></span>
<span id="cb15-615"><a href="#cb15-615" aria-hidden="true" tabindex="-1"></a><span class="co"># log(RR): x in [-3, +1]</span></span>
<span id="cb15-616"><a href="#cb15-616" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------</span></span>
<span id="cb15-617"><a href="#cb15-617" aria-hidden="true" tabindex="-1"></a>p_logRR <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> logRR), <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb15-618"><a href="#cb15-618" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"#CFE8B9"</span>, <span class="at">color =</span> <span class="st">"#31A354"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">adjust =</span> <span class="fl">1.0</span>) <span class="sc">+</span></span>
<span id="cb15-619"><a href="#cb15-619" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb15-620"><a href="#cb15-620" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb15-621"><a href="#cb15-621" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-622"><a href="#cb15-622" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Prior Predictive: log Risk ratio"</span>,</span>
<span id="cb15-623"><a href="#cb15-623" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"log(RR)"</span>, <span class="at">y =</span> <span class="st">"Density"</span></span>
<span id="cb15-624"><a href="#cb15-624" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-625"><a href="#cb15-625" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span>
<span id="cb15-626"><a href="#cb15-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-627"><a href="#cb15-627" aria-hidden="true" tabindex="-1"></a>pr_RD_gt0 <span class="ot">&lt;-</span> <span class="fu">mean</span>(logRR <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb15-628"><a href="#cb15-628" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"output/prior_predictive_logRR.png"</span>, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb15-629"><a href="#cb15-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-630"><a href="#cb15-630" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------</span></span>
<span id="cb15-631"><a href="#cb15-631" aria-hidden="true" tabindex="-1"></a><span class="co"># Risk difference (p̂T − p̂C), scaled per 100 patients</span></span>
<span id="cb15-632"><a href="#cb15-632" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------</span></span>
<span id="cb15-633"><a href="#cb15-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-634"><a href="#cb15-634" aria-hidden="true" tabindex="-1"></a>RD100 <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">*</span> RD  <span class="co"># keep sign: benefit-negative if pT &lt; pC</span></span>
<span id="cb15-635"><a href="#cb15-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-636"><a href="#cb15-636" aria-hidden="true" tabindex="-1"></a><span class="co"># Tail probability for "worse than control" (RD &gt; 0)</span></span>
<span id="cb15-637"><a href="#cb15-637" aria-hidden="true" tabindex="-1"></a>pr_RD_gt0 <span class="ot">&lt;-</span> <span class="fu">mean</span>(RD <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb15-638"><a href="#cb15-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-639"><a href="#cb15-639" aria-hidden="true" tabindex="-1"></a><span class="co"># Density for shading region RD &gt; 0 (i.e., &gt; 0 per 100 after scaling too)</span></span>
<span id="cb15-640"><a href="#cb15-640" aria-hidden="true" tabindex="-1"></a>den_RD <span class="ot">&lt;-</span> <span class="fu">density</span>(RD100, <span class="at">adjust =</span> <span class="fl">1.0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-641"><a href="#cb15-641" aria-hidden="true" tabindex="-1"></a>df_RD  <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> den_RD<span class="sc">$</span>x, <span class="at">y =</span> den_RD<span class="sc">$</span>y)</span>
<span id="cb15-642"><a href="#cb15-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-643"><a href="#cb15-643" aria-hidden="true" tabindex="-1"></a><span class="co"># Reasonable x-limits from central mass; edit if you prefer fixed limits</span></span>
<span id="cb15-644"><a href="#cb15-644" aria-hidden="true" tabindex="-1"></a>xlim_rd <span class="ot">&lt;-</span> <span class="fu">quantile</span>(RD100, <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.995</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-645"><a href="#cb15-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-646"><a href="#cb15-646" aria-hidden="true" tabindex="-1"></a>p_RD100 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_RD, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb15-647"><a href="#cb15-647" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Shade the &gt;0 side (treatment worse under RD = pT - pC)</span></span>
<span id="cb15-648"><a href="#cb15-648" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">data =</span> <span class="fu">subset</span>(df_RD, x <span class="sc">&gt;</span> <span class="dv">0</span>), <span class="at">fill =</span> <span class="st">"#FDAE6B"</span>, <span class="at">alpha =</span> <span class="fl">0.35</span>) <span class="sc">+</span></span>
<span id="cb15-649"><a href="#cb15-649" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Outline full density</span></span>
<span id="cb15-650"><a href="#cb15-650" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"#E6550D"</span>, <span class="at">linewidth =</span> <span class="fl">1.0</span>) <span class="sc">+</span></span>
<span id="cb15-651"><a href="#cb15-651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb15-652"><a href="#cb15-652" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> xlim_rd) <span class="sc">+</span></span>
<span id="cb15-653"><a href="#cb15-653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-654"><a href="#cb15-654" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Prior Predictive: Absolute risk difference"</span>,</span>
<span id="cb15-655"><a href="#cb15-655" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">sprintf</span>(<span class="st">"Shaded area: P(RD &gt; 0) = %.3f"</span>, pr_RD_gt0),</span>
<span id="cb15-656"><a href="#cb15-656" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Absolute risk difference (per 100 patients)"</span>,  <span class="co"># still p̂T − p̂C</span></span>
<span id="cb15-657"><a href="#cb15-657" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Density"</span></span>
<span id="cb15-658"><a href="#cb15-658" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-659"><a href="#cb15-659" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span>
<span id="cb15-660"><a href="#cb15-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-661"><a href="#cb15-661" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"output/prior_predictive_RD100.png"</span>, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb15-662"><a href="#cb15-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-663"><a href="#cb15-663" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-664"><a href="#cb15-664" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb15-665"><a href="#cb15-665" aria-hidden="true" tabindex="-1"></a>In addition to the priors, the Bayesian survival analysis requires the individual patient data (IPD). Cumulative incidence data available in graphical format (DECAF<span class="co">[</span><span class="ot">@RN1</span><span class="co">]</span> Figure3), were extracted with WebPlotDigitizer<span class="co">[</span><span class="ot">@RN7716</span><span class="co">]</span> and transformed into survival format to generate a Kaplan–Meier (KM) plot using the Guyot et al<span class="co">[</span><span class="ot">@RN5762</span><span class="co">]</span> algorithm that incorporates numbers at risk and event counts. This method was implemented via the IPDfromK <span class="in">`R`</span> package<span class="co">[</span><span class="ot">@IPDfromKM</span><span class="co">]</span> providing a robust and validated approach for reconstructing IPD from published survival curves for secondary analyses. The success in extracting the IPD is evident in the complete overlap between the reconstructed KM curves and the original published curves (see Figure below).</span>
<span id="cb15-666"><a href="#cb15-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-667"><a href="#cb15-667" aria-hidden="true" tabindex="-1"></a><span class="in">```{r cumulative, fig.cap="Cumulative incidence plots from digitalized DECAF curves and reconstructed KM plots. Note excellent comparison with Figure 3. ", fig.align="center", fig.width=6, fig.height=4}</span></span>
<span id="cb15-668"><a href="#cb15-668" aria-hidden="true" tabindex="-1"></a><span class="co"># ================== 1) Read &amp; tidy your CSV ==================</span></span>
<span id="cb15-669"><a href="#cb15-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-670"><a href="#cb15-670" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"input/decaf_incident_data.csv"</span>,</span>
<span id="cb15-671"><a href="#cb15-671" aria-hidden="true" tabindex="-1"></a>               <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"coffee_time"</span>,<span class="st">"coffee_inc"</span>,<span class="st">"decaf_time"</span>,<span class="st">"decaf_inc"</span>),</span>
<span id="cb15-672"><a href="#cb15-672" aria-hidden="true" tabindex="-1"></a>               <span class="at">skip =</span> <span class="dv">2</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-673"><a href="#cb15-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-674"><a href="#cb15-674" aria-hidden="true" tabindex="-1"></a>coffee_xy <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(coffee_time) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(coffee_inc)) <span class="sc">%&gt;%</span></span>
<span id="cb15-675"><a href="#cb15-675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">time =</span> coffee_time, <span class="at">inc =</span> coffee_inc) <span class="sc">%&gt;%</span></span>
<span id="cb15-676"><a href="#cb15-676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(time) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(time, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-677"><a href="#cb15-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-678"><a href="#cb15-678" aria-hidden="true" tabindex="-1"></a>decaf_xy  <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(decaf_time)  <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(decaf_inc)) <span class="sc">%&gt;%</span></span>
<span id="cb15-679"><a href="#cb15-679" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">time =</span> decaf_time,  <span class="at">inc =</span> decaf_inc)  <span class="sc">%&gt;%</span></span>
<span id="cb15-680"><a href="#cb15-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(time) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(time, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-681"><a href="#cb15-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-682"><a href="#cb15-682" aria-hidden="true" tabindex="-1"></a><span class="co"># Truncate raw digitized series at 180 days </span></span>
<span id="cb15-683"><a href="#cb15-683" aria-hidden="true" tabindex="-1"></a>coffee_xy <span class="ot">&lt;-</span> coffee_xy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(time <span class="sc">&lt;=</span> <span class="dv">180</span>)</span>
<span id="cb15-684"><a href="#cb15-684" aria-hidden="true" tabindex="-1"></a>decaf_xy  <span class="ot">&lt;-</span> decaf_xy  <span class="sc">%&gt;%</span> <span class="fu">filter</span>(time <span class="sc">&lt;=</span> <span class="dv">180</span>)</span>
<span id="cb15-685"><a href="#cb15-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-686"><a href="#cb15-686" aria-hidden="true" tabindex="-1"></a><span class="co"># ================== 2) Incidence(%) -&gt; Survival(%) for reconstruction ==================</span></span>
<span id="cb15-687"><a href="#cb15-687" aria-hidden="true" tabindex="-1"></a>coffee_km <span class="ot">&lt;-</span> coffee_xy <span class="sc">%&gt;%</span> <span class="fu">transmute</span>(time, <span class="at">surv =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="dv">100</span> <span class="sc">-</span> inc))</span>
<span id="cb15-688"><a href="#cb15-688" aria-hidden="true" tabindex="-1"></a>decaf_km  <span class="ot">&lt;-</span> decaf_xy  <span class="sc">%&gt;%</span> <span class="fu">transmute</span>(time, <span class="at">surv =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="dv">100</span> <span class="sc">-</span> inc))</span>
<span id="cb15-689"><a href="#cb15-689" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">min</span>(coffee_km<span class="sc">$</span>time) <span class="sc">&gt;</span> <span class="dv">0</span>) coffee_km <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">time =</span> <span class="dv">0</span>, <span class="at">surv =</span> <span class="dv">100</span>), coffee_km)</span>
<span id="cb15-690"><a href="#cb15-690" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">min</span>(decaf_km<span class="sc">$</span>time)  <span class="sc">&gt;</span> <span class="dv">0</span>) decaf_km  <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">time =</span> <span class="dv">0</span>, <span class="at">surv =</span> <span class="dv">100</span>),  decaf_km)</span>
<span id="cb15-691"><a href="#cb15-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-692"><a href="#cb15-692" aria-hidden="true" tabindex="-1"></a><span class="co"># ================== 3) At-risk tables (yours) ==================</span></span>
<span id="cb15-693"><a href="#cb15-693" aria-hidden="true" tabindex="-1"></a>trisk <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">90</span>, <span class="dv">120</span>, <span class="dv">150</span>, <span class="dv">180</span>)</span>
<span id="cb15-694"><a href="#cb15-694" aria-hidden="true" tabindex="-1"></a>nrisk_coffee <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">79</span>, <span class="dv">70</span>, <span class="dv">61</span>, <span class="dv">57</span>, <span class="dv">56</span>, <span class="dv">52</span>)</span>
<span id="cb15-695"><a href="#cb15-695" aria-hidden="true" tabindex="-1"></a>nrisk_decaf  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">64</span>, <span class="dv">53</span>, <span class="dv">47</span>, <span class="dv">45</span>, <span class="dv">38</span>, <span class="dv">36</span>)</span>
<span id="cb15-696"><a href="#cb15-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-697"><a href="#cb15-697" aria-hidden="true" tabindex="-1"></a><span class="co"># ================== 4) Reconstruct IPD (Guyot method via IPDfromKM) ==================</span></span>
<span id="cb15-698"><a href="#cb15-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-699"><a href="#cb15-699" aria-hidden="true" tabindex="-1"></a>prep_coffee <span class="ot">&lt;-</span> <span class="fu">preprocess</span>(<span class="fu">as.matrix</span>(coffee_km), <span class="at">trisk =</span> trisk, <span class="at">nrisk =</span> nrisk_coffee, <span class="at">maxy =</span> <span class="dv">100</span>)</span>
<span id="cb15-700"><a href="#cb15-700" aria-hidden="true" tabindex="-1"></a>prep_decaf  <span class="ot">&lt;-</span> <span class="fu">preprocess</span>(<span class="fu">as.matrix</span>(decaf_km),  <span class="at">trisk =</span> trisk, <span class="at">nrisk =</span> nrisk_decaf,  <span class="at">maxy =</span> <span class="dv">100</span>)</span>
<span id="cb15-701"><a href="#cb15-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-702"><a href="#cb15-702" aria-hidden="true" tabindex="-1"></a>ipd_coffee <span class="ot">&lt;-</span> <span class="fu">getIPD</span>(prep_coffee, <span class="at">armID =</span> <span class="dv">1</span>)<span class="sc">$</span>IPD  <span class="co"># coffee arm</span></span>
<span id="cb15-703"><a href="#cb15-703" aria-hidden="true" tabindex="-1"></a>ipd_decaf  <span class="ot">&lt;-</span> <span class="fu">getIPD</span>(prep_decaf,  <span class="at">armID =</span> <span class="dv">0</span>)<span class="sc">$</span>IPD  <span class="co"># decaf arm</span></span>
<span id="cb15-704"><a href="#cb15-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-705"><a href="#cb15-705" aria-hidden="true" tabindex="-1"></a>ipd <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb15-706"><a href="#cb15-706" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">time =</span> ipd_coffee<span class="sc">$</span>time, <span class="at">status =</span> ipd_coffee<span class="sc">$</span>status, <span class="at">arm_coffee =</span> <span class="dv">1</span>L),</span>
<span id="cb15-707"><a href="#cb15-707" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">time =</span> ipd_decaf<span class="sc">$</span>time,  <span class="at">status =</span> ipd_decaf<span class="sc">$</span>status,  <span class="at">arm_coffee =</span> <span class="dv">0</span>L)</span>
<span id="cb15-708"><a href="#cb15-708" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-709"><a href="#cb15-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-710"><a href="#cb15-710" aria-hidden="true" tabindex="-1"></a><span class="co"># ================== 5) Truncate ANALYSIS at 180 days ==================</span></span>
<span id="cb15-711"><a href="#cb15-711" aria-hidden="true" tabindex="-1"></a>ipd <span class="ot">&lt;-</span> ipd <span class="sc">%&gt;%</span></span>
<span id="cb15-712"><a href="#cb15-712" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time_orig =</span> time, <span class="at">status_orig =</span> status,</span>
<span id="cb15-713"><a href="#cb15-713" aria-hidden="true" tabindex="-1"></a>         <span class="at">time =</span> <span class="fu">pmin</span>(time, <span class="dv">180</span>),</span>
<span id="cb15-714"><a href="#cb15-714" aria-hidden="true" tabindex="-1"></a>         <span class="at">status =</span> <span class="fu">ifelse</span>(time_orig <span class="sc">&gt;</span> <span class="dv">180</span>, <span class="dv">0</span>L, status_orig)) <span class="sc">%&gt;%</span></span>
<span id="cb15-715"><a href="#cb15-715" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>time_orig, <span class="sc">-</span>status_orig)</span>
<span id="cb15-716"><a href="#cb15-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-717"><a href="#cb15-717" aria-hidden="true" tabindex="-1"></a><span class="co"># ================== 6) Frequentist Cox (authors’ coding: coffee=1, decaf=0) ==================</span></span>
<span id="cb15-718"><a href="#cb15-718" aria-hidden="true" tabindex="-1"></a>fit_cox <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> arm_coffee, <span class="at">data =</span> ipd)</span>
<span id="cb15-719"><a href="#cb15-719" aria-hidden="true" tabindex="-1"></a>s_cox   <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit_cox)</span>
<span id="cb15-720"><a href="#cb15-720" aria-hidden="true" tabindex="-1"></a>hr      <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">coef</span>(fit_cox)[<span class="st">"arm_coffee"</span>])</span>
<span id="cb15-721"><a href="#cb15-721" aria-hidden="true" tabindex="-1"></a>ci_95   <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">confint</span>(fit_cox)[<span class="st">"arm_coffee"</span>, ])</span>
<span id="cb15-722"><a href="#cb15-722" aria-hidden="true" tabindex="-1"></a>p_value <span class="ot">&lt;-</span> s_cox<span class="sc">$</span>coefficients[<span class="st">"arm_coffee"</span>, <span class="st">"Pr(&gt;|z|)"</span>]</span>
<span id="cb15-723"><a href="#cb15-723" aria-hidden="true" tabindex="-1"></a><span class="co"># cat(sprintf("\nFrequentist Cox (coffee vs decaf): HR = %.2f (95%% CI %.2f–%.2f); p = %.3f\n", hr, ci_95[1], ci_95[2], p_value))</span></span>
<span id="cb15-724"><a href="#cb15-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-725"><a href="#cb15-725" aria-hidden="true" tabindex="-1"></a><span class="co"># ================== 7) KM plot (truncated at 180 days) ==================</span></span>
<span id="cb15-726"><a href="#cb15-726" aria-hidden="true" tabindex="-1"></a>km_fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> arm_coffee, <span class="at">data =</span> ipd)</span>
<span id="cb15-727"><a href="#cb15-727" aria-hidden="true" tabindex="-1"></a>p_km <span class="ot">&lt;-</span> <span class="fu">ggsurvplot</span>(</span>
<span id="cb15-728"><a href="#cb15-728" aria-hidden="true" tabindex="-1"></a>  km_fit, <span class="at">data =</span> ipd, <span class="at">conf.int =</span> <span class="cn">FALSE</span>, <span class="at">risk.table =</span> <span class="cn">TRUE</span>,</span>
<span id="cb15-729"><a href="#cb15-729" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">180</span>),</span>
<span id="cb15-730"><a href="#cb15-730" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.labs =</span> <span class="fu">c</span>(<span class="st">"Decaf (control)"</span>, <span class="st">"Coffee (intervention)"</span>),</span>
<span id="cb15-731"><a href="#cb15-731" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.title =</span> <span class="st">""</span>, <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#D95F02"</span>,<span class="st">"#1B9E77"</span>)</span>
<span id="cb15-732"><a href="#cb15-732" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-733"><a href="#cb15-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-734"><a href="#cb15-734" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"output/km_plot_coffee_vs_decaf.png"</span>, p_km<span class="sc">$</span>plot, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb15-735"><a href="#cb15-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-736"><a href="#cb15-736" aria-hidden="true" tabindex="-1"></a><span class="co"># ================== 8) Cumulative incidence overlay: digitized vs reconstructed ==================</span></span>
<span id="cb15-737"><a href="#cb15-737" aria-hidden="true" tabindex="-1"></a><span class="co"># Reconstructed cumulative incidence from KM (in %)</span></span>
<span id="cb15-738"><a href="#cb15-738" aria-hidden="true" tabindex="-1"></a>km_df <span class="ot">&lt;-</span> survminer<span class="sc">::</span><span class="fu">surv_summary</span>(km_fit) <span class="sc">%&gt;%</span></span>
<span id="cb15-739"><a href="#cb15-739" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cuminc =</span> <span class="dv">100</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> surv),</span>
<span id="cb15-740"><a href="#cb15-740" aria-hidden="true" tabindex="-1"></a>         <span class="at">arm =</span> <span class="fu">ifelse</span>(strata <span class="sc">==</span> <span class="st">"arm_coffee=0"</span>, <span class="st">"Decaf (KM)"</span>, <span class="st">"Coffee (KM)"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-741"><a href="#cb15-741" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(time, cuminc, arm)</span>
<span id="cb15-742"><a href="#cb15-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-743"><a href="#cb15-743" aria-hidden="true" tabindex="-1"></a><span class="co"># Digitized cumulative incidence (already in %), labeled</span></span>
<span id="cb15-744"><a href="#cb15-744" aria-hidden="true" tabindex="-1"></a>dig_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb15-745"><a href="#cb15-745" aria-hidden="true" tabindex="-1"></a>  coffee_xy <span class="sc">%&gt;%</span> <span class="fu">transmute</span>(time, <span class="at">cuminc =</span> inc, <span class="at">arm =</span> <span class="st">"Coffee (digitized)"</span>),</span>
<span id="cb15-746"><a href="#cb15-746" aria-hidden="true" tabindex="-1"></a>  decaf_xy  <span class="sc">%&gt;%</span> <span class="fu">transmute</span>(time, <span class="at">cuminc =</span> inc, <span class="at">arm =</span> <span class="st">"Decaf (digitized)"</span>)</span>
<span id="cb15-747"><a href="#cb15-747" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-748"><a href="#cb15-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-749"><a href="#cb15-749" aria-hidden="true" tabindex="-1"></a>p_ci <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb15-750"><a href="#cb15-750" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">data =</span> km_df, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> cuminc, <span class="at">color =</span> arm), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-751"><a href="#cb15-751" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dig_df, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> cuminc, <span class="at">color =</span> arm), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb15-752"><a href="#cb15-752" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Coffee (KM)"</span><span class="ot">=</span><span class="st">"#1B9E77"</span>,<span class="st">"Decaf (KM)"</span><span class="ot">=</span><span class="st">"#D95F02"</span>,</span>
<span id="cb15-753"><a href="#cb15-753" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Coffee (digitized)"</span><span class="ot">=</span><span class="st">"#1B9E77"</span>,<span class="st">"Decaf (digitized)"</span><span class="ot">=</span><span class="st">"#D95F02"</span>)) <span class="sc">+</span></span>
<span id="cb15-754"><a href="#cb15-754" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">180</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb15-755"><a href="#cb15-755" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cumulative incidence (reconstructed KM vs digitized points)"</span>,</span>
<span id="cb15-756"><a href="#cb15-756" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Days"</span>, <span class="at">y =</span> <span class="st">"Cumulative incidence (%)"</span>,</span>
<span id="cb15-757"><a href="#cb15-757" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb15-758"><a href="#cb15-758" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">90</span>, <span class="dv">120</span>, <span class="dv">150</span>, <span class="dv">180</span>)) <span class="sc">+</span></span>
<span id="cb15-759"><a href="#cb15-759" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">80</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb15-760"><a href="#cb15-760" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb15-761"><a href="#cb15-761" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb15-762"><a href="#cb15-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-763"><a href="#cb15-763" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_ci)</span>
<span id="cb15-764"><a href="#cb15-764" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"output/cumulative_incidence_overlay.png"</span>, p_ci, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb15-765"><a href="#cb15-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-766"><a href="#cb15-766" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-767"><a href="#cb15-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-768"><a href="#cb15-768" aria-hidden="true" tabindex="-1"></a>The IPD calculated frequentist survival analysis results, <span class="in">`r sprintf("HR = %.2f (95%% CI %.2f–%.2f),; p = %.3f\n", hr, ci_95[1], ci_95[2], p_value)`</span> closely matches the published DECAF<span class="co">[</span><span class="ot">@RN1</span><span class="co">]</span> results, confirming the accuracy of the IPD reconstruction process.</span>
<span id="cb15-769"><a href="#cb15-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-770"><a href="#cb15-770" aria-hidden="true" tabindex="-1"></a>Once the priors and IPD are specified, we can proceed with the Bayesian survival regression modelling. As Cox regression uses the partial likelihood, which cancels out the baseline hazard when estimating the regression coefficients (i.e., log‑HRs), in a Bayesian Cox survival model we only need a prior for the the treatment effect.</span>
<span id="cb15-771"><a href="#cb15-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-774"><a href="#cb15-774" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-775"><a href="#cb15-775" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compile-brms</span></span>
<span id="cb15-776"><a href="#cb15-776" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true</span></span>
<span id="cb15-777"><a href="#cb15-777" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb15-778"><a href="#cb15-778" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: true</span></span>
<span id="cb15-779"><a href="#cb15-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-780"><a href="#cb15-780" aria-hidden="true" tabindex="-1"></a><span class="co"># ================== 9) Bayesian Cox in brms (coffee vs decaf) ==================</span></span>
<span id="cb15-781"><a href="#cb15-781" aria-hidden="true" tabindex="-1"></a><span class="co"># Prior: belief that decaf is better -&gt; coffee harmful a priori.</span></span>
<span id="cb15-782"><a href="#cb15-782" aria-hidden="true" tabindex="-1"></a><span class="co"># Encode as Normal(+0.871, 0.5) on the coffee coefficient (log-HR).</span></span>
<span id="cb15-783"><a href="#cb15-783" aria-hidden="true" tabindex="-1"></a>ipd_brm <span class="ot">&lt;-</span> ipd <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">cens =</span> <span class="dv">1</span>L <span class="sc">-</span> status)  <span class="co"># brms uses 1=censored</span></span>
<span id="cb15-784"><a href="#cb15-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-785"><a href="#cb15-785" aria-hidden="true" tabindex="-1"></a>prior_cox <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb15-786"><a href="#cb15-786" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_prior</span>(<span class="st">"normal(0.871, 0.5)"</span>, <span class="at">class =</span> <span class="st">"b"</span>, <span class="at">coef =</span> <span class="st">"arm_coffee"</span>)</span>
<span id="cb15-787"><a href="#cb15-787" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-788"><a href="#cb15-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-789"><a href="#cb15-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-790"><a href="#cb15-790" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb15-791"><a href="#cb15-791" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb15-792"><a href="#cb15-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-793"><a href="#cb15-793" aria-hidden="true" tabindex="-1"></a>fit_brm_cox <span class="ot">&lt;-</span> <span class="fu">quiet_brms</span>(</span>
<span id="cb15-794"><a href="#cb15-794" aria-hidden="true" tabindex="-1"></a>  time <span class="sc">|</span> <span class="fu">cens</span>(cens) <span class="sc">~</span> arm_coffee,</span>
<span id="cb15-795"><a href="#cb15-795" aria-hidden="true" tabindex="-1"></a>  <span class="at">data    =</span> ipd_brm,</span>
<span id="cb15-796"><a href="#cb15-796" aria-hidden="true" tabindex="-1"></a>  <span class="at">family  =</span> <span class="fu">cox</span>(),</span>
<span id="cb15-797"><a href="#cb15-797" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior   =</span> prior_cox,</span>
<span id="cb15-798"><a href="#cb15-798" aria-hidden="true" tabindex="-1"></a>  <span class="at">backend =</span> <span class="st">"cmdstanr"</span>,</span>
<span id="cb15-799"><a href="#cb15-799" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains  =</span> <span class="dv">4</span>, <span class="at">iter =</span> <span class="dv">2500</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">seed =</span> <span class="dv">20251114</span>,</span>
<span id="cb15-800"><a href="#cb15-800" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.999</span>, <span class="at">max_treedepth =</span> <span class="dv">13</span>)</span>
<span id="cb15-801"><a href="#cb15-801" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-802"><a href="#cb15-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-803"><a href="#cb15-803" aria-hidden="true" tabindex="-1"></a><span class="co"># print(fit_brm_cox)</span></span>
<span id="cb15-804"><a href="#cb15-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-805"><a href="#cb15-805" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Finish: summarize posterior HR and a simple probability statement ----</span></span>
<span id="cb15-806"><a href="#cb15-806" aria-hidden="true" tabindex="-1"></a>post_cox <span class="ot">&lt;-</span> <span class="fu">posterior_summary</span>(fit_brm_cox, <span class="at">variable =</span> <span class="st">"b_arm_coffee"</span>)</span>
<span id="cb15-807"><a href="#cb15-807" aria-hidden="true" tabindex="-1"></a>HR_post  <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">unlist</span>(post_cox[<span class="dv">1</span>, <span class="fu">c</span>(<span class="st">"Estimate"</span>,<span class="st">"Q2.5"</span>,<span class="st">"Q97.5"</span>)]))</span>
<span id="cb15-808"><a href="#cb15-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-809"><a href="#cb15-809" aria-hidden="true" tabindex="-1"></a><span class="co"># cat(sprintf("\nBayesian Cox (coffee vs decaf): HR = %.2f (95%% CrI %.2f–%.2f)\n", HR_post[1], HR_post[2], HR_post[3]))</span></span>
<span id="cb15-810"><a href="#cb15-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-811"><a href="#cb15-811" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: posterior probability that coffee is beneficial (HR &lt; 1)</span></span>
<span id="cb15-812"><a href="#cb15-812" aria-hidden="true" tabindex="-1"></a>draws_b <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit_brm_cox)[[<span class="st">"b_arm_coffee"</span>]]</span>
<span id="cb15-813"><a href="#cb15-813" aria-hidden="true" tabindex="-1"></a><span class="co"># cat(sprintf("Pr(HR &lt; 1 | data, prior) = %.3f\n", mean(draws_b &lt; 0)))</span></span>
<span id="cb15-814"><a href="#cb15-814" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-815"><a href="#cb15-815" aria-hidden="true" tabindex="-1"></a>The Bayesian posterior hazard ratio is <span class="in">`r sprintf("%.2f (95%% CrI %.2f–%.2f)",HR_post[1], HR_post[2], HR_post[3])`</span>, suggesting that caffeinated coffee consumption may be associated with a lower risk of AF recurrence compared to decaffeinated coffee but the strength of the conclusion has been tempered by the prior belief that decaffeinated and not caffeinated, coffee would be beneficial. Graphically this shift of the observed result by the prior belief is shown in the Figure below. Notice also the width of the posterior probability has narrowed, underscoring that our new data has decreased our uncertainty about the effect of coffee.</span>
<span id="cb15-816"><a href="#cb15-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-817"><a href="#cb15-817" aria-hidden="true" tabindex="-1"></a><span class="in">```{r logHR, fig.cap="Prior and posterior probability density functions of log HR", fig.align="center", fig.width=14, fig.height=7}</span></span>
<span id="cb15-818"><a href="#cb15-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-819"><a href="#cb15-819" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb15-820"><a href="#cb15-820" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb15-821"><a href="#cb15-821" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb15-822"><a href="#cb15-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-823"><a href="#cb15-823" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- 1) Extract posterior draws of the treatment coefficient from brms Cox ----</span></span>
<span id="cb15-824"><a href="#cb15-824" aria-hidden="true" tabindex="-1"></a><span class="co"># Your model formula was: time | cens(cens) ~ arm_coffee</span></span>
<span id="cb15-825"><a href="#cb15-825" aria-hidden="true" tabindex="-1"></a>draws_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit_brm_cox)</span>
<span id="cb15-826"><a href="#cb15-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-827"><a href="#cb15-827" aria-hidden="true" tabindex="-1"></a><span class="co"># Robustly locate the coefficient in case the name changes; print names if needed</span></span>
<span id="cb15-828"><a href="#cb15-828" aria-hidden="true" tabindex="-1"></a><span class="co"># print(names(draws_df)[grepl("^b_", names(draws_df))])</span></span>
<span id="cb15-829"><a href="#cb15-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-830"><a href="#cb15-830" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="st">"b_arm_coffee"</span> <span class="sc">%in%</span> <span class="fu">names</span>(draws_df))</span>
<span id="cb15-831"><a href="#cb15-831" aria-hidden="true" tabindex="-1"></a>post_b <span class="ot">&lt;-</span> draws_df[[<span class="st">"b_arm_coffee"</span>]]   <span class="co"># log-HR for caffeinated (1) vs decaf (0)</span></span>
<span id="cb15-832"><a href="#cb15-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-833"><a href="#cb15-833" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- 2) Generate prior draws with same length (coffee harmful a priori) ----</span></span>
<span id="cb15-834"><a href="#cb15-834" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> <span class="fu">length</span>(post_b)</span>
<span id="cb15-835"><a href="#cb15-835" aria-hidden="true" tabindex="-1"></a>prior_mu <span class="ot">&lt;-</span> <span class="sc">+</span><span class="fl">0.871</span>   <span class="co"># your belief: decaf better -&gt; coffee harmful on log-(hazard) scale</span></span>
<span id="cb15-836"><a href="#cb15-836" aria-hidden="true" tabindex="-1"></a>prior_sd <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb15-837"><a href="#cb15-837" aria-hidden="true" tabindex="-1"></a>prior_b  <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(S, <span class="at">mean =</span> prior_mu, <span class="at">sd =</span> prior_sd)</span>
<span id="cb15-838"><a href="#cb15-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-839"><a href="#cb15-839" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- 3) Combine to long format ----</span></span>
<span id="cb15-840"><a href="#cb15-840" aria-hidden="true" tabindex="-1"></a>df_b <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb15-841"><a href="#cb15-841" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">value =</span> prior_b, <span class="at">which =</span> <span class="st">"Prior"</span>),</span>
<span id="cb15-842"><a href="#cb15-842" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">value =</span> post_b,  <span class="at">which =</span> <span class="st">"Posterior"</span>)</span>
<span id="cb15-843"><a href="#cb15-843" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-844"><a href="#cb15-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-845"><a href="#cb15-845" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- 4) Observed value and posterior mean (for vertical lines) ----</span></span>
<span id="cb15-846"><a href="#cb15-846" aria-hidden="true" tabindex="-1"></a>x_obs       <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="fl">0.61</span>)                    <span class="co"># authors' frequentist estimate</span></span>
<span id="cb15-847"><a href="#cb15-847" aria-hidden="true" tabindex="-1"></a>post_mean   <span class="ot">&lt;-</span> <span class="fu">mean</span>(post_b, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)   <span class="co"># posterior mean of log-HR</span></span>
<span id="cb15-848"><a href="#cb15-848" aria-hidden="true" tabindex="-1"></a>post_meanHR <span class="ot">&lt;-</span> <span class="fu">exp</span>(post_mean)</span>
<span id="cb15-849"><a href="#cb15-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-850"><a href="#cb15-850" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- 5) Plot: Prior vs Posterior on log-HR with reference lines ----</span></span>
<span id="cb15-851"><a href="#cb15-851" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_b, <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">colour =</span> which, <span class="at">fill =</span> which)) <span class="sc">+</span></span>
<span id="cb15-852"><a href="#cb15-852" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>, <span class="at">linewidth =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb15-853"><a href="#cb15-853" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> x_obs, <span class="at">colour =</span> <span class="st">"grey30"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb15-854"><a href="#cb15-854" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> post_mean, <span class="at">colour =</span> <span class="st">"#E34A33"</span>, <span class="at">linetype =</span> <span class="st">"dotdash"</span>, <span class="at">linewidth =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb15-855"><a href="#cb15-855" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-856"><a href="#cb15-856" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="cn">NULL</span>, <span class="at">fill =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">"log-HR (caffeinated vs decaf)"</span>,</span>
<span id="cb15-857"><a href="#cb15-857" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb15-858"><a href="#cb15-858" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Prior vs Posterior for log-HR (caffeinated vs decaf)"</span>,</span>
<span id="cb15-859"><a href="#cb15-859" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">sprintf</span>(<span class="st">"Observed HR = 0.61 (log = %.3f). Posterior mean HR ≈ %.2f (log = %.3f)."</span>,</span>
<span id="cb15-860"><a href="#cb15-860" aria-hidden="true" tabindex="-1"></a>                       x_obs, post_meanHR, post_mean),</span>
<span id="cb15-861"><a href="#cb15-861" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"DECAF prior +0.871  indicating </span><span class="sc">\n</span><span class="st"> decaffienated risk &lt; coded caffeinated ."</span></span>
<span id="cb15-862"><a href="#cb15-862" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-863"><a href="#cb15-863" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb15-864"><a href="#cb15-864" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>))</span>
<span id="cb15-865"><a href="#cb15-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-866"><a href="#cb15-866" aria-hidden="true" tabindex="-1"></a>hr_breaks     <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.61</span>, <span class="fl">0.75</span>, <span class="dv">1</span>, <span class="fl">1.25</span>, <span class="fl">1.5</span>, <span class="dv">2</span>)</span>
<span id="cb15-867"><a href="#cb15-867" aria-hidden="true" tabindex="-1"></a>log_hr_breaks <span class="ot">&lt;-</span> <span class="fu">log</span>(hr_breaks)</span>
<span id="cb15-868"><a href="#cb15-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-869"><a href="#cb15-869" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(</span>
<span id="cb15-870"><a href="#cb15-870" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"log-HR (caffeinated vs decaf)"</span>,</span>
<span id="cb15-871"><a href="#cb15-871" aria-hidden="true" tabindex="-1"></a>      <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span> ., <span class="at">breaks =</span> log_hr_breaks, <span class="at">labels =</span> hr_breaks,</span>
<span id="cb15-872"><a href="#cb15-872" aria-hidden="true" tabindex="-1"></a>                          <span class="at">name =</span> <span class="st">"Hazard ratio (caffeinated vs decaf)"</span>)</span>
<span id="cb15-873"><a href="#cb15-873" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-874"><a href="#cb15-874" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"output/prior_vs_posterior_logHR.png"</span>, p, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb15-875"><a href="#cb15-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-876"><a href="#cb15-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-877"><a href="#cb15-877" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- 6) Probability coffee has clinically meaningful benefit (HR &lt; 0.9) ----</span></span>
<span id="cb15-878"><a href="#cb15-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-879"><a href="#cb15-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-880"><a href="#cb15-880" aria-hidden="true" tabindex="-1"></a>p_hr_lt_0_9 <span class="ot">&lt;-</span> df_b <span class="sc">%&gt;%</span></span>
<span id="cb15-881"><a href="#cb15-881" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(which <span class="sc">==</span> <span class="st">"Posterior"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-882"><a href="#cb15-882" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">prob =</span> <span class="fu">mean</span>(value <span class="sc">&lt;</span> <span class="fu">log</span>(<span class="fl">0.9</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-883"><a href="#cb15-883" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(prob)</span>
<span id="cb15-884"><a href="#cb15-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-885"><a href="#cb15-885" aria-hidden="true" tabindex="-1"></a><span class="co"># sprintf("%.3f", p_hr_lt_0_9)</span></span>
<span id="cb15-886"><a href="#cb15-886" aria-hidden="true" tabindex="-1"></a><span class="co"># round(p_hr_lt_0_9, 3)</span></span>
<span id="cb15-887"><a href="#cb15-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-888"><a href="#cb15-888" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-889"><a href="#cb15-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-890"><a href="#cb15-890" aria-hidden="true" tabindex="-1"></a>Despite this shift, the posterior probability remains high that caffeinated coffee has a beneficial effect (HR &lt; 1) is <span class="in">`r sprintf("%.1f", mean(draws_b &lt; 0)*100)`</span>. However, the probability that caffeinated coffee has a clinically meaningful benefit, for example a HR &lt; 0.9, falls to <span class="in">`r round(p_hr_lt_0_9, 3)*100`</span>%. Increasing the threshold of what represents a clinically meaningful decrease, will lead to a corresponding reduction in the probability of a beneficial caffeine effect. </span>
<span id="cb15-891"><a href="#cb15-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-892"><a href="#cb15-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-893"><a href="#cb15-893" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bayesian reanalysis of DECAF (risk difference)</span></span>
<span id="cb15-894"><a href="#cb15-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-895"><a href="#cb15-895" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb15-896"><a href="#cb15-896" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model_fitting_rd, cache=TRUE}</span></span>
<span id="cb15-897"><a href="#cb15-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-898"><a href="#cb15-898" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb15-899"><a href="#cb15-899" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb15-900"><a href="#cb15-900" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggtext)   <span class="co"># &lt;- for colored text in subtitle</span></span>
<span id="cb15-901"><a href="#cb15-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-902"><a href="#cb15-902" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Priors ----</span></span>
<span id="cb15-903"><a href="#cb15-903" aria-hidden="true" tabindex="-1"></a>mu0 <span class="ot">&lt;-</span> <span class="fl">0.0</span>      <span class="co"># baseline log-odds</span></span>
<span id="cb15-904"><a href="#cb15-904" aria-hidden="true" tabindex="-1"></a>sd0 <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb15-905"><a href="#cb15-905" aria-hidden="true" tabindex="-1"></a>mud <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.871</span>   <span class="co"># mean of prior for log-OR (caffeinated vs decaf) on logit scale</span></span>
<span id="cb15-906"><a href="#cb15-906" aria-hidden="true" tabindex="-1"></a>sdd <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb15-907"><a href="#cb15-907" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb15-908"><a href="#cb15-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-909"><a href="#cb15-909" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Fit Bayesian binomial model ----</span></span>
<span id="cb15-910"><a href="#cb15-910" aria-hidden="true" tabindex="-1"></a><span class="co"># The model will be run with 4 chains, each with 4000 iterations (1000 warmup), and using the `cmdstanr` backend for efficient sampling. The `adapt_delta` control parameter is set to 0.95 to help ensure convergence. </span></span>
<span id="cb15-911"><a href="#cb15-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-912"><a href="#cb15-912" aria-hidden="true" tabindex="-1"></a>fit_binom2 <span class="ot">&lt;-</span> <span class="fu">quiet_brms</span>(</span>
<span id="cb15-913"><a href="#cb15-913" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> y <span class="sc">|</span> <span class="fu">trials</span>(n) <span class="sc">~</span> group, <span class="co"># groupcaffeinated is log-OR(caff vs decaf)</span></span>
<span id="cb15-914"><a href="#cb15-914" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> agg2,</span>
<span id="cb15-915"><a href="#cb15-915" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb15-916"><a href="#cb15-916" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> priors,</span>
<span id="cb15-917"><a href="#cb15-917" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb15-918"><a href="#cb15-918" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">4000</span>,</span>
<span id="cb15-919"><a href="#cb15-919" aria-hidden="true" tabindex="-1"></a>  <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb15-920"><a href="#cb15-920" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb15-921"><a href="#cb15-921" aria-hidden="true" tabindex="-1"></a>  <span class="at">backend =</span> <span class="st">"cmdstanr"</span>,</span>
<span id="cb15-922"><a href="#cb15-922" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.95</span>)</span>
<span id="cb15-923"><a href="#cb15-923" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-924"><a href="#cb15-924" aria-hidden="true" tabindex="-1"></a><span class="co"># print(summary(fit_binom2), digits = 3)</span></span>
<span id="cb15-925"><a href="#cb15-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-926"><a href="#cb15-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-927"><a href="#cb15-927" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Posterior RD (caffeinated − decaffeinated) ----</span></span>
<span id="cb15-928"><a href="#cb15-928" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">group =</span> <span class="fu">c</span>(<span class="st">"abstinence"</span>, <span class="st">"caffeinated"</span>), <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">100</span>))</span>
<span id="cb15-929"><a href="#cb15-929" aria-hidden="true" tabindex="-1"></a>eta_post <span class="ot">&lt;-</span> <span class="fu">posterior_linpred</span>(fit_binom2, <span class="at">newdata =</span> nd, <span class="at">transform =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-930"><a href="#cb15-930" aria-hidden="true" tabindex="-1"></a>p_post   <span class="ot">&lt;-</span> <span class="fu">plogis</span>(eta_post)</span>
<span id="cb15-931"><a href="#cb15-931" aria-hidden="true" tabindex="-1"></a>rd_post  <span class="ot">&lt;-</span> p_post[, <span class="dv">2</span>] <span class="sc">-</span> p_post[, <span class="dv">1</span>]  <span class="co"># caffeinated − decaffeinated</span></span>
<span id="cb15-932"><a href="#cb15-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-933"><a href="#cb15-933" aria-hidden="true" tabindex="-1"></a>post_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(rd_post)</span>
<span id="cb15-934"><a href="#cb15-934" aria-hidden="true" tabindex="-1"></a>post_sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(rd_post)</span>
<span id="cb15-935"><a href="#cb15-935" aria-hidden="true" tabindex="-1"></a>post_ci   <span class="ot">&lt;-</span> <span class="fu">quantile</span>(rd_post, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="cb15-936"><a href="#cb15-936" aria-hidden="true" tabindex="-1"></a><span class="co"># pnorm((0 - post_mean) / post_sd)  # Pr(RD &lt; 0 | data, prior) AKA pnorm(0, post_mean, post_sd) </span></span>
<span id="cb15-937"><a href="#cb15-937" aria-hidden="true" tabindex="-1"></a><span class="co"># clinically significant threshold at RD = -0.02</span></span>
<span id="cb15-938"><a href="#cb15-938" aria-hidden="true" tabindex="-1"></a><span class="co"># pnorm((-0.02 - post_mean) / post_sd)  # Pr(R</span></span>
<span id="cb15-939"><a href="#cb15-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-940"><a href="#cb15-940" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Observed RD (same direction: caffeinated − decaffeinated) ----</span></span>
<span id="cb15-941"><a href="#cb15-941" aria-hidden="true" tabindex="-1"></a>obs <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(<span class="fu">cbind</span>(y, n) <span class="sc">~</span> group, <span class="at">data =</span> fit_binom2<span class="sc">$</span>data, sum)</span>
<span id="cb15-942"><a href="#cb15-942" aria-hidden="true" tabindex="-1"></a>obs <span class="ot">&lt;-</span> obs[<span class="fu">match</span>(<span class="fu">c</span>(<span class="st">"abstinence"</span>, <span class="st">"caffeinated"</span>), obs<span class="sc">$</span>group), ]</span>
<span id="cb15-943"><a href="#cb15-943" aria-hidden="true" tabindex="-1"></a>obs_rd <span class="ot">&lt;-</span> obs<span class="sc">$</span>y[<span class="dv">2</span>] <span class="sc">/</span> obs<span class="sc">$</span>n[<span class="dv">2</span>] <span class="sc">-</span> obs<span class="sc">$</span>y[<span class="dv">1</span>] <span class="sc">/</span> obs<span class="sc">$</span>n[<span class="dv">1</span>]</span>
<span id="cb15-944"><a href="#cb15-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-945"><a href="#cb15-945" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Prior RD (centered &gt; 0 for this RD definition) ----</span></span>
<span id="cb15-946"><a href="#cb15-946" aria-hidden="true" tabindex="-1"></a>theta0  <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(rd_post), mu0, sd0)   <span class="co"># baseline (decaf) log-odds</span></span>
<span id="cb15-947"><a href="#cb15-947" aria-hidden="true" tabindex="-1"></a>delta   <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(rd_post), mud, sdd)   <span class="co"># log-OR (caffeinated vs decaf)</span></span>
<span id="cb15-948"><a href="#cb15-948" aria-hidden="true" tabindex="-1"></a>p_decaf <span class="ot">&lt;-</span> <span class="fu">plogis</span>(theta0)</span>
<span id="cb15-949"><a href="#cb15-949" aria-hidden="true" tabindex="-1"></a>p_caff  <span class="ot">&lt;-</span> <span class="fu">plogis</span>(theta0 <span class="sc">+</span> delta)</span>
<span id="cb15-950"><a href="#cb15-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-951"><a href="#cb15-951" aria-hidden="true" tabindex="-1"></a><span class="co"># Mirror so prior centers &gt; 0 for RD = caffeinated − decaffeinated</span></span>
<span id="cb15-952"><a href="#cb15-952" aria-hidden="true" tabindex="-1"></a>rd_prior <span class="ot">&lt;-</span> <span class="sc">-</span>(p_caff <span class="sc">-</span> p_decaf)</span>
<span id="cb15-953"><a href="#cb15-953" aria-hidden="true" tabindex="-1"></a><span class="co"># quantile(rd_prior, c(.025,.5,.975))</span></span>
<span id="cb15-954"><a href="#cb15-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-955"><a href="#cb15-955" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Plot ----</span></span>
<span id="cb15-956"><a href="#cb15-956" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb15-957"><a href="#cb15-957" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">RD =</span> rd_prior, <span class="at">which =</span> <span class="st">"Prior"</span>),</span>
<span id="cb15-958"><a href="#cb15-958" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">RD =</span> rd_post,  <span class="at">which =</span> <span class="st">"Posterior"</span>)</span>
<span id="cb15-959"><a href="#cb15-959" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-960"><a href="#cb15-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-961"><a href="#cb15-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-962"><a href="#cb15-962" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-963"><a href="#cb15-963" aria-hidden="true" tabindex="-1"></a>The DECAF<span class="co">[</span><span class="ot">@RN1</span><span class="co">]</span> result can also be expressed as a risk difference, -17% <span class="co">[</span><span class="ot">95% CI; -.03, -.31, p = 0.01</span><span class="co">]</span>. Again a Bayesian risk difference analysis may facilitate clinical interpretations. The Bayesian model will be fit to the aggregated data of events and total patients in each group. The model formula specifies a binomial likelihood with a logit link function, appropriate for binary outcome data. The previously developped priors based on the DECAF power calculation can be transformed to the risk difference scale. The Bayesian posterior risk difference, based on these prior beliefs and the observed data is <span class="in">`r sprintf(" %.1f%% (95%% CrI: %.1f%% to %.1f%%)", -post_mean * 100, post_ci[1] * 100, post_ci[2] * 100)`</span>, in favor of the caffeinated group. This posterior risk difference showed a shift towards the null compared to the frequentist result, due to the prior's influence even thought it was left purposely vague due to reflect the lack of previous consensus concerning the intervention's value in this population (see Figure below). The prior favored a posterior probability, (<span class="in">`r sprintf("%.1f%%", 100 * (pnorm((0 - post_mean) / post_sd)))`</span>), for decaffeinated benefit but did allocate a smaller probability (<span class="in">`r sprintf("%.1f%%", 100 * (1 - pnorm((0 - post_mean) / post_sd)))`</span>) for a possible caffeinated benefit. While the final result suggests a caffeinated coffee benefit, the strength of the evidence in favor of this benefit is seen as modest at best, and certainly much less than implied by the original analysis. For example, the probability of a clinically meaningful benefit (e.g., say arbitrarily RD &lt; -0.02 or number needed to treat = 50) drops to <span class="in">`r sprintf("%.1f%%", 100 * (pnorm((-0.02 - post_mean) / post_sd)))`</span>.  </span>
<span id="cb15-964"><a href="#cb15-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-965"><a href="#cb15-965" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rd_plot, fig.cap="Prior and posterior probability density functions of risk difference", fig.align="center", fig.width=14, fig.height=7}</span></span>
<span id="cb15-966"><a href="#cb15-966" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> RD<span class="sc">*</span><span class="dv">100</span>, <span class="at">fill =</span> which, <span class="at">color =</span> which)) <span class="sc">+</span></span>
<span id="cb15-967"><a href="#cb15-967" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.18</span>, <span class="at">adjust =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-968"><a href="#cb15-968" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>,        <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb15-969"><a href="#cb15-969" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> obs_rd<span class="sc">*</span><span class="dv">100</span>,   <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"green3"</span>) <span class="sc">+</span></span>
<span id="cb15-970"><a href="#cb15-970" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> post_mean<span class="sc">*</span><span class="dv">100</span>,<span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"firebrick"</span>) <span class="sc">+</span></span>
<span id="cb15-971"><a href="#cb15-971" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove legend title by naming the scales NULL</span></span>
<span id="cb15-972"><a href="#cb15-972" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="cn">NULL</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="at">Prior =</span> <span class="st">"#00BCD4"</span>, <span class="at">Posterior =</span> <span class="st">"#F08080"</span>)) <span class="sc">+</span></span>
<span id="cb15-973"><a href="#cb15-973" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="cn">NULL</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="at">Prior =</span> <span class="st">"#00BCD4"</span>, <span class="at">Posterior =</span> <span class="st">"#F08080"</span>)) <span class="sc">+</span></span>
<span id="cb15-974"><a href="#cb15-974" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-975"><a href="#cb15-975" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Prior vs Posterior for risk difference (RD)"</span>,</span>
<span id="cb15-976"><a href="#cb15-976" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Color words in subtitle using &lt;span style='color:...'&gt; and ggtext</span></span>
<span id="cb15-977"><a href="#cb15-977" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">sprintf</span>(</span>
<span id="cb15-978"><a href="#cb15-978" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Observed RD (&lt;span style='color:green3;'&gt;green line&lt;/span&gt;) = %.1f%%, Posterior mean RD (&lt;span style='color:firebrick;'&gt;red line&lt;/span&gt;) = %.1f%%"</span>,</span>
<span id="cb15-979"><a href="#cb15-979" aria-hidden="true" tabindex="-1"></a>      <span class="dv">100</span> <span class="sc">*</span> obs_rd, <span class="dv">100</span> <span class="sc">*</span> post_mean</span>
<span id="cb15-980"><a href="#cb15-980" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb15-981"><a href="#cb15-981" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"DECAF assumed prior decaffienated &lt; caffeinated risk </span><span class="sc">\n</span><span class="st">mirrored &gt; 0 since RD axis is (caffeinated - decaf)"</span>,</span>
<span id="cb15-982"><a href="#cb15-982" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Risk difference (caffeinated − decaffeinated) / 100 treated"</span>,</span>
<span id="cb15-983"><a href="#cb15-983" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Density"</span></span>
<span id="cb15-984"><a href="#cb15-984" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-985"><a href="#cb15-985" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">30</span>, <span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb15-986"><a href="#cb15-986" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb15-987"><a href="#cb15-987" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb15-988"><a href="#cb15-988" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Enable HTML rendering for the subtitle</span></span>
<span id="cb15-989"><a href="#cb15-989" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> ggtext<span class="sc">::</span><span class="fu">element_markdown</span>()</span>
<span id="cb15-990"><a href="#cb15-990" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-991"><a href="#cb15-991" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"output/prior_vs_posterior_RD.png"</span>, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb15-992"><a href="#cb15-992" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-993"><a href="#cb15-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-994"><a href="#cb15-994" aria-hidden="true" tabindex="-1"></a><span class="fu">## Discussion</span></span>
<span id="cb15-995"><a href="#cb15-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-996"><a href="#cb15-996" aria-hidden="true" tabindex="-1"></a>DECAF<span class="co">[</span><span class="ot">@RN1</span><span class="co">]</span> was a well performed clinical trial with successful randomization and no lost to follow-up. The trial was unblinded but events were adjudicated by treating physicians and not study coordinators so this risk of bias appears low. No other obvious biases were identified yet the results were highly "unexpected" or "surprising". The published analysis apparently provides a definitive answer in favor of the caffeinated group (p = .01). Notwithstanding DECAF's<span class="co">[</span><span class="ot">@RN1</span><span class="co">]</span> positive attributes and the emergence of "dataism" - the belief that empirical data should guide decisions as characterized by the pithy aphorism “In God we trust. All others have to bring data.”, many clinicians will prefer to trust their intuition or "gut instinct" and not encourage coffee consumption or maintence to prevent episodes of recurrent atrial fibrillation. However, reliance on intuition over evidence remains prone to cognitive error<span class="co">[</span><span class="ot">@RN5626</span><span class="co">]</span>.   </span>
<span id="cb15-997"><a href="#cb15-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-998"><a href="#cb15-998" aria-hidden="true" tabindex="-1"></a>Given the increasing influence of data-driven decision-making, it is essential that statistical interpretations be both rigorous and nuanced, whether frequentist or Bayesian in nature. From a frequentist standpoint, DECAF’s<span class="co">[</span><span class="ot">@RN1</span><span class="co">]</span> sample size was insufficient to detect realistic effect sizes. Power calculations revealed that the trial had only ~24% power to detect a 15% relative risk reduction, and any statistically significant result from such an underpowered study is likely to exaggerate the true effect — potentially by a factor of two.    </span>
<span id="cb15-999"><a href="#cb15-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-1000"><a href="#cb15-1000" aria-hidden="true" tabindex="-1"></a>The Bayesian framework adds further depth by incorporating prior beliefs and quantifies uncertainty in a way that frequentist methods cannot. It enables clinicians to assess not only the most recently observed data but also how to contextualize it by incorporating existing knowledge and beliefs. This is particularly important in scenarios where prior evidence or expert opinion may conflict with new findings.  Using priors derived from the DECAF authors’ own assumptions<span class="co">[</span><span class="ot">@RN1</span><span class="co">]</span>, the Bayesian survival and risk difference models suggest that the strength of evidence favoring caffeinated coffee is more modest than the frequentist interpretation implies. For example, while the posterior probability that caffeinated coffee reduces AF recurrence is high (~96%), the probability of a clinically meaningful benefit (e.g., HR &lt; 0.9) drops to ~88%. On the risk difference scale, the posterior probability of at least absolute  2% reduction in recurrences by avoiding abstinence is <span class="in">`r sprintf("%.1f%%", 100 * (pnorm((-0.02 - post_mean) / post_sd)))`</span>. This distinction between statistical and clinical significance is crucial for informed decision-making.    </span>
<span id="cb15-1001"><a href="#cb15-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-1002"><a href="#cb15-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-1003"><a href="#cb15-1003" aria-hidden="true" tabindex="-1"></a>Some may dismiss this reanalysis as statistical alchemy or the “haze of Bayes”<span class="co">[</span><span class="ot">@RN41</span><span class="co">]</span>, but it offers a principled approach to interpreting unexpected findings. In the case of DECAF<span class="co">[</span><span class="ot">@RN1</span><span class="co">]</span>, it tempers over-interpretation by including past beliefs, distinguishes between statistical and clinical significance, and provides the statistical justification for a replication study. This reanalysis can help clinicians make more informed decisions by providing a clearer understanding of the evidence at hand. This is especially important given that over 120 media outlets reported the findings within a week of publication, potentially influencing clinical practice and public behavior based on a single, underpowered study with unexpected, and naively interpreted, results.</span>
<span id="cb15-1004"><a href="#cb15-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-1005"><a href="#cb15-1005" aria-hidden="true" tabindex="-1"></a><span class="fu">## Supplementary Material</span></span>
<span id="cb15-1006"><a href="#cb15-1006" aria-hidden="true" tabindex="-1"></a>All code for the calculations and figures presented in this article are provided in the supplementary file</span>
<span id="cb15-1007"><a href="#cb15-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-1008"><a href="#cb15-1008" aria-hidden="true" tabindex="-1"></a><span class="fu">## References</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Powered by <a href="https://quarto.org">Quarto</a>.</p>
</div>   
    <div class="nav-footer-center">
<p>© 2025 Jay Brophy</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/brophyj/edit/main/posts/2025-12-04-decaf/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/brophyj/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>License: <a href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY NC SA 4.0</a>.</p>
</div>
  </div>
</footer><script type="text/javascript">
const dateElements = document.querySelectorAll("p.date, div.listing-date, div.listing-file-modified");
dateElements.forEach((el) => {
  el.innerHTML = el.innerHTML.replace(
    /(\d+)(st|nd|rd|th)/g,
    "$1<sup style='font-size:0.5em;font-style:italic;'>$2</sup>"
  );
});
</script><script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>


</body></html>